<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-02-02">

<title>Diego A. Mesa - An Introduction to Optimization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Diego A. Mesa</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">
 <span class="menu-text">posts</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../diego.mesa@vanderbilt.edu"><i class="bi bi-envelope-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/diego898"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/diego-a-mesa/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/diego898"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=8SnAElkAAAAJ&amp;hl=en"><i class="bi bi-stack" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">An Introduction to Optimization</h1>
            <p class="subtitle lead">From Gradients, to Stochastic Gradient Descent with Momentum and ADAM and everything inbetween!</p>
                                <div class="quarto-categories">
                <div class="quarto-category">optimization</div>
                <div class="quarto-category">numpy</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 2, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">February 23, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#animations" id="toc-animations" class="nav-link" data-scroll-target="#animations">Animations</a></li>
  </ul></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression">Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#hypothesis-space" id="toc-hypothesis-space" class="nav-link" data-scroll-target="#hypothesis-space">Hypothesis Space</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#cost-function" id="toc-cost-function" class="nav-link" data-scroll-target="#cost-function">Cost function</a></li>
  <li><a href="#gradient-of-our-cost" id="toc-gradient-of-our-cost" class="nav-link" data-scroll-target="#gradient-of-our-cost">Gradient of our cost</a></li>
  <li><a href="#gradient-descent-for-linear-regression" id="toc-gradient-descent-for-linear-regression" class="nav-link" data-scroll-target="#gradient-descent-for-linear-regression">Gradient Descent for Linear Regression</a>
  <ul class="collapse">
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a></li>
  <li><a href="#plot-path" id="toc-plot-path" class="nav-link" data-scroll-target="#plot-path">Plot Path</a></li>
  </ul></li>
  <li><a href="#multivarite-linear-regression" id="toc-multivarite-linear-regression" class="nav-link" data-scroll-target="#multivarite-linear-regression">Multivarite Linear Regression</a></li>
  </ul></li>
  <li><a href="#stochastic-gradient-descent" id="toc-stochastic-gradient-descent" class="nav-link" data-scroll-target="#stochastic-gradient-descent">Stochastic Gradient Descent</a>
  <ul class="collapse">
  <li><a href="#sgd-cost" id="toc-sgd-cost" class="nav-link" data-scroll-target="#sgd-cost">SGD Cost</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1">Implementation</a></li>
  <li><a href="#sgd-on-linear-regression" id="toc-sgd-on-linear-regression" class="nav-link" data-scroll-target="#sgd-on-linear-regression">SGD on Linear Regression</a>
  <ul class="collapse">
  <li><a href="#plot" id="toc-plot" class="nav-link" data-scroll-target="#plot">Plot</a></li>
  <li><a href="#comparison" id="toc-comparison" class="nav-link" data-scroll-target="#comparison">Comparison</a></li>
  </ul></li>
  <li><a href="#sgd-on-polynomial-regression" id="toc-sgd-on-polynomial-regression" class="nav-link" data-scroll-target="#sgd-on-polynomial-regression">SGD on Polynomial Regression</a></li>
  <li><a href="#plot-it" id="toc-plot-it" class="nav-link" data-scroll-target="#plot-it">Plot it</a></li>
  </ul></li>
  <li><a href="#mini-batch-gd" id="toc-mini-batch-gd" class="nav-link" data-scroll-target="#mini-batch-gd">Mini-Batch GD</a>
  <ul class="collapse">
  <li><a href="#implementation-2" id="toc-implementation-2" class="nav-link" data-scroll-target="#implementation-2">Implementation</a></li>
  <li><a href="#mbgd-on-linear-regression" id="toc-mbgd-on-linear-regression" class="nav-link" data-scroll-target="#mbgd-on-linear-regression">MBGD on Linear Regression</a></li>
  <li><a href="#plot-it-1" id="toc-plot-it-1" class="nav-link" data-scroll-target="#plot-it-1">Plot it</a></li>
  <li><a href="#mbgd-on-polynomial-regression" id="toc-mbgd-on-polynomial-regression" class="nav-link" data-scroll-target="#mbgd-on-polynomial-regression">MBGD on Polynomial Regression</a></li>
  <li><a href="#plot-it-2" id="toc-plot-it-2" class="nav-link" data-scroll-target="#plot-it-2">Plot it!</a></li>
  </ul></li>
  <li><a href="#momentum" id="toc-momentum" class="nav-link" data-scroll-target="#momentum">Momentum</a>
  <ul class="collapse">
  <li><a href="#implementation-3" id="toc-implementation-3" class="nav-link" data-scroll-target="#implementation-3">Implementation</a></li>
  <li><a href="#m-sgd-on-linear-regression" id="toc-m-sgd-on-linear-regression" class="nav-link" data-scroll-target="#m-sgd-on-linear-regression">M-SGD on Linear Regression</a></li>
  <li><a href="#plot-it-3" id="toc-plot-it-3" class="nav-link" data-scroll-target="#plot-it-3">Plot it!</a></li>
  <li><a href="#comparison-1" id="toc-comparison-1" class="nav-link" data-scroll-target="#comparison-1">Comparison</a></li>
  <li><a href="#plot-paths" id="toc-plot-paths" class="nav-link" data-scroll-target="#plot-paths">Plot Paths!</a></li>
  <li><a href="#gd-momentum" id="toc-gd-momentum" class="nav-link" data-scroll-target="#gd-momentum">GD + Momentum</a></li>
  <li><a href="#mbgd-momentum" id="toc-mbgd-momentum" class="nav-link" data-scroll-target="#mbgd-momentum">MBGD + Momentum</a></li>
  </ul></li>
  <li><a href="#unified-implementation" id="toc-unified-implementation" class="nav-link" data-scroll-target="#unified-implementation">Unified Implementation</a></li>
  <li><a href="#rms-prop" id="toc-rms-prop" class="nav-link" data-scroll-target="#rms-prop">RMS Prop</a>
  <ul class="collapse">
  <li><a href="#implementation-4" id="toc-implementation-4" class="nav-link" data-scroll-target="#implementation-4">Implementation</a></li>
  <li><a href="#plot-it-4" id="toc-plot-it-4" class="nav-link" data-scroll-target="#plot-it-4">Plot it!</a></li>
  </ul></li>
  <li><a href="#adam" id="toc-adam" class="nav-link" data-scroll-target="#adam">Adam</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this notebook we will walk through the several <strong>gradient-based</strong> optimization techniques <strong>from scratch</strong>.</p>
<p>We will start with a simple introduction to <strong>Gradient Descent</strong>, and work our way up to a <strong>vectorized</strong> implementation of <strong>Mini-Batch Stochastic Gradienet Descent with Momentum</strong>, and even <strong>ADAM</strong>.</p>
<p>In so doing, we will <strong>fully explain</strong> all the required numpy and linear algebra along the way.</p>
<p>This notebook aims to walk through all of these steps <strong>in detail</strong>, and by the end, we will generate the following animation which shows how various optimiation algorithms behave on a Multi-variate Polynomial Regression problem:</p>
<p><img src="multi_lin_reg_sgd.gif" class="img-fluid"></p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for creating animations</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.animation</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, Video</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># styling additions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># style = "&lt;style&gt;div.warn{background-color: #fcf2f2;border-color: #dFb5b4; border-left: 5px solid #dfb5b4; padding: 0.5em;}&lt;/style&gt;"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>style <span class="op">=</span> <span class="st">"&lt;style&gt;div.info{padding: 15px; border: 1px solid transparent; border-left: 5px solid #dfb5b4; border-color: transparent; margin-bottom: 10px; border-radius: 4px; background-color: #fcf8e3; border-color: #faebcc;}&lt;/style&gt;"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>HTML(style)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<style>div.info{padding: 15px; border: 1px solid transparent; border-left: 5px solid #dfb5b4; border-color: transparent; margin-bottom: 10px; border-radius: 4px; background-color: #fcf8e3; border-color: #faebcc;}</style>
</div>
</div>
<section id="animations" class="level2">
<h2 class="anchored" data-anchor-id="animations">Animations</h2>
<p>This notebook can (re)generate animations of optimization procedures, but that can take quite some time. In its place, you can use pre-generated GIFs/MP4s by togglnig this flag:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>regenerate_anim <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="simple-linear-regression" class="level1">
<h1>Simple Linear Regression</h1>
<p>Lets first start by understanding a basic linear regression problem. Say we have the following unknown but true function:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: We know it now because were using it to simulate our data. From this true function, we take noisy measurements:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,N)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> f(x) <span class="op">+</span> np.random.randn(N) <span class="co"># our zero man gaussian noise</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="hypothesis-space" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-space">Hypothesis Space</h2>
<p>Now this our <strong>dataset</strong>. Say we want to fit a line to this dataset, so our <strong>hypothesis</strong> takes the form:</p>
<p><span class="math display">h(x) = mx+b </span></p>
<p>This model has <strong>two parameters</strong> that we have to learn: <span class="math inline">m</span> and <span class="math inline">b</span>.</p>
<p>Althogh this is not typical in linear regression, we can also call them <strong>weights</strong>:</p>
<p><span class="math display">h(x) = w_0 + w_1x</span></p>
<p>Another notational thing that we can do now that will be useful to us later, is introduce a notational convenience: <span class="math inline">x_0 = 1</span>. This lets us rewrite our model as:</p>
<p><span class="math display">h(x) = w_0 x_0 + w_1x_1</span></p>
<p>where our original variable <span class="math inline">x</span> we’re now calling <span class="math inline">x_1</span>.</p>
<p><strong>Remember!</strong> This is just a “trick” of notation, because <span class="math inline">x_0</span> is defined to be <span class="math inline">1</span>, so we actually have:</p>
<p><span class="math display">
\begin{align}
h(x) &amp;= w_0 x_0 + w_1x_1 \\
     &amp;= w_0 (1) + w_1x_1 \\
     &amp;= w_0 + w_1x_1 \\
     &amp;= b + mx
\end{align}
</span></p>
<p>This notational trick now lets us write out our model in succinct linear algebraic notation as a <strong>dot product</strong> using vectors:</p>
<p><span class="math display">
\begin{align}
h(\mathbf{x}) &amp;= \mathbf{w}\cdot\mathbf{x} \\
              &amp;= w_0x_0 + w_1x_1 \\
              &amp;= \mathbf{w}^T \mathbf{x}
\end{align}
</span></p>
<p>Lets quickly remind ourselves about column vectors, row vectors and the dot product:</p>
<div class="info">
<p>We usually assume all vectors are written as <strong>column</strong> vectors, meaning they look like this: <span class="math display">
\mathbf{a} =
\begin{bmatrix}
a_0 \\ a_1
\end{bmatrix}
</span></p>
<p>So when we transponse them, they become <strong>row</strong> vectors: <span class="math display">
\mathbf{b}^T =
\begin{bmatrix}
b_0 &amp; b_1
\end{bmatrix}
</span></p>
<p>This lets us write our <strong>dot product</strong> as a vector-vector multiplication of a column vector and a row vector: <span class="math display">
\begin{align}
\mathbf{a} \cdot \mathbf{b} &amp;= a_0b_0 + a_1b_1 \\
                            &amp;= \mathbf{a}^T\mathbf{b} \\
                            &amp;= \mathbf{b}^T\mathbf{a}
\end{align}
</span></p>
</div>
<p>So lets summarize: we want to learn a <strong>linear</strong> model for our dataset:</p>
<p><span class="math display">\hat{y}=h(x)=mx+b</span></p>
<p>meaning we want a <strong>slope</strong>: <span class="math inline">m</span>, and an <strong>intercept</strong>: <span class="math inline">b</span>.</p>
<p>We have <strong>restated</strong> this problem in more linear algebraic notation, as wanting to find a <strong>2-dimensional</strong> weight vector: <span class="math inline">\mathbf{w}</span> for our linear model:</p>
<p><span class="math display">h(\mathbf{x}) = \mathbf{w}^T\mathbf{x}</span></p>
<p>So we can interpret the components of <span class="math inline">\mathbf{w}</span> as:</p>
<p><span class="math display">
\mathbf{w} =
\begin{bmatrix}
w_0 \\ w_1
\end{bmatrix}
=
\begin{bmatrix}
b \\ m
\end{bmatrix}
=
\begin{bmatrix}
intercept \\ slope
\end{bmatrix}
</span></p>
<hr>
<p>Now, lets go <em>one step further</em> with our notation! Note that as we’ve specified it above,</p>
<p><span class="math display">h(\mathbf{x}) = \mathbf{w}^T\mathbf{x}</span></p>
<p>only specifies a <strong>single</strong> <span class="math inline">\hat{y}</span>, for a <strong>single</strong> example of our dataset: <span class="math inline">\mathbf{x}</span>.</p>
<p>So, to abuse notation even futher, (trust me, I don’t want to but this is how its almost always presented so we might as well get used to it!) we can make this explicity by saying:</p>
<p><span class="math display">\hat{y}_i = h(\mathbf{x}_i) = \mathbf{w}^T\mathbf{x}_i</span></p>
<p>We want to generate our estimates for each input example <span class="math inline">\mathbf{x}_i</span>. We can picture what we want like this:</p>
<p><span class="math display">
\begin{align}
    \hat{y}_1 &amp;= h(\mathbf{x}_i) = \mathbf{w}^T\mathbf{x}_i \\
    \hat{y}_2 &amp;= h(\mathbf{x}_2) = \mathbf{w}^T\mathbf{x}_2 \\
    \ldots \\
    \hat{y}_i &amp;= h(\mathbf{x}_i) = \mathbf{w}^T\mathbf{x}_i \\
    \ldots \\
    \hat{y}_N &amp;= h(\mathbf{x}_N) = \mathbf{w}^T\mathbf{x}_N \\
\end{align}
</span></p>
<p>I’ve laid out suggesting we can do this with linear algebra, and indeed we can! We want to form a <strong>vector</strong> of our estimates: <span class="math inline">\mathbf{\hat{y}}</span> which of size <span class="math inline">(N \times 1)</span>. To do so, we need to calculate the following operation:</p>
<p><span class="math display">
\begin{bmatrix}
    \mathbf{w}^T\mathbf{x}_i \\
    \mathbf{w}^T\mathbf{x}_2 \\
    \mathbf{w}^T\mathbf{x}_i \\
    \mathbf{w}^T\mathbf{x}_N \\
\end{bmatrix}
</span></p>
<p>This is exactly the result of a <strong>matrix-vector</strong> product of our dataset matrix <span class="math inline">X</span>, with our weight vector <span class="math inline">\mathbf{w}</span>!</p>
<p><span class="math display">
X\mathbf{w} =
\begin{bmatrix}
    \mathbf{w}^T\mathbf{x}_i \\
    \mathbf{w}^T\mathbf{x}_2 \\
    \mathbf{w}^T\mathbf{x}_i \\
    \mathbf{w}^T\mathbf{x}_N \\
\end{bmatrix}
</span></p>
<p>We can quickly verify that sizes indeed work out: <span class="math display">
\underbrace{X}_{(N \times 2)} \underbrace{\mathbf{w}}_{(2 \times 1)} =
\begin{bmatrix}
    \mathbf{w}^T\mathbf{x}_i \\
    \mathbf{w}^T\mathbf{x}_2 \\
    \mathbf{w}^T\mathbf{x}_i \\
    \mathbf{w}^T\mathbf{x}_N \\
\end{bmatrix}
</span></p>
<p>So now we have a formula, which lets us a single weight vector <span class="math inline">\mathbf{w}</span> and apply it to our entire dataset at once, to generate all of our estimates at once:</p>
<p><span class="math display"> X\mathbf{w} = \mathbf{\hat{y}}</span></p>
<hr>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>Lets take a second to talk about our dataset <strong>matrix</strong> <span class="math inline">X</span>. Above, we did the following to look at our dataset:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>At first glance, we don’t see any matrix here! Our <span class="math inline">x</span>’s are only 1 dimensional! Well, recall the convention that <span class="math inline">x_0=1</span>! So our dataset matrix is actually:</p>
<p><span class="math display">
X =
\begin{bmatrix}
1 &amp; x_1 \\
\ldots \\
1 &amp; x_i \\
\ldots \\
1 &amp; x_N
\end{bmatrix}
</span></p>
<p>where now <span class="math inline">i</span> is indexing from <span class="math inline">1,\ldots,N</span> - the size of our dataset. So lets go ahead and form it:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.ones((N,<span class="dv">2</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>X[:,<span class="dv">1</span>] <span class="op">=</span> x</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>X[<span class="dv">0</span>:<span class="dv">5</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([[ 1.        , -2.        ],
       [ 1.        , -1.95959596],
       [ 1.        , -1.91919192],
       [ 1.        , -1.87878788],
       [ 1.        , -1.83838384]])</code></pre>
</div>
</div>
<p>Now lets assemble our output vector:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y[:,<span class="va">None</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or y = y[:, np.newaxis]</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y.shape)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">0</span>:<span class="dv">5</span>,:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(100, 1)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>array([[-4.54437285],
       [-6.75779464],
       [-5.2087573 ],
       [-4.73313111],
       [-5.35793348]])</code></pre>
</div>
</div>
<section id="broadcasting" class="level4">
<h4 class="anchored" data-anchor-id="broadcasting">Broadcasting</h4>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Note</strong>: Its important for this vector to be an actual column vector (i.e.&nbsp;have its last dimension be <code>1</code>. Otherwise, a somewhat non-intuitive (unless you are familiar with and love numpy’s <strong>array broadcasting</strong> rules) broadcast happens. As an example:</p>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.random.rand(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>a.shape,a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>((3, 1),
 array([[0.09708829],
        [0.71928046],
        [0.79971499]]))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.random.rand(<span class="dv">3</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>b.shape,b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>((3,), array([0.46586583, 0.67176581, 0.4836771 ]))</code></pre>
</div>
</div>
<p>As we can see, at first glance these are both vectors of length 3…right? Lets substract them and see what happens:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> a<span class="op">-</span>b</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>result.shape,result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>((3, 3),
 array([[-0.36877755, -0.57467753, -0.38658881],
        [ 0.25341463,  0.04751465,  0.23560336],
        [ 0.33384915,  0.12794917,  0.31603789]]))</code></pre>
</div>
</div>
<div class="info">
<p><strong>You-should-know</strong>: This is <strong>not</strong> what you might except as a <em>mathematician</em>, but <strong>you must familiarize yourself with and come to love broadcasting as a Data scientist!</strong></p>
</div>
<p>To prevent having to squeeze things after a dot product, I think its just easier to ensure that <code>y</code> has the proper dimension.</p>
<hr>
</section>
</section>
<section id="cost-function" class="level2">
<h2 class="anchored" data-anchor-id="cost-function">Cost function</h2>
<p>Now that we understand our model, we can talk about how exactly we’re going to <strong>learn</strong> what the <strong>best</strong> weights should be.</p>
<p>In order to <em>learn</em>, we need a measure of <strong>distance</strong> or <strong>cost</strong> or <strong>quality</strong> of our current guess, which tells us how good/bad were doing so far. As we’ve discussed in class, a natural loss for regression is the regression loss, or the <strong>mean squared error (MSE)</strong> loss:</p>
<p><span class="math display">
C(\mathbf{w}) = \underbrace{\frac{1}{N} \sum_{i=1}^N}_{\text{mean}} \;\; \underbrace{(\hat{y}_i-y_i)^2}_{\text{squared error}}
</span></p>
<div class="info">
<p><strong>Pause and Ponder:</strong> Often times, you’ll see this cost function defined with a <span class="math inline">\frac{1}{2N}</span> instead of just <span class="math inline">\frac{1}{N}</span>. * <strong>Why</strong> do you think that is? * Do you think that will affect our learning procedure?</p>
</div>
<hr>
<p>The cost function given above looks a bit strange at first. I’ve written it as a function of our weight vector <span class="math inline">\mathbf{w}</span>, but <span class="math inline">\mathbf{w}</span> does not appear on the right hand side, but <span class="math inline">\hat{y}_i</span> does. Recall, that all of our individual <span class="math inline">\hat{y}_i</span> are generated from one weight vector. We could also rewrite the above as:</p>
<p><span class="math display">
C(\mathbf{w}) = \frac{1}{N} \sum_{i=1}^N \;\; (\mathbf{w}^T\mathbf{x}_i-y_i)^2
</span></p>
<p>So, we can now calculate this for out entire dataset! Lets do so below, for a random weight vector:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>w_rand <span class="op">=</span> np.random.random(size<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>w_rand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>array([[0.51374312],
       [0.57865621]])</code></pre>
</div>
</div>
<p>Now, lets loop through all <span class="math inline">N</span> data points and calculate this cost:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    x_i <span class="op">=</span> X[i,:]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    y_hat_i <span class="op">=</span> w_rand.T.dot(x_i)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    error_i <span class="op">=</span> y_hat_i <span class="op">-</span> y[i]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    cost <span class="op">=</span> cost <span class="op">+</span> error_i<span class="op">**</span><span class="dv">2</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> np.squeeze(cost<span class="op">/</span>N)  <span class="co"># the squeeze just gets rid of empty dimensions</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array(10.13753696)</code></pre>
</div>
</div>
<p>So this is our cost for a random weight vector. Lets define this as a fuction, so we can <strong>plot it over the space of <span class="math inline">w_0</span> and <span class="math inline">w_1</span>.</strong></p>
<div class="info">
<p><strong>Recall</strong>: this is the same as plotting the cost over the sapce of <strong>intercepts</strong> (<span class="math inline">w_0</span>) and <strong>slopes</strong> (<span class="math inline">w_1</span>)</p>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost(dataset,w):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> dataset.shape[<span class="dv">0</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        x_i <span class="op">=</span> dataset[i,:]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        y_hat_i <span class="op">=</span> w.T.dot(x_i)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        error_i <span class="op">=</span> y_hat_i <span class="op">-</span> y[i]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        cost <span class="op">=</span> cost <span class="op">+</span> error_i<span class="op">**</span><span class="dv">2</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.squeeze(cost<span class="op">/</span>N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets verify it works as we expect:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cost(X,w_rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>array(10.13753696)</code></pre>
</div>
</div>
<p>Perfect - lets now calculate our costs over the entire grid of potential slope and interceps:</p>
<p><strong>Note:</strong> The below is slow! But right now Im purposefully not vectorizing anything so it follows our intuition</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>len_w <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,len_w) <span class="co"># possible bias</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="dv">2</span>,<span class="dv">4</span>,len_w) <span class="co"># possible slopes</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> np.zeros((len_w,len_w))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(len_w):</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(len_w):</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        current_w <span class="op">=</span> np.asarray([w_0[i],w_1[j]])</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        costs[i,j] <span class="op">=</span> cost(X,current_w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wow! That took a while!</p>
<p>Now lets actually plot our cost surface along with a contour plot and the real minimum highlighted.</p>
<p>Note: you can skip the plotting details in this cell if you want.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>W_0, W_1 <span class="op">=</span> np.meshgrid(w_0, w_1)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Costs <span class="op">=</span> costs.reshape(W_0.shape)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>,projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">'cost'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ax.set_zlim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>ax.plot_surface(W_0, W_1, Costs,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>ax.contour(W_0, W_1, Costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">15</span>)<span class="op">;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="dv">1</span>,<span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">30</span>,color<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span>   <span class="co"># plot the known minimum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>So now we can actually see our cost surface as a function of our weight vector!</p>
<div class="info">
<p><strong>Pause and Ponder</strong>: Why is it that our true minimum shown in red, is <strong>not</strong> the minimum of our cost surface?</p>
</div>
<hr>
<section id="vectorized-cost-function" class="level4">
<h4 class="anchored" data-anchor-id="vectorized-cost-function">Vectorized Cost function</h4>
<p>We’ve come a long way so far, and we haven’t even learned anything! Before we move forward with that, lets <strong>vectorize</strong> our cost function.</p>
<div class="info">
<p><strong>Vectorization</strong> is often used to mean “rewrite in linear-algebraic notation”. This results in much faster code, since our numerical libraries have been optimized to operate on vectors/matrices and not for loops!</p>
</div>
<p>The function we just explored was:</p>
<p><span class="math display">
C(\mathbf{w}) = \frac{1}{N} \sum_{i=1}^N \;\; (\mathbf{w}^T\mathbf{x}_i-y_i)^2
</span></p>
<p>Before we proceed, lets take a quick asside to remind ourselves of the definition of the <strong><span class="math inline">\mathcal{L}_2</span>-norm</strong>:</p>
<div class="info">
<p>The <span class="math inline">\mathcal{L}_2</span>-norm of a vector <span class="math inline">\mathbf{a}</span> is:</p>
<p><span class="math display">
    \|\mathbf{a}\|_2 = \sqrt{a_1^2 + \ldots + a_n^2}
</span></p>
<p>We are often interested in the <strong>squared</strong> <span class="math inline">\mathcal{L}_2</span>-norm of a vector:</p>
<p><span class="math display">
    \|\mathbf{a}\|_2^2 = a_1^2 + \ldots + a_n^2
</span></p>
<p>We are also often interested in the squared <span class="math inline">\mathcal{L}_2</span>-norm of some kind of <strong>distance</strong> or <strong>error</strong> vector:</p>
<p><span class="math display">
    \|\mathbf{a}-\mathbf{b}\|_2^2 = (a_1-b_1)^2 + \ldots + (a_n-b_n)^2
</span></p>
</div>
<p>Now, lets use the fact that we can calculate our all our <span class="math inline">\hat{y}_i</span> at once and rewrite the cost in terms of the <span class="math inline">\mathcal{L}_2</span>-norm we just defined above</p>
<p><span class="math display">
\begin{align}
    C(\mathbf{w}) &amp;= \frac{1}{N} \| X\mathbf{w} - \mathbf{y} \|_2^2 \\
                  &amp;= \frac{1}{N} \| \mathbf{\hat{y}} - \mathbf{y} \|^2_2 \\
                  &amp;= \frac{1}{N} \left[ (\hat{y}_1 - y_1)^2 + \ldots + (\hat{y}_N-y_N)^2 \right]
\end{align}
</span></p>
<p>which is exactly what we want! So now we can calculate our cost as:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> np.linalg.norm(X.dot(w_rand)<span class="op">-</span>y)<span class="op">**</span><span class="dv">2</span><span class="op">/</span>X.shape[<span class="dv">0</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>cost</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>10.137536961317753</code></pre>
</div>
</div>
<p>This is exactly what we had above! Lets now re-define our vectorized cost function:</p>
<div class="cell" data-code_folding="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost(X, y, w):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.linalg.norm(X.dot(w)<span class="op">-</span>y,axis<span class="op">=</span><span class="dv">0</span>)<span class="op">**</span><span class="dv">2</span><span class="op">/</span>X.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets re-calculate our costs over a grid and replot it!</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>len_w <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,len_w)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="dv">2</span>,<span class="dv">4</span>,len_w)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>W_0, W_1 <span class="op">=</span> np.meshgrid(w_0, w_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>W_0.shape, W_1.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>((100, 100), (100, 100))</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and reshape mesh for calculation</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="info">
<p>Pay attention to how much faster this cell is than the double for loop above!</p>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cost(X,y,wgrid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>array([3.78144022, 3.74421484, 3.7078057 , ..., 3.3598471 , 3.40179731,
       3.44456376])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate on grid, and reshape back for plotting</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wow! That was <strong>fast!</strong> Now lets plot it!</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>,projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ax.set_zlabel(<span class="st">'cost'</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ax.set_zlim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>ax.plot_surface(W_0, W_1, costs,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>ax.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>ax.scatter(<span class="dv">1</span>,<span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">30</span>,color<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span>   <span class="co"># plot the known minimum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It works!</p>
<hr>
</section>
</section>
<section id="gradient-of-our-cost" class="level2">
<h2 class="anchored" data-anchor-id="gradient-of-our-cost">Gradient of our cost</h2>
<p>Now, we can really get going! Lets start by giving the <strong>gradient</strong> of this cost function (recall: we calculated this in class!). Lets also call this cost what it is, the <strong>in-sample error</strong>:</p>
<p><span class="math display">
E_{in}(\mathbf{w}) = C(\mathbf{w}) = \frac{1}{N} \| X\mathbf{w} - \mathbf{y} \|_2^2
</span></p>
<p>So its gradient is:</p>
<p><span class="math display">
\begin{align}
    \nabla E_{in}(\mathbf{w}) &amp;= \frac{2}{N}(X^TX\mathbf{w} - X^T\mathbf{y})
\end{align}
</span></p>
<p><strong>Recall</strong> an earlier pause-and-ponder where I asked about the definition of the cost function with a <span class="math inline">\frac{1}{2N}</span> vs <span class="math inline">\frac{1}{N}</span>!</p>
<p>Lets also note an underappreciated property of this function which will become relevant later:</p>
<div class="info">
<p><strong>Pause-and-ponder:</strong> This gradient is a function of our <strong>entire dataset</strong>! This means that at each point in weight space, to calculate the gradient we need to proces our entire dataset!</p>
</div>
<p>Keep that point in mind as we will come back to it later!</p>
<hr>
</section>
<section id="gradient-descent-for-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="gradient-descent-for-linear-regression">Gradient Descent for Linear Regression</h2>
<p>Now we have all the pieces together to start talking about and implement gradient descent! Recall the <strong>weight update</strong> equation we gave in class:</p>
<p><span class="math display">\boldsymbol{w}(t+1) = \boldsymbol{w}(t) + \eta \hat{\boldsymbol{v}}</span></p>
<p>where <span class="math inline">\hat{\boldsymbol{v}}</span> is the <strong>unit-vector</strong> in the <strong>direction</strong> we want to step.</p>
<p>For <strong>gradient descent</strong>, this becomes:</p>
<div class="info">
<p>The <strong>gradient descent algorithm</strong> is just a step in the <strong>direction</strong> of the <strong>negative gradient</strong>: <span class="math display">\boldsymbol{w}(t+1) = \boldsymbol{w}(t) -\eta\cdot\nabla f(\boldsymbol{w}(t))</span></p>
</div>
<hr>
<p>Lets look at this for special case of linear regression, by starting with the weight update equation:</p>
<p><span class="math display">
\mathbf{w}_{t+1} = \mathbf{w}_t - \eta \nabla E_{in}
</span></p>
<p>Lets move <span class="math inline">\mathbf{w}_t</span> to the other side so we can focus on the <strong>change</strong> in our weights:</p>
<p><span class="math display">
\begin{align}
    \Delta \mathbf{w} &amp;= \mathbf{w}_{t+1} - \mathbf{w}_t \\
                      &amp;= - \eta \nabla E_{in} \\
                      &amp;= - \eta \frac{2}{N} (X^TX\mathbf{w} - X^T\mathbf{y})
\end{align}
</span></p>
<p>We can now write the GD algorithm for <strong>linear regression</strong>:</p>
<div class="info">
<p>The gradient descent algorithm for linear regression is:</p>
<p><span class="math display">
\begin{align}
\boldsymbol{w}(t+1) &amp;= \boldsymbol{w}(t) -\eta \nabla E_{in} \\
                    &amp;= - \eta \frac{2}{N} (X^TX\mathbf{w} - X^T\mathbf{y})
\end{align}
</span></p>
</div>
<p>Lets first define a function to calculate this gradient:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost_grad(X,y,w):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> X.shape[<span class="dv">0</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">2</span><span class="op">/</span>N)<span class="op">*</span>(X.T.dot(X).dot(w)<span class="op">-</span>X.T.dot(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Out of curiosity, lets visualize it!</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>len_w <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,len_w)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="dv">2</span>,<span class="dv">4</span>,len_w)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>W_0, W_1 <span class="op">=</span> np.meshgrid(w_0, w_1)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and reshape mesh for calculation</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate on grid, and reshape back for plotting</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate grad on grid, and reshape back for plotting</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>grad_costs <span class="op">=</span> cost_grad(X,y,wgrid).reshape(<span class="dv">2</span>,W_0.shape[<span class="dv">0</span>],W_0.shape[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">131</span>,projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>ax1.set_zlabel(<span class="st">'cost'</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>ax1.set_zlim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Cost'</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ax1.plot_surface(W_0, W_1, costs,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>ax1.scatter(<span class="dv">1</span>,<span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">30</span>,color<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span>   <span class="co"># plot the known minimum</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">132</span>, projection<span class="op">=</span><span class="st">'3d'</span>, sharex <span class="op">=</span> ax1, sharey<span class="op">=</span>ax1)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>ax2.set_zlabel(<span class="st">'grad'</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Gradient wrt w_0'</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>ax2.plot_surface(W_0, W_1, grad_costs[<span class="dv">0</span>,:],cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>ax2.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>ax2.scatter(<span class="dv">1</span>,<span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">30</span>,color<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span>   <span class="co"># plot the known minimum</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> plt.subplot(<span class="dv">133</span>, projection<span class="op">=</span><span class="st">'3d'</span>, sharex <span class="op">=</span> ax1, sharey<span class="op">=</span>ax1)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>ax3.set_zlabel(<span class="st">'grad'</span>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Gradient wrt w_1'</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>ax3.plot_surface(W_0, W_1, grad_costs[<span class="dv">1</span>,:],cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>ax3.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>ax3.scatter(<span class="dv">1</span>,<span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">30</span>,color<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span>   <span class="co"># plot the known minimum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What does this mean? 🧐 Think about this!</p>
</div>
<hr>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<p>Lets actually implement our weight updates now!</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient_descent(dataset, labels, w_init<span class="op">=</span><span class="va">None</span>, eta<span class="op">=</span><span class="va">None</span>, max_iter<span class="op">=</span><span class="dv">300</span>, quiet<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w_init <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>        w_init <span class="op">=</span> np.random.rand(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> eta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up initial point sizes:</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> np.asarray(w_init).reshape(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># gradient descent params</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">0.001</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    delta_w <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save weights and costs along path</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    wPath <span class="op">=</span> [w_init]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    cPath <span class="op">=</span> [cost(dataset,labels,w_init)]</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take first step</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    w_old <span class="op">=</span> w_init</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># perform GD</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># check to see if you should terminate</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> iterations <span class="op">&gt;</span> max_iter:</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> quiet: <span class="bu">print</span>(<span class="st">"terminating GD after max iter:"</span>,max_iter)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> delta_w <span class="op">&lt;</span> delta:</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> quiet: <span class="bu">print</span>(<span class="ss">f"terminating GD after </span><span class="sc">{</span>iterations<span class="sc">}</span><span class="ss"> iterations with weight change of </span><span class="sc">{</span>delta<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># update your weights</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># STEP 1 </span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>        w_new <span class="op">=</span> w_old <span class="op">-</span> eta<span class="op">*</span> cost_grad(dataset,labels,w_old)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># update paths</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>        wPath.append(w_new)</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>        cPath.append(cost(dataset,labels,w_new))</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># update iteration and weight change</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>        iterations <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>        delta_w <span class="op">=</span> np.linalg.norm(w_new <span class="op">-</span> w_old)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># STEP 2</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># make your previous new weights the current weights</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>        w_old <span class="op">=</span> w_new</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up path variables</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>    wPath <span class="op">=</span> np.squeeze(np.asarray(wPath))</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>    cPath <span class="op">=</span> np.squeeze(np.asarray(cPath))</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w_new, wPath, cPath</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>w_gd, wPath_gd, cPath_gd <span class="op">=</span> gradient_descent(X, y, [<span class="fl">0.25</span>,<span class="fl">2.4</span>], eta <span class="op">=</span> <span class="fl">0.2</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>w_gd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating GD after 12 iterations with weight change of 0.001.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>array([[0.92994594],
       [3.11226582]])</code></pre>
</div>
</div>
<hr>
</section>
<section id="plot-path" class="level3">
<h3 class="anchored" data-anchor-id="plot-path">Plot Path</h3>
<p>Now lets plot the <strong>path</strong> GD took!</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>len_w <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,len_w)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="dv">2</span>,<span class="dv">4</span>,len_w)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>W_0, W_1 <span class="op">=</span> np.meshgrid(w_0, w_1)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and reshape mesh for calculation</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate on grid, and reshape back for plotting</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">121</span>,projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>ax1.set_zlabel(<span class="st">'cost'</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>ax1.set_zlim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"cost surface"</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>ax1.scatter(wPath_gd[:,<span class="dv">0</span>],wPath_gd[:,<span class="dv">1</span>],<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">10</span>,c<span class="op">=</span>cPath_gd)<span class="op">;</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>ax1.plot_surface(W_0, W_1, costs,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">10</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">122</span>)<span class="op">;</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"Cost during GD"</span>)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">"Iteration"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Lets define a quick plotting function to make it easier to re-use:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_path(wPath,cPath,colorby<span class="op">=</span><span class="st">'cost'</span>):</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> colorby <span class="op">==</span> <span class="st">'cost'</span>:</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>        colorer <span class="op">=</span> cPath</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        colorer <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(wPath))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plotting</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    len_w <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    w_0 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,len_w)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    w_1 <span class="op">=</span> np.linspace(<span class="dv">2</span>,<span class="dv">4</span>,len_w)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    W_0, W_1 <span class="op">=</span> np.meshgrid(w_0, w_1)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># combine and reshape mesh for calculation</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate on grid, and reshape back for plotting</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">121</span>,projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    ax1.set_zlabel(<span class="st">'cost'</span>)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    ax1.set_zlim([<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>])</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    ax1.scatter(wPath[:,<span class="dv">0</span>],wPath[:,<span class="dv">1</span>],<span class="op">-</span><span class="dv">2</span>,s<span class="op">=</span><span class="dv">10</span>,c<span class="op">=</span>colorer,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    ax1.plot_surface(W_0, W_1, costs,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>, offset<span class="op">=-</span><span class="dv">2</span>,levels<span class="op">=</span><span class="dv">10</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">122</span>)<span class="op">;</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    ax2.plot(cPath)<span class="op">;</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">"Cost during training"</span>)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">"Iteration"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Go back, and try rerunning gradient descent with different initial values and plot:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>_,wPath_gd,cPath_gd <span class="op">=</span> gradient_descent(X,y,[<span class="fl">1.9</span>,<span class="fl">3.9</span>])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_gd,cPath_gd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating GD after 151 iterations with weight change of 0.001.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact, interactive, fixed, interact_manual, FloatSlider</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># @interact(w_0=(0,2,0.1), w_1=(2,4,0.1))</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interactive_gd(w_0,w_1):</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    _,wPath_gd,cPath_gd <span class="op">=</span> gradient_descent(X,y,[w_0,w_1])</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    plot_path(wPath_gd,cPath_gd)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>interact(interactive_gd, w_0<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="dv">0</span>,<span class="bu">max</span><span class="op">=</span><span class="dv">2</span>,step<span class="op">=</span><span class="fl">0.1</span>,continous_update<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                         w_1<span class="op">=</span>FloatSlider(<span class="bu">min</span><span class="op">=</span><span class="dv">2</span>,<span class="bu">max</span><span class="op">=</span><span class="dv">4</span>,step<span class="op">=</span><span class="fl">0.1</span>,continous_update<span class="op">=</span><span class="va">False</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b9664bb827a04517b8df3e60518abc3a","version_major":2,"version_minor":0}
</script>
</div>
</div>
<p>Ok. Now we have should have a much better grasp of Gradient Descent for Linear Regression!</p>
</section>
</section>
<section id="multivarite-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="multivarite-linear-regression">Multivarite Linear Regression</h2>
<p>The best part of the formulism above, is that it now works for higher order models! For example, lets run the same analysis as above, except not we are tring to fit a 3rd-order polynomial:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">4</span><span class="op">*</span>x<span class="op">**</span><span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>x <span class="op">-</span> <span class="dv">4</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">100</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> f(x) <span class="op">+</span> np.random.randn(<span class="bu">len</span>(x))<span class="op">*</span><span class="dv">5</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x,f(x),<span class="st">'--r'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The model we are trying to fit here can now be written as:</p>
<p><span class="math display">
h(\mathbf{w}) = w_0 + w_1x + w_2x^2 + w_3x^3
</span></p>
<p>So just like for a line, we were learning 2 parameters, for a 3-rd order polynomial we are learning 4:</p>
<p><span class="math display">
h(\mathbf{w}) = \mathbf{w}^T\mathbf{x}
</span></p>
<p>For</p>
<p><span class="math display">
\mathbf{w} =
\begin{bmatrix}
w_0 \\ w_1 \\ w_2 \\ w_3
\end{bmatrix},
\;\;\quad\;\;
\mathbf{x} =
\begin{bmatrix}
1 \\ x \\ x^2 \\ x^3
\end{bmatrix}
</span></p>
<p>Lets form our dataset/design matrix as above by stacking:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.hstack((x[:,np.newaxis]<span class="op">*</span><span class="dv">0</span><span class="op">+</span><span class="dv">1</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>               x[:,np.newaxis], </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>               x[:,np.newaxis]<span class="op">**</span><span class="dv">2</span>, </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>               x[:,np.newaxis]<span class="op">**</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So now each <strong>row</strong> of <span class="math inline">X</span> is a sample of our dataset, and each <strong>column</strong> is a dimension:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"sample:"</span>,X[<span class="dv">1</span>,:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sample: [ 1.         -1.95959596  3.84001632 -7.52488047]</code></pre>
</div>
</div>
<p>Lets also redefine our <span class="math inline">y</span>’s as a column vector:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> y[:,np.newaxis]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>y.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>(100, 1)</code></pre>
</div>
</div>
<p>Because of how we defined our <code>cost</code> and <code>cost_grad</code> functions, we should be able to use them <strong>without modification!</strong>. Lets calculate the cost on a random 4 dimensional vector:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>w_rand <span class="op">=</span> np.random.rand(<span class="dv">4</span>,<span class="dv">1</span>)<span class="op">*</span><span class="dv">5</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>w_rand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>array([[4.40486757],
       [2.19318454],
       [2.83438899],
       [4.02340168]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>cost(X,y,w_rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>array([77.98811223])</code></pre>
</div>
</div>
<p>Perfect! Unfortunately, we can’t easily visualize it, so lets instead plot the GD procedure as the polynomial we are fitting:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>w_gd,wPath_gd,cPath_gd <span class="op">=</span> gradient_descent(X,y)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>w_gd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating GD after max iter: 300</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>array([[-3.4482133 ],
       [ 3.50132037],
       [ 3.62600224],
       [ 4.17202869]])</code></pre>
</div>
</div>
<p>Recall, this weight vector now <strong>defines a polynomial!</strong>. Lets plot the polynomial given by our final weight vector:</p>
<p>Note: <code>poly1d</code> expects the coefs in decreasing order, so we have to reverse our weight vector:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> np.flip(np.squeeze(w_gd))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>poly_fin <span class="op">=</span> np.poly1d(coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>poly_fin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>poly1d([ 4.17202869,  3.62600224,  3.50132037, -3.4482133 ])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>ax1.scatter(x,y)<span class="op">;</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,poly_fin(x),<span class="st">'r'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Not bad! Lets plot the <strong>path</strong> that GD took, in terms of our polynomials!</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> regenerate_anim:</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    ax1.scatter(x,y)<span class="op">;</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    line, <span class="op">=</span> ax1.plot([],[],<span class="st">'--r'</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> animate(i):</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>        coefs <span class="op">=</span> np.flip(np.squeeze(wPath_gd[i]))</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>        poly_fin <span class="op">=</span> np.poly1d(coefs)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>        line.set_data(x,poly_fin(x))<span class="op">;</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>        ax1.set_title(<span class="st">'Iteration: </span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%.2f</span><span class="st"> x^3 + </span><span class="sc">%.2f</span><span class="st"> x^2 + </span><span class="sc">%.2f</span><span class="st"> x + </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> (i, coefs[<span class="dv">0</span>], coefs[<span class="dv">1</span>], coefs[<span class="dv">2</span>], coefs[<span class="dv">3</span>]))</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> line</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, animate, frames<span class="op">=</span><span class="bu">len</span>(wPath_gd), interval<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'multi_lin_reg.mp4'</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'multi_lin_reg.mp4'</span>,width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<video src="multi_lin_reg.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<hr>
</section>
</section>
<section id="stochastic-gradient-descent" class="level1">
<h1>Stochastic Gradient Descent</h1>
<p>We just got done learning about Gradient Descent and implemented it for a multivariate linear regression. Lets restate a pause-and-ponder point I gave above here again:</p>
<div class="info">
<p><strong>Pause-and-ponder:</strong> Gradient descent, as given above, is a function of our <strong>entire dataset</strong>! This means that at each point in weight space, to calculate the gradient we need to proces our entire dataset!</p>
</div>
<p>This is actually called <strong>Batch Gradient Descent</strong>, because it operates on the entire <strong>batch</strong> of data at once. We have to calculate the gradient <strong>at every point in our dataset</strong> and average them all together everytime. If our dataset is massive, this quickly becomes impractical!</p>
<p>So, at the other end of Batch GD is Stochastic Gradient Descent (SGD), which calculates the gradient at just <strong>one point</strong>!</p>
<div class="info">
<p><strong>Note</strong>: <strong>SGD</strong> as defined here works on just 1 sample. <strong>Mini-batch</strong>, as we will see below, works on mini-batches of our dataset. Often, when people say <strong>SGD</strong> they mean <strong>mini-batch</strong>, or <strong>mini-batch-SGD</strong>.</p>
</div>
<p>That is clearly an <strong>estimate</strong> for our gradient, but imagine just how <strong>noisy</strong> it must be!</p>
<p>Lets remind ourselves about our <code>cost</code> and <code>cost_grad</code> implementations by inspecting their source:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inspect.getsource(cost))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inspect.getsource(cost_grad))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def cost(X, y, w):
    return np.linalg.norm(X.dot(w)-y,axis=0)**2/X.shape[0]

def cost_grad(X,y,w):
    N = X.shape[0]
    return (2/N)*(X.T.dot(X).dot(w)-X.T.dot(y))
</code></pre>
</div>
</div>
<p>Note, we didn’t redefine any new functions here, we just printed their original source code as defined above.</p>
<section id="sgd-cost" class="level3">
<h3 class="anchored" data-anchor-id="sgd-cost">SGD Cost</h3>
<p>So we see that they are indeed in terms of the <strong>entire</strong> dataset. Lets define new versions here, specifically for SGD.</p>
<p>Recall for GD, the cost was:</p>
<p><span class="math display">
C(\mathbf{w})_{gd} = \frac{1}{N} \sum_{i=1}^N \;\; (\mathbf{w}^T\mathbf{x}_i-y_i)^2
</span></p>
<p>Lets rewrite it to make it a bit more explicit:</p>
<p><span class="math display">
C(\mathbf{w})_{gd} = \frac{1}{N} \sum_{i=1}^N \; \color{red}{C_i}(\mathbf{w})
</span></p>
<p>So we see in GD, were evaluating a <strong>point-wise cost</strong> on our entire dataset. In SGD, we only want to evaluate it on <strong>one-point</strong>. So lets write out the cost, and emphasize the dependence on 1 data point:</p>
<p><span class="math display">
\begin{align}
C(\mathbf{w},\color{red}{x_i,y_i})_{sgd} &amp;= \color{red}{C_i}(\mathbf{w})\\
                    &amp;= (\mathbf{w}^T\color{red}{\mathbf{x}_i-y_i})^2
\end{align}
</span></p>
<p>Now we can implement this cost, and its gradient:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost_sgd(x_i, y_i, w):</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (w.T.dot(x_i) <span class="op">-</span> y_i)<span class="op">**</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost_grad_sgd(x_i, y_i, w):</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span><span class="op">*</span>x_i<span class="op">*</span>(w.T.dot(x_i)<span class="op">-</span>y_i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="implementation-1" class="level2">
<h2 class="anchored" data-anchor-id="implementation-1">Implementation</h2>
<p>Now we are ready to describe the full SGD algorithm. Since we are estimating our gradient at each training sample, we now define a new term:</p>
<div class="info">
<p><strong>Def</strong>: An <strong>epoch</strong> is a full run of a learning procedure through the entire training set.</p>
</div>
<p>So we can (and often must) take multiple <strong>epochs</strong> of training. The tradeoff is that each iteration is now must faster!</p>
<p>Now we can describe the algorithm as:</p>
<div class="info">
<p>The <strong>SGD algorithm</strong> is:</p>
<p>for each <code>epoch</code>:</p>
<ul>
<li>Randomly shuffle the <code>training_set</code></li>
<li>for each <code>sample</code> in <code>training_set</code>
<ul>
<li><span class="math inline">w_{t+1} = w_{t} - \eta \; \nabla C_i(\mathbf{w}_t)</span></li>
</ul></li>
</ul>
</div>
<p>Lets implement that below</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.arange(<span class="dv">9</span>).reshape(<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.random.permutation(<span class="dv">3</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>array([1, 2, 0])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>A[indices]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>array([[3, 4, 5],
       [6, 7, 8],
       [0, 1, 2]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sgd(dataset, labels, w_init<span class="op">=</span><span class="va">None</span>, eta<span class="op">=</span><span class="va">None</span>, epochs<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w_init <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>        w_init <span class="op">=</span> np.random.rand(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> eta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataset</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> dataset.shape[<span class="dv">0</span>]</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> dataset.shape[<span class="dv">1</span>]</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up initial point sizes:</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> np.asarray(w_init).reshape(d,<span class="dv">1</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SGD params - Note their difference from GD</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">1e-10</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    max_iter <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialzie loop variables</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>    delta_w <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save weights and costs along path</span></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>    wPath <span class="op">=</span> [w_init]</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calc cost at that initial value</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.random.randint(N)</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>    x_i <span class="op">=</span> dataset[np.newaxis,idx,:].T</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>    y_i <span class="op">=</span> labels[idx,:]</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>    cPath <span class="op">=</span> [cost_sgd(x_i,y_i,w_init)]</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take first step</span></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>    w_old <span class="op">=</span> w_init</span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># epochs of training</span></span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shuffle the dataset - note we do this by shuffling indices</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a>        indices <span class="op">=</span> np.random.permutation(N)</span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>        shuffled_dataset <span class="op">=</span> dataset[indices,:]</span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>        shuffled_labels <span class="op">=</span> labels[indices,:]</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span><span class="al">NOTE</span><span class="co">: try commenting out this line above and seeing how it behaves</span></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for each sample</span></span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># np.newaxis is there to deal with the 1 for the row size</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>            curr_sample <span class="op">=</span> shuffled_dataset[i,:]</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>            curr_sample <span class="op">=</span> curr_sample[np.newaxis].T</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>            curr_label <span class="op">=</span> shuffled_labels[i,:]</span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update your weights with the grad at one sample</span></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>            grad <span class="op">=</span> cost_grad_sgd(curr_sample,curr_label,w_old)</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>            w_new <span class="op">=</span> w_old <span class="op">-</span> eta <span class="op">*</span> grad</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update paths</span></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a>            wPath.append(w_new)</span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>            cPath.append(cost_sgd(curr_sample,curr_label,w_new))</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># calculate weight change</span></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>            <span class="co"># </span><span class="al">NOTE</span><span class="co"> to me: ask a HW question here!! </span></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>            delta_w <span class="op">=</span> np.linalg.norm(w_new <span class="op">-</span> w_old)</span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make your previous new weights the current weights</span></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a>            w_old <span class="op">=</span> w_new</span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># at end of epoch, check to see if you should terminate</span></span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> delta_w <span class="op">&lt;</span> delta:</span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up path variables</span></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a>    wPath <span class="op">=</span> np.squeeze(np.asarray(wPath))</span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a>    cPath <span class="op">=</span> np.squeeze(np.asarray(cPath))</span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"terminating SGD after </span><span class="sc">{</span>epoch<span class="sc">}</span><span class="ss"> epochs with weight change of </span><span class="sc">{</span>delta_w<span class="sc">:0.5f}</span><span class="ss">."</span>)</span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w_new, wPath, cPath</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="sgd-on-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="sgd-on-linear-regression">SGD on Linear Regression</h2>
<p>Lets re-define our simple linear regression from above and see how we do. This time, lets make a function to make it easier to setup comparisons below:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lin_reg():</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(x):</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,N)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> f(x) <span class="op">+</span> np.random.randn(N) <span class="co"># our zero man gaussian noise</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.ones((N,<span class="dv">2</span>))</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    X[:,<span class="dv">1</span>] <span class="op">=</span> x</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> y[:,np.newaxis]</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x,X,y,f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> lin_reg()</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>[<span class="fl">0.75</span>,<span class="fl">2.5</span>],eta<span class="op">=</span><span class="fl">1e-2</span>,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>w_sgd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 99 epochs with weight change of 0.03233.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>array([[1.04826202],
       [3.13976719]])</code></pre>
</div>
</div>
<section id="plot" class="level3">
<h3 class="anchored" data-anchor-id="plot">Plot</h3>
<p>Lets plot it!</p>
<div class="cell" data-scrolled="true" data-execution_count="59">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>[<span class="fl">0.1</span>,<span class="dv">2</span>],eta<span class="op">=</span><span class="fl">1e-2</span>,epochs<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(w_sgd)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_sgd,cPath_sgd,colorby<span class="op">=</span><span class="st">'iter'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 9 epochs with weight change of 0.01851.
[[1.16979153]
 [3.05990881]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-60-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What do you notice about this procedure?</p>
</div>
<p>Go back and re-run this procedure with different values for your parameters of interest!</p>
</section>
<section id="comparison" class="level3">
<h3 class="anchored" data-anchor-id="comparison">Comparison</h3>
<p>Lets compare both of them!</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>w_init <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>w_gd,wPath_gd,cPath_gd <span class="op">=</span> gradient_descent(X,y,w_init<span class="op">=</span>w_init)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span><span class="fl">1e-3</span><span class="op">/</span><span class="dv">2</span>,epochs<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_gd,cPath_gd)<span class="op">;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_sgd,cPath_sgd)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating GD after 161 iterations with weight change of 0.001.
terminating SGD after 199 epochs with weight change of 0.00005.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-61-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-61-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Lets look at the contour plots:</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>num_points <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="fl">0.7</span>,<span class="fl">1.3</span>,num_points)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="fl">2.75</span>,<span class="fl">3.25</span>,num_points)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>W_0,W_1 <span class="op">=</span> np.meshgrid(w_0,w_1)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">121</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_0'</span>)<span class="op">;</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_1'</span>)<span class="op">;</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="fl">0.7</span>,<span class="fl">1.3</span>])</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="fl">2.75</span>,<span class="fl">3.25</span>])</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>ax1.scatter(wPath_gd[:,<span class="dv">0</span>],wPath_gd[:,<span class="dv">1</span>], s<span class="op">=</span><span class="dv">50</span>,c<span class="op">=</span>cPath_gd)<span class="op">;</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">122</span>, sharex<span class="op">=</span>ax1, sharey<span class="op">=</span>ax1)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>ax2.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>ax2.scatter(wPath_sgd[:,<span class="dv">0</span>],wPath_sgd[:,<span class="dv">1</span>], c<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(wPath_sgd)))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What do you notice?</p>
</div>
<hr>
</section>
</section>
<section id="sgd-on-polynomial-regression" class="level2">
<h2 class="anchored" data-anchor-id="sgd-on-polynomial-regression">SGD on Polynomial Regression</h2>
<p>As above, lets redefine our polynomial regression problem. This time, lets make it a function to make it easier to compare below.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> poly_reg():</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(x):</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">4</span><span class="op">*</span>x<span class="op">**</span><span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>x <span class="op">-</span> <span class="dv">4</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">100</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> f(x) <span class="op">+</span> np.random.randn(<span class="bu">len</span>(x))<span class="op">*</span><span class="dv">5</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.hstack((x[:,np.newaxis]<span class="op">*</span><span class="dv">0</span><span class="op">+</span><span class="dv">1</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>               x[:,np.newaxis], </span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>               x[:,np.newaxis]<span class="op">**</span><span class="dv">2</span>, </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>               x[:,np.newaxis]<span class="op">**</span><span class="dv">3</span>))</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> y[:,np.newaxis]</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x,X,y,f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> poly_reg()</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x,f(x),<span class="st">'--r'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now we can run them both and see!</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>w_init <span class="op">=</span> [<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>w_gd,wPath_gd,cPath_gd <span class="op">=</span> gradient_descent(X,y,w_init<span class="op">=</span>w_init)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span><span class="fl">1e-2</span>,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>w_gd,w_sgd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating GD after max iter: 300
terminating SGD after 99 epochs with weight change of 0.16115.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>(array([[-3.37519071],
        [ 2.35485563],
        [ 3.40590893],
        [ 4.0224176 ]]),
 array([[-4.26754354],
        [ 3.14637804],
        [ 3.39303763],
        [ 5.26249499]]))</code></pre>
</div>
</div>
</section>
<section id="plot-it" class="level2">
<h2 class="anchored" data-anchor-id="plot-it">Plot it</h2>
<p>Before we plot the path, lets plot the overall costs:</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">121</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">122</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_sgd)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>plt.plot(cPath_sgd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-68-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now we can plot the path:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> regenerate_anim:</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">121</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    ax1.scatter(x,y)<span class="op">;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">122</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    ax2.scatter(x,y)<span class="op">;</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    line1, <span class="op">=</span> ax1.plot([],[],<span class="st">'--r'</span>)</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    line2, <span class="op">=</span> ax2.plot([],[],<span class="st">'--r'</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>    num_frames <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>    gd_frames <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="bu">len</span>(wPath_gd)<span class="op">-</span><span class="dv">1</span>,num_frames).astype(<span class="bu">int</span>)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>    sgd_frames <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="bu">len</span>(wPath_sgd)<span class="op">-</span><span class="dv">1</span>,num_frames).astype(<span class="bu">int</span>)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># abs_cost_diff = np.abs(cPath_sgd[sgd_frames] - cPath_gd[gd_frames])</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # ax3 = fig.add_subplot(133)</span></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # ax3.plot(range(num_frames),abs_cost_diff)</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # scat3 = ax3.scatter([],[],s=100)</span></span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> animate(i):</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>        gd_frame <span class="op">=</span> gd_frames[i]</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>        sgd_frame <span class="op">=</span> sgd_frames[i]</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     abs_cost_diff[i] = np.abs(cPath_sgd[sgd_frame] - cPath_gd[gd_frame])</span></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>        coefs_gd <span class="op">=</span> np.flip(np.squeeze(wPath_gd[gd_frame]))</span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>        coefs_sgd <span class="op">=</span> np.flip(np.squeeze(wPath_sgd[sgd_frame]))</span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>        poly_gd <span class="op">=</span> np.poly1d(coefs_gd)</span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>        poly_sgd <span class="op">=</span> np.poly1d(coefs_sgd)</span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>        line1.set_data(x,poly_gd(x))<span class="op">;</span></span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a>        ax1.set_title(<span class="st">'GDIteration: </span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%.2f</span><span class="st"> x^3 + </span><span class="sc">%.2f</span><span class="st"> x^2 + </span><span class="sc">%.2f</span><span class="st"> x + </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> (i, coefs_gd[<span class="dv">0</span>], coefs_gd[<span class="dv">1</span>], coefs_gd[<span class="dv">2</span>], coefs_gd[<span class="dv">3</span>]))</span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>        line2.set_data(x,poly_sgd(x))<span class="op">;</span></span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'SGD Iteration: </span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%.2f</span><span class="st"> x^3 + </span><span class="sc">%.2f</span><span class="st"> x^2 + </span><span class="sc">%.2f</span><span class="st"> x + </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> (i, coefs_sgd[<span class="dv">0</span>], coefs_sgd[<span class="dv">1</span>], coefs_sgd[<span class="dv">2</span>], coefs_sgd[<span class="dv">3</span>]))</span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> line1, line2</span>
<span id="cb100-46"><a href="#cb100-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-47"><a href="#cb100-47" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb100-48"><a href="#cb100-48" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, animate, frames<span class="op">=</span>num_frames, interval<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb100-49"><a href="#cb100-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb100-50"><a href="#cb100-50" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'multi_lin_reg_sgd.mp4'</span>)</span>
<span id="cb100-51"><a href="#cb100-51" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'multi_lin_reg_sgd.mp4'</span>,width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<video src="multi_lin_reg_sgd.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder:</strong> What do you observe? Go back and mess around with the setup and compare!</p>
</div>
<p><strong>Note:</strong> Ask for a plot of the “error-in-each-dimension” like we discussed in class</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">121</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">122</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_sgd)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-70-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
</section>
<section id="mini-batch-gd" class="level1">
<h1>Mini-Batch GD</h1>
<p>So far we’ve seen GD, which uses all <span class="math inline">N</span>-many examples in <strong>each</strong> iteration, and SGD which uses <strong><span class="math inline">1</span> example</strong> per iteration. Well, right in between is <strong>mini-batch</strong> GD which uses a <strong><code>batch-size</code>-many</strong> examples per iteration!</p>
<p>Typically, this <code>batch_size</code> could be from <span class="math inline">2-512</span>, sticking to powers of two, in the real world depending on the size of the each example, how much memory you have, etc.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inspect.getsource(cost))</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inspect.getsource(cost_grad))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>def cost(X, y, w):
    return np.linalg.norm(X.dot(w)-y,axis=0)**2/X.shape[0]

def cost_grad(X,y,w):
    N = X.shape[0]
    return (2/N)*(X.T.dot(X).dot(w)-X.T.dot(y))
</code></pre>
</div>
</div>
<section id="implementation-2" class="level2">
<h2 class="anchored" data-anchor-id="implementation-2">Implementation</h2>
<p>The implementation of mini-batch GD is:</p>
<div class="info">
<p>The <strong>mini-batch GD algorithm</strong> is:</p>
<p>for each <code>epoch</code>:</p>
<ul>
<li>seperate your data into <code>N/batch_size</code>-many batches</li>
<li>for each <code>batch</code> in <code>batches</code>
<ul>
<li><span class="math inline">w_{t+1} = w_{t} - \eta \; \nabla C(\mathbf{w}_t,batch)</span></li>
</ul></li>
</ul>
</div>
<p>This looks familiar! And it should! This is exactly GD, if we only had <code>N/batch_size</code> many examples! So the only difference in this algorithm and GD is that here, we process less examples before taking a gradient step!</p>
<div class="cell" data-code_folding="[]" data-execution_count="70">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mini_batch_gd(dataset, labels, w_init<span class="op">=</span><span class="va">None</span>, eta<span class="op">=</span><span class="va">None</span>, batch_size<span class="op">=</span><span class="dv">10</span>, epochs<span class="op">=</span><span class="dv">5</span>, quiet<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w_init <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>        w_init <span class="op">=</span> np.random.rand(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> eta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataset</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> dataset.shape[<span class="dv">0</span>]</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> dataset.shape[<span class="dv">1</span>]</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculat our batches</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    num_batches <span class="op">=</span> <span class="bu">int</span>(N<span class="op">/</span>batch_size)</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up initial point sizes:</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> np.asarray(w_init).reshape(d,<span class="dv">1</span>)</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mini-batch params </span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>    delta_w <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>    iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save weights and costs along path</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>    wPath_mbgd <span class="op">=</span> []</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>    cPath_mbgd <span class="op">=</span> []</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>    cPath_mbgd_epoch <span class="op">=</span> []</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take the first step</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>    w_curr <span class="op">=</span> w_init</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># loop through all epochs</span></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># loop through all batches</span></span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> batch_num <span class="kw">in</span> <span class="bu">range</span>(num_batches):</span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current batch</span></span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>            batch_start <span class="op">=</span> batch_num<span class="op">*</span>batch_size</span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>            batch_end <span class="op">=</span> (batch_num<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>batch_size</span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>            batch <span class="op">=</span> dataset[batch_start:batch_end,:]</span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a>            batch_labels <span class="op">=</span> labels[batch_start:batch_end]</span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># run gradient descent on the batch! </span></span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a>            w_curr,_,_ <span class="op">=</span> gradient_descent(batch, batch_labels, w_init<span class="op">=</span>w_curr, eta<span class="op">=</span>eta, max_iter<span class="op">=</span><span class="dv">1</span>,quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb104-46"><a href="#cb104-46" aria-hidden="true" tabindex="-1"></a>            wPath_mbgd.append(w_curr)</span>
<span id="cb104-47"><a href="#cb104-47" aria-hidden="true" tabindex="-1"></a>            cPath_mbgd.append(cost(batch,batch_labels,w_curr))</span>
<span id="cb104-48"><a href="#cb104-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb104-49"><a href="#cb104-49" aria-hidden="true" tabindex="-1"></a>            <span class="co">#if not quiet: print(f"Batch:{batch_num+1}/{num_batches}, Loss:{cPath_mbgd[-1]}")</span></span>
<span id="cb104-50"><a href="#cb104-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb104-51"><a href="#cb104-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb104-52"><a href="#cb104-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> quiet: <span class="bu">print</span>(<span class="ss">f"Epoch:</span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>epochs<span class="sc">}</span><span class="ss">, Loss:</span><span class="sc">{</span>cPath_mbgd[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb104-53"><a href="#cb104-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-54"><a href="#cb104-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up path variables</span></span>
<span id="cb104-55"><a href="#cb104-55" aria-hidden="true" tabindex="-1"></a>    wPath_mbgd <span class="op">=</span> np.squeeze(np.asarray(wPath_mbgd))</span>
<span id="cb104-56"><a href="#cb104-56" aria-hidden="true" tabindex="-1"></a>    cPath_mbgd <span class="op">=</span> np.squeeze(np.asarray(cPath_mbgd))</span>
<span id="cb104-57"><a href="#cb104-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb104-58"><a href="#cb104-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w_curr, wPath_mbgd, cPath_mbgd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mbgd-on-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="mbgd-on-linear-regression">MBGD on Linear Regression</h2>
<p>Lets use the setup function we defined above:</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> lin_reg()</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-74-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>w_gd, wPath_gd, cPath_gd <span class="op">=</span> gradient_descent(X,y,quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>w_mbgd, wPath_mbgd, cPath_mbgd <span class="op">=</span> mini_batch_gd(X,y,epochs<span class="op">=</span><span class="dv">100</span>,quiet<span class="op">=</span><span class="va">True</span>,batch_size<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 4 epochs with weight change of 0.01009.</code></pre>
</div>
</div>
</section>
<section id="plot-it-1" class="level2">
<h2 class="anchored" data-anchor-id="plot-it-1">Plot it</h2>
<p>Lets take a look!</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">131</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Loss by iteration for GD"</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">132</span>)</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_sgd)<span class="op">;</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Loss by iteration for SGD'</span>)<span class="op">;</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">133</span>)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>ax3.plot(cPath_mbgd)<span class="op">;</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Loss by iteration for MBGD'</span>)<span class="op">;</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-76-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">121</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Loss by iteration for GD"</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">122</span>)</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_mbgd[<span class="dv">0</span>::<span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Loss by EPOCH for MBGD'</span>)<span class="op">;</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">"EPOCH"</span>)<span class="op">;</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-77-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Lets take a look at the paths!</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>num_points <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="fl">0.7</span>,<span class="fl">1.3</span>,num_points)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="fl">2.75</span>,<span class="fl">3.25</span>,num_points)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>W_0,W_1 <span class="op">=</span> np.meshgrid(w_0,w_1)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient Descent</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">131</span>)</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_0'</span>)<span class="op">;</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_1'</span>)<span class="op">;</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="fl">0.7</span>,<span class="fl">1.3</span>])</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="fl">2.75</span>,<span class="fl">3.25</span>])</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>ax1.scatter(wPath_gd[:,<span class="dv">0</span>],wPath_gd[:,<span class="dv">1</span>], s<span class="op">=</span><span class="dv">50</span>,c<span class="op">=</span>cPath_gd)<span class="op">;</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"GD"</span>)<span class="op">;</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="co"># SGD</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">132</span>, sharex<span class="op">=</span>ax1, sharey<span class="op">=</span>ax1)</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>ax2.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>ax2.scatter(wPath_sgd[:,<span class="dv">0</span>],wPath_sgd[:,<span class="dv">1</span>], c<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(wPath_sgd)))<span class="op">;</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"SGD"</span>)<span class="op">;</span></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a><span class="co"># MBGD</span></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> plt.subplot(<span class="dv">133</span>, sharex<span class="op">=</span>ax1, sharey<span class="op">=</span>ax1)</span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a>ax3.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a>ax3.scatter(wPath_mbgd[:,<span class="dv">0</span>],wPath_mbgd[:,<span class="dv">1</span>], c<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(wPath_mbgd)))<span class="op">;</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"Mini-batch GD"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-78-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What do you notice about the graphs above? What can you say about these graphs?</p>
</div>
</section>
<section id="mbgd-on-polynomial-regression" class="level2">
<h2 class="anchored" data-anchor-id="mbgd-on-polynomial-regression">MBGD on Polynomial Regression</h2>
<p>Lets run this on the polynomial problem</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> poly_reg()</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x,f(x),<span class="st">'--r'</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-79-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>w_gd, wPath_gd, cPath_gd <span class="op">=</span> gradient_descent(X,y,quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>w_mbgd, wPath_mbgd, cPath_mbgd <span class="op">=</span> mini_batch_gd(X,y,epochs<span class="op">=</span><span class="dv">100</span>,quiet<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 4 epochs with weight change of 0.01274.</code></pre>
</div>
</div>
</section>
<section id="plot-it-2" class="level2">
<h2 class="anchored" data-anchor-id="plot-it-2">Plot it!</h2>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">131</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Loss by iteration for GD"</span>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">132</span>)</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_sgd)<span class="op">;</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Loss by iteration for SGD'</span>)<span class="op">;</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">133</span>)</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>ax3.plot(cPath_mbgd[::<span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Loss by iteration for MBGD'</span>)<span class="op">;</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-81-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now lets look at by <strong>epoch</strong> for MBSGD</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">131</span>)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(cPath_gd)<span class="op">;</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Loss by iteration for GD"</span>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">132</span>)</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>ax2.plot(cPath_sgd)<span class="op">;</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Loss by iteration for SGD'</span>)<span class="op">;</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">"iteration"</span>)<span class="op">;</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">133</span>)</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>ax3.plot(cPath_mbgd)<span class="op">;</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Loss by EPOCH for MBGD'</span>)<span class="op">;</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">"EPOCH"</span>)<span class="op">;</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-82-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">133</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>ax3.plot(cPath_mbgd)<span class="op">;</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'Loss by EPOCH for MBGD'</span>)<span class="op">;</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">"EPOCH"</span>)<span class="op">;</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">"loss"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How about those paths!</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> regenerate_anim:</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">30</span>,<span class="dv">7</span>))</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">131</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    ax1.scatter(x,y)<span class="op">;</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">132</span>)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    ax2.scatter(x,y)<span class="op">;</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">133</span>)</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    ax3.scatter(x,y)<span class="op">;</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>    line1, <span class="op">=</span> ax1.plot([],[],<span class="st">'--r'</span>)</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>    line2, <span class="op">=</span> ax2.plot([],[],<span class="st">'--r'</span>)</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>    line3, <span class="op">=</span> ax3.plot([],[],<span class="st">'--r'</span>)</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>    num_frames <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>    gd_frames <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="bu">len</span>(wPath_gd)<span class="op">-</span><span class="dv">1</span>,num_frames).astype(<span class="bu">int</span>)</span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>    sgd_frames <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="bu">len</span>(wPath_sgd)<span class="op">-</span><span class="dv">1</span>,num_frames).astype(<span class="bu">int</span>)</span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a>    mbgd_frames <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="bu">len</span>(wPath_mbgd)<span class="op">-</span><span class="dv">1</span>,num_frames).astype(<span class="bu">int</span>)</span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> animate(i):</span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>        gd_frame <span class="op">=</span> gd_frames[i]</span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a>        sgd_frame <span class="op">=</span> sgd_frames[i]</span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a>        mbgd_frame <span class="op">=</span> sgd_frames[i]</span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a>        coefs_gd <span class="op">=</span> np.flip(np.squeeze(wPath_gd[gd_frame]))</span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a>        coefs_sgd <span class="op">=</span> np.flip(np.squeeze(wPath_sgd[sgd_frame]))</span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a>        coefs_mbgd <span class="op">=</span> np.flip(np.squeeze(wPath_mbgd[mbgd_frame]))</span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a>        poly_gd <span class="op">=</span> np.poly1d(coefs_gd)</span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>        poly_sgd <span class="op">=</span> np.poly1d(coefs_sgd)</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a>        poly_mbgd <span class="op">=</span> np.poly1d(coefs_mbgd)</span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a>        line1.set_data(x,poly_gd(x))<span class="op">;</span></span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>        ax1.set_title(<span class="st">'GDIteration: </span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%.2f</span><span class="st"> x^3 + </span><span class="sc">%.2f</span><span class="st"> x^2 + </span><span class="sc">%.2f</span><span class="st"> x + </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> (i, coefs_gd[<span class="dv">0</span>], coefs_gd[<span class="dv">1</span>], coefs_gd[<span class="dv">2</span>], coefs_gd[<span class="dv">3</span>]))</span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a>        line2.set_data(x,poly_sgd(x))<span class="op">;</span></span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a>        ax2.set_title(<span class="st">'SGD Iteration: </span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%.2f</span><span class="st"> x^3 + </span><span class="sc">%.2f</span><span class="st"> x^2 + </span><span class="sc">%.2f</span><span class="st"> x + </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> (i, coefs_sgd[<span class="dv">0</span>], coefs_sgd[<span class="dv">1</span>], coefs_sgd[<span class="dv">2</span>], coefs_sgd[<span class="dv">3</span>]))</span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a>        line3.set_data(x,poly_mbgd(x))<span class="op">;</span></span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a>        ax3.set_title(<span class="st">'MBGD Iteration: </span><span class="sc">%d</span><span class="st"> - </span><span class="sc">%.2f</span><span class="st"> x^3 + </span><span class="sc">%.2f</span><span class="st"> x^2 + </span><span class="sc">%.2f</span><span class="st"> x + </span><span class="sc">%.2f</span><span class="st">'</span> <span class="op">%</span> (i, coefs_mbgd[<span class="dv">0</span>], coefs_mbgd[<span class="dv">1</span>], coefs_mbgd[<span class="dv">2</span>], coefs_mbgd[<span class="dv">3</span>]))</span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> line1, line2, line3</span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb117-52"><a href="#cb117-52" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, animate, frames<span class="op">=</span>num_frames, interval<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb117-53"><a href="#cb117-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb117-54"><a href="#cb117-54" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'multi_lin_reg_mbgd.mp4'</span>)</span>
<span id="cb117-55"><a href="#cb117-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb117-56"><a href="#cb117-56" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'multi_lin_reg_mbgd.mp4'</span>,width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<video src="multi_lin_reg_mbgd.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What do you notice about these graphs? Reflect on it and answer here!</p>
</div>
</section>
</section>
<section id="momentum" class="level1">
<h1>Momentum</h1>
<p>Now we are finally armed with enough to consider modern modifications on these schemes! The first of which is adding some <strong>momentum</strong> to SGD.</p>
<div class="info">
<p>The <strong>momentum-method</strong> (SGD+Momentum) algorithm is given by:</p>
<p><span class="math display">
\begin{align}
z_{k+1} &amp;= \beta z_k + \nabla f(w_k) \\
w_{k+1} &amp;= w_k  - \eta z_{k+1}
\end{align}
</span></p>
</div>
<p>Its not as complicated as you might first think! Lets quickly discover a special case:</p>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What do you get when you set the momentum parameter <span class="math inline">\beta = 0</span>?</p>
</div>
<p>Quickly, we shoud see that we recover the original gradient descent iterates. So what does <span class="math inline">\beta != 0</span> give us? Well in optimization this is called <strong>acceleration</strong>.</p>
<p>It gives our iterates some “memory”. Lets write out a few steps to see what we mean:</p>
<p><span class="math display">
\begin{align}
w_1 &amp;= w_0 - \eta z_1, \quad\quad z_1 = \nabla f(w_0) \\
w_2 &amp;= w_1 - \eta z_2, \quad\quad z_2 = \beta\cdot\nabla f(w_0) + \nabla f(w_1) \\
w_3 &amp;= w_2 - \eta z_3, \quad\quad z_3 = \beta \cdot z_2 + \nabla f(w_3) = \beta \cdot (\beta\cdot\nabla f(w_0) + \nabla f(w_1)) + \nabla f(w_2)\\
\ldots
\end{align}
</span></p>
<p>Its named <strong>momentum</strong> by analogy to the concept of <em>momentum</em> in physics. We can think of the weight vector <span class="math inline">w</span> as a <em>particle</em> traveling through parameter space. This particle incurs some <strong>acceleration</strong> from the gradient of the loss (which acts as the “force” on the particle).</p>
<p>This acceleration tends to keep the weight vector traveling <strong>in the same direction</strong> as it was, and can preventing succumbing to unwanted oscillations.</p>
<section id="implementation-3" class="level2">
<h2 class="anchored" data-anchor-id="implementation-3">Implementation</h2>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sgd_momentum(dataset, labels, w_init<span class="op">=</span><span class="va">None</span>, eta<span class="op">=</span><span class="va">None</span>, beta<span class="op">=</span><span class="va">None</span>, epochs<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w_init <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>        w_init <span class="op">=</span> np.random.rand(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> eta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> beta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        beta <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataset</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> dataset.shape[<span class="dv">0</span>]</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> dataset.shape[<span class="dv">1</span>]</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up initial point sizes:</span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> np.asarray(w_init).reshape(d,<span class="dv">1</span>)</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M-SGD params</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">1e-10</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>    delta_w <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true" tabindex="-1"></a>    max_iter <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a>    iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save weights and costs along path</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true" tabindex="-1"></a>    wPath <span class="op">=</span> [w_init]</span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calc cost at that initial value</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.random.randint(N)</span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true" tabindex="-1"></a>    x_i <span class="op">=</span> dataset[np.newaxis,idx,:].T</span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true" tabindex="-1"></a>    y_i <span class="op">=</span> labels[idx,:]</span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true" tabindex="-1"></a>    cPath <span class="op">=</span> [cost_sgd(x_i,y_i,w_init)]</span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take first step</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true" tabindex="-1"></a>    w_old <span class="op">=</span> w_init</span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true" tabindex="-1"></a>    z_old <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-35"><a href="#cb118-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># epochs of training</span></span>
<span id="cb118-36"><a href="#cb118-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb118-37"><a href="#cb118-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-38"><a href="#cb118-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># shuffle the dataset - note we do this by shuffling indices</span></span>
<span id="cb118-39"><a href="#cb118-39" aria-hidden="true" tabindex="-1"></a>        indices <span class="op">=</span> np.random.permutation(N)</span>
<span id="cb118-40"><a href="#cb118-40" aria-hidden="true" tabindex="-1"></a>        shuffled_dataset <span class="op">=</span> dataset[indices,:]</span>
<span id="cb118-41"><a href="#cb118-41" aria-hidden="true" tabindex="-1"></a>        shuffled_labels <span class="op">=</span> labels[indices,:]</span>
<span id="cb118-42"><a href="#cb118-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-43"><a href="#cb118-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb118-44"><a href="#cb118-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># np.newaxis is there to deal with the 1 for the row size</span></span>
<span id="cb118-45"><a href="#cb118-45" aria-hidden="true" tabindex="-1"></a>            curr_sample <span class="op">=</span> shuffled_dataset[i,:]</span>
<span id="cb118-46"><a href="#cb118-46" aria-hidden="true" tabindex="-1"></a>            curr_sample <span class="op">=</span> curr_sample[np.newaxis].T</span>
<span id="cb118-47"><a href="#cb118-47" aria-hidden="true" tabindex="-1"></a>            curr_label <span class="op">=</span> shuffled_labels[i,:]</span>
<span id="cb118-48"><a href="#cb118-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb118-49"><a href="#cb118-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update your weights with the grad at one sample</span></span>
<span id="cb118-50"><a href="#cb118-50" aria-hidden="true" tabindex="-1"></a>            grad <span class="op">=</span> cost_grad_sgd(curr_sample,curr_label,w_old)</span>
<span id="cb118-51"><a href="#cb118-51" aria-hidden="true" tabindex="-1"></a>            z_new <span class="op">=</span> beta<span class="op">*</span>z_old <span class="op">+</span> grad</span>
<span id="cb118-52"><a href="#cb118-52" aria-hidden="true" tabindex="-1"></a>            w_new <span class="op">=</span> w_old <span class="op">-</span> eta <span class="op">*</span> z_new</span>
<span id="cb118-53"><a href="#cb118-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb118-54"><a href="#cb118-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update paths</span></span>
<span id="cb118-55"><a href="#cb118-55" aria-hidden="true" tabindex="-1"></a>            wPath.append(w_new)</span>
<span id="cb118-56"><a href="#cb118-56" aria-hidden="true" tabindex="-1"></a>            cPath.append(cost_sgd(curr_sample,curr_label,w_new))</span>
<span id="cb118-57"><a href="#cb118-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb118-58"><a href="#cb118-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># calculate weight change</span></span>
<span id="cb118-59"><a href="#cb118-59" aria-hidden="true" tabindex="-1"></a>            delta_w <span class="op">=</span> np.linalg.norm(w_new <span class="op">-</span> w_old)</span>
<span id="cb118-60"><a href="#cb118-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb118-61"><a href="#cb118-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># make your previous new weights the current weights</span></span>
<span id="cb118-62"><a href="#cb118-62" aria-hidden="true" tabindex="-1"></a>            w_old <span class="op">=</span> w_new</span>
<span id="cb118-63"><a href="#cb118-63" aria-hidden="true" tabindex="-1"></a>            z_old <span class="op">=</span> z_new</span>
<span id="cb118-64"><a href="#cb118-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb118-65"><a href="#cb118-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># at end of epoch, check to see if you should terminate</span></span>
<span id="cb118-66"><a href="#cb118-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> delta_w <span class="op">&lt;</span> delta:</span>
<span id="cb118-67"><a href="#cb118-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb118-68"><a href="#cb118-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-69"><a href="#cb118-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up path variables</span></span>
<span id="cb118-70"><a href="#cb118-70" aria-hidden="true" tabindex="-1"></a>    wPath <span class="op">=</span> np.squeeze(np.asarray(wPath))</span>
<span id="cb118-71"><a href="#cb118-71" aria-hidden="true" tabindex="-1"></a>    cPath <span class="op">=</span> np.squeeze(np.asarray(cPath))</span>
<span id="cb118-72"><a href="#cb118-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-73"><a href="#cb118-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"terminating M-SGD after </span><span class="sc">{</span>epoch<span class="sc">}</span><span class="ss"> epochs with weight change of </span><span class="sc">{</span>delta_w<span class="sc">:0.5f}</span><span class="ss">."</span>)</span>
<span id="cb118-74"><a href="#cb118-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb118-75"><a href="#cb118-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w_new, wPath, cPath</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="m-sgd-on-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="m-sgd-on-linear-regression">M-SGD on Linear Regression</h2>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lin_reg():</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> f(x):</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">3</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>,N)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> f(x) <span class="op">+</span> np.random.randn(N) <span class="co"># our zero man gaussian noise</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.ones((N,<span class="dv">2</span>))</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    X[:,<span class="dv">1</span>] <span class="op">=</span> x</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> y[:,np.newaxis]</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x,X,y,f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> lin_reg()</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-87-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>[<span class="fl">0.75</span>,<span class="fl">2.5</span>],eta<span class="op">=</span><span class="fl">1e-2</span>,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>w_sgd_m, wPath_sgd_m, cPath_sgd_m <span class="op">=</span> sgd_momentum(X,y,w_init<span class="op">=</span>[<span class="fl">0.75</span>,<span class="fl">2.5</span>],eta<span class="op">=</span><span class="fl">1e-5</span>,epochs<span class="op">=</span><span class="dv">100</span>,beta<span class="op">=</span><span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 99 epochs with weight change of 0.00242.
terminating M-SGD after 99 epochs with weight change of 0.00006.</code></pre>
</div>
</div>
</section>
<section id="plot-it-3" class="level2">
<h2 class="anchored" data-anchor-id="plot-it-3">Plot it!</h2>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_sgd_m,cPath_sgd_m,colorby<span class="op">=</span><span class="st">'iter'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-89-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="comparison-1" class="level2">
<h2 class="anchored" data-anchor-id="comparison-1">Comparison</h2>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>w_init<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>eta<span class="op">=</span><span class="fl">1e-3</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span><span class="fl">0.9</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>w_sgd_m, wPath_sgd_m, cPath_sgd_m <span class="op">=</span> sgd_momentum(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,beta<span class="op">=</span>beta,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_sgd,cPath_sgd)<span class="op">;</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_sgd_m,cPath_sgd_m)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 99 epochs with weight change of 0.00094.
terminating M-SGD after 99 epochs with weight change of 0.00831.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-90-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-90-output-3.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="plot-paths" class="level2">
<h2 class="anchored" data-anchor-id="plot-paths">Plot Paths!</h2>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>w_init<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>eta<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>beta<span class="op">=</span><span class="fl">0.99</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>w_sgd_m, wPath_sgd_m, cPath_sgd_m <span class="op">=</span> sgd_momentum(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,beta<span class="op">=</span>beta,epochs<span class="op">=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 99 epochs with weight change of 0.00001.
terminating M-SGD after 99 epochs with weight change of 0.00168.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>num_points <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>x_l <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>x_r <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>y_l <span class="op">=</span> <span class="fl">2.5</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>y_r <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(x_l,x_r,num_points)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(y_l,y_r,num_points)</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>W_0,W_1 <span class="op">=</span> np.meshgrid(w_0,w_1)</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co"># SGD</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">121</span>)</span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a>ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_0'</span>)<span class="op">;</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_1'</span>)<span class="op">;</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([x_l,x_r])</span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([y_l,y_r])</span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>ax1.scatter(wPath_sgd[:,<span class="dv">0</span>],wPath_sgd[:,<span class="dv">1</span>], s<span class="op">=</span><span class="dv">50</span>,c<span class="op">=</span>cPath_sgd)<span class="op">;</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"SGD"</span>)<span class="op">;</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="co"># MSGD</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">122</span>, sharex<span class="op">=</span>ax1, sharey<span class="op">=</span>ax1)</span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>ax2.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>ax2.scatter(wPath_sgd_m[:,<span class="dv">0</span>],wPath_sgd_m[:,<span class="dv">1</span>], c<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(wPath_sgd_m)))<span class="op">;</span></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"M-SGD"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-92-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><strong>Pause-and-ponder</strong>: What do you notice? Go back and change the <span class="math inline">\eta</span> and <span class="math inline">\beta</span> parameters above and jot your observations down here!</p>
</div>
</section>
<section id="gd-momentum" class="level2">
<h2 class="anchored" data-anchor-id="gd-momentum">GD + Momentum</h2>
<div class="info">
<p><strong>See-and-do</strong>: Go back, and add some momentum to our stock GD implementation, and make your comparisons!</p>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gd_momentum():</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EDIT HERE!</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mbgd-momentum" class="level2">
<h2 class="anchored" data-anchor-id="mbgd-momentum">MBGD + Momentum</h2>
<div class="info">
<p><strong>See-and-do</strong>: Go back, and add some momentum to our Mini-batch GD implementation, and make your comparisons!</p>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mbgd_momentum():</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EDIT HERE!</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="unified-implementation" class="level1">
<h1>Unified Implementation</h1>
<p>So far, we’ve implemented the following:</p>
<ul>
<li>Gradient Descent</li>
<li>Stochastic Gradient Descent</li>
<li>Mini-batch GD</li>
</ul>
<p>What about “Mini-batch SGD”? How would you implement it? What would you expect it to behave like?</p>
<p>To the methods above, we can imagine adding some <strong>momentum</strong>, giving us: * GD + Momentum * Stochastic Gradient Descent + Momentum * Mini-batch GD + Momentum</p>
<p>Of which we’ve only given one, but tasked you with the rest.</p>
<p>Armed with everything you know, you should now be able to give me <strong>one function</strong> which can do all of these things! Among other things, this function should take a <code>batch_size</code>, an <code>epoch</code>, an <code>eta</code>, and a <code>beta</code> parameter.</p>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gd_optimizer():</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># EDIT HERE</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rms-prop" class="level1">
<h1>RMS Prop</h1>
<p>Another extension which aims to curb our steps sizes in “bad directions” is RMS Prop which stands for Root Mean Squared Propagation. The name makes it sound more complicated than it is! Its updates are:</p>
<p><span class="math display">
\begin{align}
v_{t+1} = \gamma v_{t} + (1-\gamma)\left(\nabla f(w_t)\right)^2
\end{align} \\
w_{t+1} = w_{t} - \frac{\eta}{\sqrt{v_{t+1}}}\nabla f(w_t)
</span></p>
<p>Where <span class="math inline">\gamma</span> is called the <strong>forgetting factor</strong>.</p>
<p>This algorithm <strong>scales</strong> the step-size/learning rate differently for each parameter! It does so automatically through this scaling!</p>
<p>Factoid: This algorithm was first propsoed by Geoff Hinton while teaching a Coursera course!</p>
<section id="implementation-4" class="level2">
<h2 class="anchored" data-anchor-id="implementation-4">Implementation</h2>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mini_batch_rmsprop(dataset, labels, w_init<span class="op">=</span><span class="va">None</span>, eta<span class="op">=</span><span class="va">None</span>, gamma<span class="op">=</span><span class="va">None</span>, batch_size<span class="op">=</span><span class="dv">10</span>, epochs<span class="op">=</span><span class="dv">5</span>, quiet<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w_init <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>        w_init <span class="op">=</span> np.random.rand(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> eta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> gamma <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>        gamma <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataset</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> dataset.shape[<span class="dv">0</span>]</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> dataset.shape[<span class="dv">1</span>]</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    num_batches <span class="op">=</span> <span class="bu">int</span>(N<span class="op">/</span>batch_size)</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up initial point sizes:</span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> np.asarray(w_init).reshape(d,<span class="dv">1</span>)</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mini-batch params </span></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    delta_w <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>    iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save weights and costs along path</span></span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    wPath_rms <span class="op">=</span> []</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>    cPath_rms <span class="op">=</span> []</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take the first step</span></span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>    w_old <span class="op">=</span> w_init</span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a>    v_old <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> batch_num <span class="kw">in</span> <span class="bu">range</span>(num_batches):</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current batch</span></span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a>            batch_start <span class="op">=</span> batch_num<span class="op">*</span>batch_size</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a>            batch_end <span class="op">=</span> (batch_num<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>batch_size</span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a>            batch <span class="op">=</span> dataset[batch_start:batch_end,:]</span>
<span id="cb132-39"><a href="#cb132-39" aria-hidden="true" tabindex="-1"></a>            batch_labels <span class="op">=</span> labels[batch_start:batch_end]</span>
<span id="cb132-40"><a href="#cb132-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-41"><a href="#cb132-41" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update your weights</span></span>
<span id="cb132-42"><a href="#cb132-42" aria-hidden="true" tabindex="-1"></a>            grad <span class="op">=</span> cost_grad(batch,batch_labels,w_old)</span>
<span id="cb132-43"><a href="#cb132-43" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb132-44"><a href="#cb132-44" aria-hidden="true" tabindex="-1"></a>            v_new <span class="op">=</span> gamma<span class="op">*</span>v_old <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>gamma)<span class="op">*</span>grad<span class="op">**</span><span class="dv">2</span></span>
<span id="cb132-45"><a href="#cb132-45" aria-hidden="true" tabindex="-1"></a>            w_new <span class="op">=</span> w_old <span class="op">-</span> (eta<span class="op">/</span>np.sqrt(v_new <span class="op">+</span> np.random.rand()))<span class="op">*</span>grad </span>
<span id="cb132-46"><a href="#cb132-46" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb132-47"><a href="#cb132-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-48"><a href="#cb132-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update old weights</span></span>
<span id="cb132-49"><a href="#cb132-49" aria-hidden="true" tabindex="-1"></a>            w_old <span class="op">=</span> w_new</span>
<span id="cb132-50"><a href="#cb132-50" aria-hidden="true" tabindex="-1"></a>            v_old <span class="op">=</span> v_new</span>
<span id="cb132-51"><a href="#cb132-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb132-52"><a href="#cb132-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># append trajectory</span></span>
<span id="cb132-53"><a href="#cb132-53" aria-hidden="true" tabindex="-1"></a>            wPath_rms.append(w_new)</span>
<span id="cb132-54"><a href="#cb132-54" aria-hidden="true" tabindex="-1"></a>            cPath_rms.append(cost(batch,batch_labels,w_new))</span>
<span id="cb132-55"><a href="#cb132-55" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb132-56"><a href="#cb132-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-57"><a href="#cb132-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> quiet: <span class="bu">print</span>(<span class="ss">f"Epoch:</span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>epochs<span class="sc">}</span><span class="ss">, Loss:</span><span class="sc">{</span>cPath_rms[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb132-58"><a href="#cb132-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-59"><a href="#cb132-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up path variables</span></span>
<span id="cb132-60"><a href="#cb132-60" aria-hidden="true" tabindex="-1"></a>    wPath_rms <span class="op">=</span> np.squeeze(np.asarray(wPath_rms))</span>
<span id="cb132-61"><a href="#cb132-61" aria-hidden="true" tabindex="-1"></a>    cPath_rms <span class="op">=</span> np.squeeze(np.asarray(cPath_rms))</span>
<span id="cb132-62"><a href="#cb132-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-63"><a href="#cb132-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w_new, wPath_rms, cPath_rms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-it-4" class="level2">
<h2 class="anchored" data-anchor-id="plot-it-4">Plot it!</h2>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> lin_reg()</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-100-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>gamma <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>[<span class="fl">0.75</span>,<span class="fl">2.5</span>],eta<span class="op">=</span><span class="fl">1e-2</span>,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>w_rms, wPath_rms, cPath_rms <span class="op">=</span> mini_batch_rmsprop(X,y,w_init<span class="op">=</span>[<span class="fl">0.75</span>,<span class="fl">2.5</span>],eta<span class="op">=</span><span class="fl">1e-2</span>,gamma<span class="op">=</span>gamma,epochs<span class="op">=</span><span class="dv">100</span>,quiet<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 99 epochs with weight change of 0.01311.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>w_init<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span>]</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>eta<span class="op">=</span><span class="fl">1e-2</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>gamma<span class="op">=</span><span class="fl">0.8</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>w_mbgd, wPath_mbgd, cPath_mbgd <span class="op">=</span> mini_batch_gd(X,y,epochs<span class="op">=</span><span class="dv">100</span>,quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>w_sgd, wPath_sgd, cPath_sgd <span class="op">=</span> sgd(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,epochs<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>w_rms, wPath_rms, cPath_rms <span class="op">=</span> mini_batch_rmsprop(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,gamma<span class="op">=</span>gamma,epochs<span class="op">=</span><span class="dv">100</span>,quiet<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_mbgd,cPath_mbgd)<span class="op">;</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_sgd,cPath_sgd)<span class="op">;</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>plot_path(wPath_rms,cPath_rms)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>terminating SGD after 99 epochs with weight change of 0.04209.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-102-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-102-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-102-output-4.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="adam" class="level1">
<h1>Adam</h1>
<p>Finally - we’ve made it! A modern algorithm! At a very basic level, ADAM is just momentum+rmsprop! You could implement it right now!</p>
<p>Before we give its update, lets explain what ADAM stands for: <strong>ADA</strong>ptive <strong>M</strong>oment estimation. Well, if you think of the gradient as the thing we are estimating, then its average of a dataset is the “first moment”, or the <strong>mean</strong>. The square of that is the “second moment”.</p>
<p>So my combining momentum, which deals with the first moment, and RMSProp which deals with the second moment, we have ADAM.</p>
<div class="info">
<p>The ADAM algorithm updates are:</p>
<p><span class="math display">
\require{cancel}
\begin{align}
z_{t+1} &amp;= \frac{\beta_1 z_t + (1-\beta_1)\nabla f(w_t)}{\color{red}{\cancel{1-\beta_1^t}}} \\
v_{t+1} &amp;= \frac{\beta_2 v_{t} + (1-\beta_2)\left(\nabla f(w_t)\right)^2}{\color{red}{\cancel{1-\beta_2^t}}} \\
w_{t+1} &amp;= w_{t} - \eta\frac{z_{t+1}}{\color{red}{\sqrt{v_{t+1}} + \epsilon}}\color{red}{\cancel{\nabla f(w_t)}}
\end{align}
</span></p>
<p><strong>Notes:</strong> * <strong>Note</strong>: Let <span class="math inline">\epsilon</span> be a small, but <strong>fixed</strong> number like <span class="math inline">10^{-8}</span>. * We are giving it in the “usual” convention in terms of parameters, so <span class="math inline">\beta_1</span> controls the amount of “momentum”, while <span class="math inline">\beta_2</span> controls the amount of “RMSprop”. * <del>We are also giving the usual ADAM implementation that includes the <strong>bias correction</strong> of dividing by <span class="math inline">\cancel{1-\beta^t}</span>. As <span class="math inline">t</span> grows, this corrective term disappears.</del> * “In the field” typical values for <span class="math inline">\beta_1,\beta_2</span> are: <span class="math inline">\beta_1=0.9,\beta_2=0.999</span>, and <span class="math inline">\eta</span> still needs to be tuned. * <strong>Note</strong>: You should still try different values here! These are “in the field” values for “real” cost functions.</p>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mini_batch_adam(dataset, labels, w_init<span class="op">=</span><span class="va">None</span>, eta<span class="op">=</span><span class="va">None</span>, beta1<span class="op">=</span><span class="fl">0.9</span>, beta2<span class="op">=</span><span class="fl">0.999</span>, batch_size<span class="op">=</span><span class="dv">10</span>, epochs<span class="op">=</span><span class="dv">5</span>, quiet<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> w_init <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>        w_init <span class="op">=</span> np.random.rand(dataset.shape[<span class="dv">1</span>],<span class="dv">1</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> eta <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> <span class="fl">1e-2</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>    epsilon <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataset</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> dataset.shape[<span class="dv">0</span>]</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> dataset.shape[<span class="dv">1</span>]</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>    num_batches <span class="op">=</span> <span class="bu">int</span>(N<span class="op">/</span>batch_size)</span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up initial point sizes:</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>    w_init <span class="op">=</span> np.asarray(w_init).reshape(d,<span class="dv">1</span>)</span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mini-batch params </span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">1e-5</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>    delta_w <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true" tabindex="-1"></a>    iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save weights and costs along path</span></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true" tabindex="-1"></a>    wPath_adam <span class="op">=</span> []</span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true" tabindex="-1"></a>    cPath_adam <span class="op">=</span> []</span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># take the first step</span></span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true" tabindex="-1"></a>    w_old <span class="op">=</span> w_init</span>
<span id="cb138-28"><a href="#cb138-28" aria-hidden="true" tabindex="-1"></a>    z_old <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb138-29"><a href="#cb138-29" aria-hidden="true" tabindex="-1"></a>    v_old <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb138-30"><a href="#cb138-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-31"><a href="#cb138-31" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb138-32"><a href="#cb138-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(epochs):</span>
<span id="cb138-33"><a href="#cb138-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb138-34"><a href="#cb138-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> batch_num <span class="kw">in</span> <span class="bu">range</span>(num_batches):</span>
<span id="cb138-35"><a href="#cb138-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-36"><a href="#cb138-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># get current batch</span></span>
<span id="cb138-37"><a href="#cb138-37" aria-hidden="true" tabindex="-1"></a>            batch_start <span class="op">=</span> batch_num<span class="op">*</span>batch_size</span>
<span id="cb138-38"><a href="#cb138-38" aria-hidden="true" tabindex="-1"></a>            batch_end <span class="op">=</span> (batch_num<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>batch_size</span>
<span id="cb138-39"><a href="#cb138-39" aria-hidden="true" tabindex="-1"></a>            batch <span class="op">=</span> dataset[batch_start:batch_end,:]</span>
<span id="cb138-40"><a href="#cb138-40" aria-hidden="true" tabindex="-1"></a>            batch_labels <span class="op">=</span> labels[batch_start:batch_end]</span>
<span id="cb138-41"><a href="#cb138-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-42"><a href="#cb138-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update your weights</span></span>
<span id="cb138-43"><a href="#cb138-43" aria-hidden="true" tabindex="-1"></a>            grad <span class="op">=</span> cost_grad(batch,batch_labels,w_old)</span>
<span id="cb138-44"><a href="#cb138-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb138-45"><a href="#cb138-45" aria-hidden="true" tabindex="-1"></a>            z_new <span class="op">=</span> beta1<span class="op">*</span>z_old <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>beta1)<span class="op">*</span>grad</span>
<span id="cb138-46"><a href="#cb138-46" aria-hidden="true" tabindex="-1"></a>            z_corr <span class="op">=</span> z_new<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>beta1<span class="op">**</span>t)</span>
<span id="cb138-47"><a href="#cb138-47" aria-hidden="true" tabindex="-1"></a>            v_new <span class="op">=</span> beta2<span class="op">*</span>v_old <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>beta2)<span class="op">*</span>grad<span class="op">**</span><span class="dv">2</span></span>
<span id="cb138-48"><a href="#cb138-48" aria-hidden="true" tabindex="-1"></a>            v_corr <span class="op">=</span> v_new<span class="op">/</span>(<span class="dv">1</span><span class="op">+</span>beta2<span class="op">**</span>t)</span>
<span id="cb138-49"><a href="#cb138-49" aria-hidden="true" tabindex="-1"></a>            w_new <span class="op">=</span> w_old <span class="op">-</span> eta<span class="op">*</span>z_corr<span class="op">/</span>(np.sqrt(v_corr) <span class="op">+</span> epsilon)</span>
<span id="cb138-50"><a href="#cb138-50" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb138-51"><a href="#cb138-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-52"><a href="#cb138-52" aria-hidden="true" tabindex="-1"></a>            <span class="co"># update old weights</span></span>
<span id="cb138-53"><a href="#cb138-53" aria-hidden="true" tabindex="-1"></a>            w_old <span class="op">=</span> w_new</span>
<span id="cb138-54"><a href="#cb138-54" aria-hidden="true" tabindex="-1"></a>            z_old <span class="op">=</span> z_new</span>
<span id="cb138-55"><a href="#cb138-55" aria-hidden="true" tabindex="-1"></a>            v_old <span class="op">=</span> v_new</span>
<span id="cb138-56"><a href="#cb138-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb138-57"><a href="#cb138-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># increment t</span></span>
<span id="cb138-58"><a href="#cb138-58" aria-hidden="true" tabindex="-1"></a>            t <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb138-59"><a href="#cb138-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb138-60"><a href="#cb138-60" aria-hidden="true" tabindex="-1"></a>            <span class="co"># append trajectory</span></span>
<span id="cb138-61"><a href="#cb138-61" aria-hidden="true" tabindex="-1"></a>            wPath_adam.append(w_new)</span>
<span id="cb138-62"><a href="#cb138-62" aria-hidden="true" tabindex="-1"></a>            cPath_adam.append(cost(batch,batch_labels,w_new))</span>
<span id="cb138-63"><a href="#cb138-63" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb138-64"><a href="#cb138-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-65"><a href="#cb138-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> quiet: <span class="bu">print</span>(<span class="ss">f"Epoch:</span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>epochs<span class="sc">}</span><span class="ss">, Loss:</span><span class="sc">{</span>cPath_adam[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb138-66"><a href="#cb138-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-67"><a href="#cb138-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># clean up path variables</span></span>
<span id="cb138-68"><a href="#cb138-68" aria-hidden="true" tabindex="-1"></a>    wPath_adam <span class="op">=</span> np.squeeze(np.asarray(wPath_adam))</span>
<span id="cb138-69"><a href="#cb138-69" aria-hidden="true" tabindex="-1"></a>    cPath_adam <span class="op">=</span> np.squeeze(np.asarray(cPath_adam))</span>
<span id="cb138-70"><a href="#cb138-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-71"><a href="#cb138-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> w_new, wPath_adam, cPath_adam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>x,X,y,f <span class="op">=</span> lin_reg()</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(x,y)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-104-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>w_init<span class="op">=</span>[<span class="fl">0.1</span>,<span class="fl">2.1</span>]</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>eta<span class="op">=</span><span class="fl">1e-2</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>w_adam, wPath_adam, cPath_adam <span class="op">=</span> mini_batch_adam(X,y,w_init<span class="op">=</span>w_init,eta<span class="op">=</span>eta,epochs<span class="op">=</span><span class="dv">100</span>,quiet<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-code_folding="[0]" data-execution_count="100">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>len_w <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>w_0 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">2</span>,len_w)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>w_1 <span class="op">=</span> np.linspace(<span class="dv">2</span>,<span class="dv">4</span>,len_w)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>W_0, W_1 <span class="op">=</span> np.meshgrid(w_0, w_1)</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and reshape mesh for calculation</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>wgrid <span class="op">=</span> np.array([W_0,W_1]).reshape(<span class="dv">2</span>, <span class="bu">len</span>(w_0)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate on grid, and reshape back for plotting</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> cost(X,y,wgrid).reshape(W_0.shape)</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot()</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'w_0'</span>)</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'w_1'</span>)</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ax1.set_zlabel('cost')</span></span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ax1.set_zlim([-2,3])</span></span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>ax1.scatter(wPath_adam[:,<span class="dv">0</span>],wPath_adam[:,<span class="dv">1</span>],s<span class="op">=</span><span class="dv">10</span>,c<span class="op">=</span>cPath_adam,cmap<span class="op">=</span><span class="st">'inferno'</span>)<span class="op">;</span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.plot(wPath_adam[:,0],wPath_adam[:,1]);</span></span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ax1.plot_surface(W_0, W_1, costs,cmap='inferno');</span></span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>ax1.contour(W_0, W_1, costs, cmap<span class="op">=</span><span class="st">'inferno'</span>,levels<span class="op">=</span><span class="dv">20</span>,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="opt_files/figure-html/cell-106-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>