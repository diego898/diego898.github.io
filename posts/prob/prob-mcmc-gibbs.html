<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-02-01">

<title>Diego A. Mesa - An Introduction to Markov Chains, MCMC and The Gibbs Sampler</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../profile.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Diego A. Mesa - An Introduction to Markov Chains, MCMC and The Gibbs Sampler">
<meta property="og:description" content="From Probability to Markov Chain Monte Carlo and the Gibbs Sampler!">
<meta property="og:image" content="https://diego898.github.io/posts/prob/prob_intro.png">
<meta property="og:site-name" content="Diego A. Mesa">
<meta property="og:image:height" content="582">
<meta property="og:image:width" content="822">
<meta name="twitter:title" content="Diego A. Mesa - An Introduction to Markov Chains, MCMC and The Gibbs Sampler">
<meta name="twitter:description" content="From Probability to Markov Chain Monte Carlo and the Gibbs Sampler!">
<meta name="twitter:image" content="https://diego898.github.io/posts/prob/prob_intro.png">
<meta name="twitter:image-height" content="582">
<meta name="twitter:image-width" content="822">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Diego A. Mesa</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">
 <span class="menu-text">posts</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:diego.mesa@vanderbilt.edu"><i class="bi bi-envelope-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/diego898"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/diego-a-mesa/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/diego898"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=8SnAElkAAAAJ&amp;hl=en"><i class="bi bi-stack" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">An Introduction to Markov Chains, MCMC and The Gibbs Sampler</h1>
            <p class="subtitle lead">From Probability to Markov Chain Monte Carlo and the Gibbs Sampler!</p>
                                <div class="quarto-categories">
                <div class="quarto-category">probability</div>
                <div class="quarto-category">mcmc</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 1, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">February 24, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#changelog" id="toc-changelog" class="nav-link" data-scroll-target="#changelog">Changelog</a></li>
  <li><a href="#animations" id="toc-animations" class="nav-link" data-scroll-target="#animations">Animations</a></li>
  <li><a href="#notebook-setup" id="toc-notebook-setup" class="nav-link" data-scroll-target="#notebook-setup">Notebook Setup</a></li>
  </ul></li>
  <li><a href="#probability-review" id="toc-probability-review" class="nav-link" data-scroll-target="#probability-review">Probability Review</a>
  <ul class="collapse">
  <li><a href="#thinking-about-the-tails" id="toc-thinking-about-the-tails" class="nav-link" data-scroll-target="#thinking-about-the-tails">Thinking about the tails</a></li>
  </ul></li>
  <li><a href="#the-log" id="toc-the-log" class="nav-link" data-scroll-target="#the-log">The Log</a></li>
  <li><a href="#bayes-rule" id="toc-bayes-rule" class="nav-link" data-scroll-target="#bayes-rule">Bayes Rule</a>
  <ul class="collapse">
  <li><a href="#drug-testing-example" id="toc-drug-testing-example" class="nav-link" data-scroll-target="#drug-testing-example">Drug testing example</a></li>
  </ul></li>
  <li><a href="#coin-flip-example" id="toc-coin-flip-example" class="nav-link" data-scroll-target="#coin-flip-example">Coin flip example</a></li>
  <li><a href="#sampling" id="toc-sampling" class="nav-link" data-scroll-target="#sampling">Sampling</a>
  <ul class="collapse">
  <li><a href="#variational-bayes" id="toc-variational-bayes" class="nav-link" data-scroll-target="#variational-bayes">Variational Bayes</a></li>
  <li><a href="#inverse-transform-sampling" id="toc-inverse-transform-sampling" class="nav-link" data-scroll-target="#inverse-transform-sampling">Inverse Transform Sampling</a></li>
  <li><a href="#rejection-sampling" id="toc-rejection-sampling" class="nav-link" data-scroll-target="#rejection-sampling">Rejection Sampling</a></li>
  </ul></li>
  <li><a href="#markov-chains" id="toc-markov-chains" class="nav-link" data-scroll-target="#markov-chains">Markov Chains</a>
  <ul class="collapse">
  <li><a href="#evolving-distributions" id="toc-evolving-distributions" class="nav-link" data-scroll-target="#evolving-distributions">Evolving Distributions</a></li>
  </ul></li>
  <li><a href="#monte-carlo-integration" id="toc-monte-carlo-integration" class="nav-link" data-scroll-target="#monte-carlo-integration">Monte Carlo Integration</a></li>
  <li><a href="#markov-chain-monte-carlo" id="toc-markov-chain-monte-carlo" class="nav-link" data-scroll-target="#markov-chain-monte-carlo">Markov Chain Monte Carlo</a>
  <ul class="collapse">
  <li><a href="#metropolis-algorithm" id="toc-metropolis-algorithm" class="nav-link" data-scroll-target="#metropolis-algorithm">Metropolis Algorithm</a></li>
  <li><a href="#sampling-from-exponential" id="toc-sampling-from-exponential" class="nav-link" data-scroll-target="#sampling-from-exponential">Sampling from Exponential</a></li>
  <li><a href="#mcmc-for-bayesian-sampling" id="toc-mcmc-for-bayesian-sampling" class="nav-link" data-scroll-target="#mcmc-for-bayesian-sampling">MCMC for Bayesian Sampling</a></li>
  <li><a href="#gibbs-sampler" id="toc-gibbs-sampler" class="nav-link" data-scroll-target="#gibbs-sampler">Gibbs Sampler</a>
  <ul class="collapse">
  <li><a href="#example-setup" id="toc-example-setup" class="nav-link" data-scroll-target="#example-setup">Example Setup</a></li>
  <li><a href="#resume-example" id="toc-resume-example" class="nav-link" data-scroll-target="#resume-example">Resume Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this notebook, we begin by reviewing some of the basics of <strong>probability</strong> and <strong>Bayes rule</strong>, then make out way into <strong>markov chains</strong>, and <strong>monte-carlo sampling</strong>, combining them to give us <strong>MCMC</strong>, and then instate this in the <strong>Gibbs Sampler</strong>.</p>
<p>By the end, we will generate and understand the following animation:</p>
<p><img src="gibbs.gif" class="img-fluid"></p>
<section id="changelog" class="level2">
<h2 class="anchored" data-anchor-id="changelog">Changelog</h2>
<ul>
<li>2023-02-24 - first published using quarto</li>
</ul>
</section>
<section id="animations" class="level2">
<h2 class="anchored" data-anchor-id="animations">Animations</h2>
<p>This notebook can (re)generate animations of optimization procedures, but that can take quite some time. In its place, you can use pre-generated GIFs/MP4s by togglnig this flag:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>reanimate_gifs <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="notebook-setup" class="level2">
<h2 class="anchored" data-anchor-id="notebook-setup">Notebook Setup</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn.datasets</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpl_toolkits.mplot3d <span class="im">import</span> Axes3D</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> cm</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for creating animations</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.animation</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML, Video</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># styling additions</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># style = "&lt;style&gt;div.warn{background-color: #fcf2f2;border-color: #dFb5b4; border-left: 5px solid #dfb5b4; padding: 0.5em;}&lt;/style&gt;"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>style <span class="op">=</span> <span class="st">"&lt;style&gt;div.info{padding: 15px; border: 1px solid transparent; border-left: 5px solid #dfb5b4; border-color: transparent; margin-bottom: 10px; border-radius: 4px; background-color: #fcf8e3; border-color: #faebcc;}&lt;/style&gt;"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>HTML(style)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<style>div.info{padding: 15px; border: 1px solid transparent; border-left: 5px solid #dfb5b4; border-color: transparent; margin-bottom: 10px; border-radius: 4px; background-color: #fcf8e3; border-color: #faebcc;}</style>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sns.color_palette()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<svg width="550" height="55"><rect x="0" y="0" width="55" height="55" style="fill:#1f77b4;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="55" y="0" width="55" height="55" style="fill:#ff7f0e;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="110" y="0" width="55" height="55" style="fill:#2ca02c;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="165" y="0" width="55" height="55" style="fill:#d62728;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="220" y="0" width="55" height="55" style="fill:#9467bd;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="275" y="0" width="55" height="55" style="fill:#8c564b;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="330" y="0" width="55" height="55" style="fill:#e377c2;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="385" y="0" width="55" height="55" style="fill:#7f7f7f;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="440" y="0" width="55" height="55" style="fill:#bcbd22;stroke-width:2;stroke:rgb(255,255,255)"></rect><rect x="495" y="0" width="55" height="55" style="fill:#17becf;stroke-width:2;stroke:rgb(255,255,255)"></rect></svg>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sblue,sorange,sgreen,sred <span class="op">=</span> sns.color_palette()[<span class="dv">0</span>:<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="probability-review" class="level1">
<h1>Probability Review</h1>
<p>Lets review the basics, by starting normally 😏</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> np.random.standard_normal(<span class="dv">1000</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>plt.hist(samples)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Lets actually plot the <strong>probability density function (PDF)</strong>:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>rv <span class="op">=</span> norm(loc <span class="op">=</span> <span class="op">-</span><span class="fl">1.</span>, scale <span class="op">=</span> <span class="fl">1.0</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>rv1 <span class="op">=</span> norm(loc <span class="op">=</span> <span class="fl">0.</span>, scale <span class="op">=</span> <span class="fl">2.0</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>rv2 <span class="op">=</span> norm(loc <span class="op">=</span> <span class="fl">2.</span>, scale <span class="op">=</span> <span class="fl">3.0</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="fl">.1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x, rv.pdf(x), label<span class="op">=</span><span class="st">'-1,1'</span>)<span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.plot(x, rv1.pdf(x), label<span class="op">=</span><span class="st">'0,2'</span>)<span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.plot(x, rv2.pdf(x), label<span class="op">=</span><span class="st">'2,3'</span>)<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Lets pick a <strong>standard normal</strong> and plot its PDF and its <strong>cumulative distribution function (CDF)</strong></p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.pdf(x),color<span class="op">=</span>sblue,label<span class="op">=</span><span class="st">'pdf'</span>)<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.cdf(x),color<span class="op">=</span>sorange,label<span class="op">=</span><span class="st">'cdf'</span>)<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Hm… Does this look familiar?</p>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: What does this remind you of?</p>
</div>
<p>After a few minutes thought, you might recall the logistic function, and its derivative that we’ve been using in our neural network discussion!</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sigmoid(z):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">1.0</span><span class="op">/</span>(<span class="fl">1.0</span><span class="op">+</span>np.exp(<span class="op">-</span>z))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sigmoid_prime(z):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sigmoid(z)<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>sigmoid(z))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.plot(x,sigmoid(x),color<span class="op">=</span>sblue,label<span class="op">=</span><span class="st">'sigmoid'</span>)<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.plot(x,sigmoid_prime(x),color<span class="op">=</span>sorange,label<span class="op">=</span><span class="st">'sigmoid_prime'</span>)<span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Hm. Lets plot them together and see!!</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.pdf(x),color<span class="op">=</span>sblue,label<span class="op">=</span><span class="st">'pdf'</span>)<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.cdf(x),color<span class="op">=</span>sorange,label<span class="op">=</span><span class="st">'cdf'</span>)<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.plot(x,sigmoid(x),color<span class="op">=</span>sorange,linestyle<span class="op">=</span><span class="st">'--'</span>,label<span class="op">=</span><span class="st">'sigmoid'</span>)<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>plt.plot(x,sigmoid_prime(x),color<span class="op">=</span>sblue,linestyle<span class="op">=</span><span class="st">'--'</span>,label<span class="op">=</span><span class="st">'sigmoid_prime'</span>)<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: What can you say about this plot?</p>
</div>
<p>Hm. Maybe something non obvious is going on here, so its worth thinking about this for a second, and reminding ourselves of the definitions.</p>
<div class="info">
<p><font size="6">📖 </font><strong>Semi-Definition</strong>: A <strong>cumulative distribution function (CDF)</strong> is (almost) any <strong>monotonically increasing</strong> function whose range is <span class="math inline">(0,1)</span>, describing the probability of a random variable <span class="math inline">X</span> being less than a specific value <span class="math inline">x</span>:</p>
<p><span class="math display">
F_X (x) = P(X \leq x)
</span></p>
</div>
<p><strong>Note:</strong> We aren’t being that careful in our definition (continuity, etc., etc.), but it serves us well enough to illustrate our purposes.</p>
<p><strong>Note:</strong> Monotonically increasing is a fancy way to say <strong>not decreasing.</strong></p>
<p>With this definition in mind, lets revisit the plot of the normal CDF:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.cdf(x),color<span class="op">=</span>sorange,label<span class="op">=</span><span class="st">'cdf'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ok, so what is <span class="math inline">F(0)</span>? Its <span class="math inline">P(X&lt;0)</span>, and we can see that this function tells us that its 0.5! Lets verify:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>norm.cdf(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0.5</code></pre>
</div>
</div>
<p>Ah. What about the sigmoid?</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sigmoid(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.5</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.cdf(x),color<span class="op">=</span>sorange,label<span class="op">=</span><span class="st">'norm cdf'</span>)<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x,sigmoid(x),color<span class="op">=</span>sorange,linestyle<span class="op">=</span><span class="st">'--'</span>,label<span class="op">=</span><span class="st">'sigmoid'</span>)<span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="dv">0</span>,norm.cdf(<span class="dv">0</span>),color<span class="op">=</span>sred,s<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Interesting. So they both agree on this point, but clearly, they don’t agree everywhere!</p>
<p>Wait. <strong>So are we saying that the logistic function is also a CDF?</strong></p>
<p>Yes! Indeed it is!</p>
<p>Well, then we can use this to leap towards the following question:</p>
<p>If <code>sigmoid</code> is the CDF, then what is <code>sigmoid_prime</code>?</p>
<p>Well by our graph above, it sure looks a lot like a Gaussian density/PDF!</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x,norm.pdf(x),color<span class="op">=</span>sblue,label<span class="op">=</span><span class="st">'pdf'</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x,sigmoid_prime(x),color<span class="op">=</span>sblue,linestyle<span class="op">=</span><span class="st">'--'</span>,label<span class="op">=</span><span class="st">'sigmoid_prime'</span>)<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Indeed it is! <code>sigmoid_prime</code> is a PDF! So we have “discovered” the following relationship between CDFs and PDFs:</p>
<div class="info">
<p><font size="6">📖 </font><strong>Semi-Definition</strong>: A <strong>probability density function (PDF)</strong> is the <strong>derivative</strong> of a CDF:</p>
<p><span class="math display">
f_X(x) = \frac{d}{dx}F_X(x)
</span></p>
<p>Accordingly, the probability of <span class="math inline">X</span> falling within a range <span class="math inline">(a,b)</span> is given by:</p>
<p><span class="math display">
P(a \leq X \leq b) = \int_a^b f_X(x) dx
</span></p>
</div>
<p>It should be easy to see then that:</p>
<p><span class="math display">
P(-\infty \leq X \leq x) = \int_{-\infty}^{x} f_X(u)du = F_X(x)
</span></p>
<div class="info">
<p><font size="6">🧐 </font><strong>Note</strong>: There is <strong>much</strong> more we can say here about PDFs vs PMFs. For example:</p>
<ul>
<li>how they are <strong>not</strong> the same thing</li>
<li>how the prob of a continuous RV taking on a specific point is 0.</li>
<li>inverse CDFs, and inverse transform sampling</li>
<li>etc.</li>
</ul>
<p>Keep these technicalities in your mind, though we will freely be jumping between continuous and discrete RVs in our treatment since you’ve all already had a formal probability class.</p>
</div>
<section id="thinking-about-the-tails" class="level2">
<h2 class="anchored" data-anchor-id="thinking-about-the-tails">Thinking about the tails</h2>
<p>Ok, so whats the difference between the gaussian density and the logistic density?</p>
<p><strong>Its all in the tails</strong>.</p>
<p>This is a <strong>fantastic thinking tool</strong> to keep in mind when you’re thinking about the behavior of distributions/probabilistic objects.</p>
<p>In order to aid this kind of thinking, we will do something very common in probability. Instead of thinking of them <em>directly</em>, we will think about <strong>log-probabilities</strong>.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig,(ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">100</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,norm.pdf(x))<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Gaussian PDF'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,norm.logpdf(x),color<span class="op">=</span>sorange)<span class="op">;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Log PDF of a Gaussian'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="6">🧐 </font><strong>Pause-and-ponder</strong>: Does the shape of this make sense? Why or why not?</p>
</div>
<p>Lets compare this to the logistic density we gave above:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> logistic</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fig,(ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">100</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,logistic.pdf(x))<span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'Logistic PDF'</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,logistic.logpdf(x),color<span class="op">=</span>sorange)<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Log PDF of a Logistic'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Hm. Lets plot them together to get a better idea, and add in a <strong>cauchy</strong> distribution:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> logistic</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> cauchy</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>fig,(ax1,ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="dv">100</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,norm.pdf(x),label<span class="op">=</span><span class="st">'norm'</span>)<span class="op">;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,logistic.pdf(x),linestyle<span class="op">=</span><span class="st">'--'</span>,label<span class="op">=</span><span class="st">'logistic'</span>)<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,cauchy.pdf(x),linestyle<span class="op">=</span><span class="st">':'</span>,label<span class="op">=</span><span class="st">'cauchy'</span>)<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'PDFs'</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="op">;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,norm.logpdf(x),label<span class="op">=</span><span class="st">'norm'</span>)<span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,logistic.logpdf(x),linestyle<span class="op">=</span><span class="st">'--'</span>,label<span class="op">=</span><span class="st">'logsitic'</span>)<span class="op">;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,cauchy.logpdf(x),linestyle<span class="op">=</span><span class="st">':'</span>,label<span class="op">=</span><span class="st">'cauchy'</span>)<span class="op">;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'Log PDFs'</span>)<span class="op">;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="op">-</span><span class="dv">5</span>,<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>ax2.legend()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Play around with the graph above, and lets discuss what we observe:</p>
</section>
</section>
<section id="the-log" class="level1">
<h1>The Log</h1>
<p>Lets look a bit deeper into the log:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="fl">1e-3</span>,<span class="fl">1e3</span>,<span class="dv">1000</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fig,(ax1,ax2)<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>),sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,np.log(x))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax2.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,np.log(x))<span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e-3</span>,<span class="fl">1e-2</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>,label<span class="op">=</span><span class="st">'1e-3,1e-2'</span>)<span class="op">;</span>ax2.legend()<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>,label<span class="op">=</span><span class="st">'1e-3,1e-2'</span>)<span class="op">;</span>ax1.legend()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e-2</span>,<span class="fl">1e-1</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e-1</span>,<span class="dv">1</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="dv">1</span>,<span class="dv">10</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="dv">10</span>,<span class="fl">1e2</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e2</span>,<span class="fl">1e3</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The distance between <code>0.000001</code> and <code>0.0000001</code> is as <strong>big as the distance between <code>100</code> and <code>1000</code></strong>. Or the distance between <code>00000000000.1</code> and <code>000000000000.1</code></p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="fl">1e-3</span>,<span class="fl">1e2</span>,<span class="dv">1000</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fig,(ax1,ax2)<span class="op">=</span>plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>),sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,np.log(x))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>ax2.set_xscale(<span class="st">'log'</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ax2.plot(x,np.log(x))<span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e-3</span>,<span class="fl">1e-2</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e-2</span>,<span class="fl">1e-1</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="fl">1e-1</span>,<span class="dv">1</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="dv">1</span>,<span class="dv">10</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>xs<span class="op">=</span>np.linspace(<span class="dv">10</span>,<span class="fl">1e2</span>)<span class="op">;</span>ax2.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span>ax1.plot(xs,np.log(xs),linewidth<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="bayes-rule" class="level1">
<h1>Bayes Rule</h1>
<p>Now we’ve come to a very simple to prove, but very powerful theorem in probability, Bayes rule.</p>
<p>Lets start with the following observations:</p>
<p><span class="math display">
\begin{align}
P(A,B) &amp;= P(A)P(B|A) \\
       &amp;= P(B)P(A|B)
\end{align}
</span></p>
<p>So:</p>
<p><span class="math display">
P(A)P(B|A) = P(B)P(A|B)
</span></p>
<p>Solving for one of them:</p>
<p><span class="math display">
P(B|A) = \frac{P(B)P(A|B)}{P(A)}
</span></p>
<p>And thats it! This is Bayes rule!</p>
<p>This is the simple probability rule presentation, but its usually stated like this:</p>
<p>Let <span class="math inline">X</span> be a random variable representing a latent (hidden) property you would <strong>like to learn something about by gathering a dataset <span class="math inline">Y</span>.</strong></p>
<p>Well, then we specify a <strong>prior distribution</strong> over our latent variable <span class="math inline">X</span>: <span class="math inline">P(X)</span>. This represent any information we have (or think we have) about <span class="math inline">X</span> <strong>before</strong> seeing any data.</p>
<p>As an example, lets imagine we specify a Gaussian density: <span class="math inline">\mathcal{N}(3,2)</span>:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>prior <span class="op">=</span> <span class="kw">lambda</span> points: norm.pdf(points,loc<span class="op">=</span><span class="dv">3</span>,scale<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x,prior(x))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note: this does <strong>not</strong> specify a probability of zero anywhere!</p>
<hr>
<p>We also specify a <strong>likelihood</strong>: <span class="math inline">P(Y|X)</span> which is a <strong>conditional probability</strong> telling us how likely our data is <strong>under different values of <span class="math inline">X</span></strong>.</p>
<p><strong>Note</strong>: This likelihood is <strong>a (conditional) distribution over <span class="math inline">y</span>s!</strong>. That is to say, once we specify a specific <span class="math inline">X=x</span> value to condition on, we have a distribution over all of our <span class="math inline">Y</span>!</p>
<p>Think about this point - its a very common point of confusion for students when they are first starting out.</p>
<p>Lets give one:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="dv">48</span>,<span class="dv">84</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>likelihood <span class="op">=</span> <span class="kw">lambda</span> points,xval: norm.pdf(points,loc<span class="op">=</span>xval,scale<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, lets plot this conditional probability for a specific x value:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>x_cond <span class="op">=</span> <span class="dv">68</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>plt.plot(y,likelihood(y,x_cond))<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"likelihood: N(</span><span class="sc">{</span>x_cond<span class="sc">}</span><span class="ss">,10)"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>How does this behave for different values of x? Lets plot it!</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>x_range <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">1000</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>y_range <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">40</span>,<span class="dv">40</span>,<span class="dv">1000</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>X,Y <span class="op">=</span> np.meshgrid(x_range,y_range)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> likelihood(Y,X)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ax.plot_surface(X,Y,vals,cmap<span class="op">=</span><span class="st">'coolwarm'</span>)<span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'X'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Y'</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>ax.view_init(elev<span class="op">=</span><span class="dv">20</span>,azim<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> reanimate_gifs:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> fig.add_subplot(projection<span class="op">=</span><span class="st">'3d'</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    ax.plot_surface(X,Y,vals,cmap<span class="op">=</span><span class="st">'coolwarm'</span>)<span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'X'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Y'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_graph(angle):</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        ax.view_init(elev<span class="op">=</span><span class="dv">30</span>,azim<span class="op">=</span>angle<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, update_graph,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                                             frames<span class="op">=</span><span class="bu">range</span>(<span class="dv">100</span>),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>                                             interval<span class="op">=</span><span class="dv">50</span>, blit<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'rotating_likelihood.mp4'</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'rotating_likelihood.mp4'</span>, width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<video src="rotating_likelihood.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<hr>
<p>We then multiply these two distributions to get the <strong>numerator</strong> in Bayes rule. This is <strong>not</strong> a true distribution (it does not integrate to 1). It needs to be <strong>normalized</strong>, by the <strong>model evidence</strong> <span class="math inline">P(Y)</span>:</p>
<p><span class="math display">
\frac{P(X)P(Y|X)}{P(Y)}
</span></p>
<p>The model evidence is also almost always <strong>calculated</strong> using the law of <strong>total probability</strong>:</p>
<p><span class="math display">
P(Y) = \sum_i P(Y|X_i)P(X_i)
</span></p>
<p>So you will often find Bayes rule written as:</p>
<p><span class="math display">
P(X|Y) = \frac{P(X)P(Y|X)}{\sum_i P(X_i)P(Y|X_i)}
</span></p>
<p>The conditional distribution Bayes rule gives us is called <strong>the posterior distribution</strong>.</p>
<p>So, one way to describe what Bayes rule is doing, is allowing us to <strong>update our prior beliefs</strong> represented by the <strong>prior distribution</strong> <span class="math inline">P(X)</span>, by gathering <strong>evidence/data</strong>, represented by the <strong>normalized-likelihood</strong>: <span class="math inline">\frac{P(Y|X)}{\sum_i P(X_i)P(Y|X_i)}</span> to generate the posterior (conditional) distribution <span class="math inline">P(X|Y)</span>.</p>
<p><span class="math display">
P(X) \overset{\text{Bayes Rule}}{\longrightarrow} P(X|Y)
</span></p>
<p>Another way to say this, is that it gives us a principled way to update our beliefs after gathering evidence.</p>
<section id="drug-testing-example" class="level2">
<h2 class="anchored" data-anchor-id="drug-testing-example">Drug testing example</h2>
<p>A common example problem for Bayes rule is the drug testing problem.</p>
<p>Lets assume the following:</p>
<ul>
<li>probability of a general member of the public having a disease is <span class="math inline">1/100000</span></li>
<li>probability of having a symptom given that you have the disease is: <span class="math inline">1</span>.</li>
<li>probability of a non-diseased person having a symptom is: <span class="math inline">1/10000</span>.</li>
<li></li>
</ul>
<p><span class="math display">
\begin{align}
P(\text{Disease} | \text{Symptoms}) &amp;= \frac{P(\text{Disease})\;P(\text{Symptoms}|\text{Disease})}{P(\text{Symptoms})} \\
&amp; = \frac{P(\text{Disease})\;P(\text{Symptoms}|\text{Disease})}{P(\text{Symptoms}|\text{Disease})P(\text{Disease}) + P(\text{Symptoms}|\text{NON-Disease})P(\text{NON-Disease})}
\end{align}
</span></p>
</section>
</section>
<section id="coin-flip-example" class="level1">
<h1>Coin flip example</h1>
<p>Often, any difficulty in sampling from the posterior distribution is side-stepped, by using <strong>conjugate priors</strong>. That is, priors that when multiplied by a particular likelihood, give you a known analytical form of the posterior.</p>
<p>For example, a guassian prior and likelihood give you a gaussian prior.</p>
<p>Then there is the usual coin-flip problem, where we are trying to guess the “fairness” (head/tails probability) of a coin <span class="math inline">\theta</span>, based on flips <span class="math inline">D</span>.</p>
<p>For this problem, a natural likelihood is the binomial/bernoulli distribution, and its conjugate prior is the beta distribution.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> stats.beta</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>n_trials <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">500</span>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> stats.bernoulli.rvs(<span class="fl">0.6</span>, size<span class="op">=</span>n_trials[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">10</span>))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, N <span class="kw">in</span> <span class="bu">enumerate</span>(n_trials):</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    sx <span class="op">=</span> plt.subplot(<span class="bu">int</span>(<span class="bu">len</span>(n_trials)<span class="op">/</span><span class="dv">2</span>), <span class="dv">2</span>, k<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"$p$, probability of heads"</span>) <span class="op">\</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> k <span class="kw">in</span> [<span class="dv">0</span>, <span class="bu">len</span>(n_trials)<span class="op">-</span><span class="dv">1</span>] <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    plt.setp(sx.get_yticklabels(), visible<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    heads <span class="op">=</span> data[:N].<span class="bu">sum</span>()</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> dist.pdf(x, <span class="dv">1</span> <span class="op">+</span> heads, <span class="dv">1</span> <span class="op">+</span> N <span class="op">-</span> heads)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, y, label<span class="op">=</span><span class="st">"observe </span><span class="sc">%d</span><span class="st"> tosses,</span><span class="ch">\n</span><span class="st"> </span><span class="sc">%d</span><span class="st"> heads"</span> <span class="op">%</span> (N, heads))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(x, <span class="dv">0</span>, y, color<span class="op">=</span><span class="st">"#348ABD"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    plt.vlines(<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">4</span>, color<span class="op">=</span><span class="st">"k"</span>, linestyles<span class="op">=</span><span class="st">"--"</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    leg <span class="op">=</span> plt.legend()</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    leg.get_frame().set_alpha(<span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>coin_prob <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> stats.beta</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>n_trials <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> stats.bernoulli.rvs(coin_prob, size<span class="op">=</span>n_trials[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1000</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> reanimate_gifs:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">10</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> plt.gca()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    dist_plot,<span class="op">=</span>plt.plot([],[])</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim([<span class="op">-</span><span class="fl">0.1</span>,<span class="fl">24.1</span>])</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    ax.axes.get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_plot(i):</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> n_trials[i]</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        heads <span class="op">=</span> data[:N].<span class="bu">sum</span>()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> dist.pdf(x, <span class="dv">1</span> <span class="op">+</span> heads, <span class="dv">1</span> <span class="op">+</span> N <span class="op">-</span> heads)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        dist_plot.set_data(x, y)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        ax.fill_between(x, <span class="dv">0</span>, y, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'Trials:</span><span class="sc">{</span>N<span class="sc">}</span><span class="ss">, Heads:</span><span class="sc">{</span>heads<span class="sc">}</span><span class="ss">'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, update_plot,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>                                             frames<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(n_trials)),</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>                                             interval<span class="op">=</span><span class="dv">500</span>, blit<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'coin_flips.mp4'</span>)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'coin_flips.mp4'</span>, width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<video src="coin_flips.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<hr>
</section>
<section id="sampling" class="level1">
<h1>Sampling</h1>
<p>Above, we’ve seen how we can actually use the posterior distribution to represent our updated beliefs, after gathering data.</p>
<p>The problem we will be interested in, is when we <strong>cannot easily sample from the posterior distribution</strong>. This is almost always because we cannot calculate the <strong>normalization constant</strong>!</p>
<p>So, we can only reason about the <strong>shape</strong> of our posterior:</p>
<p><span class="math display">
P(X|Y) \propto P(X) P(Y|X)
</span></p>
<p>This lets us make relative comparisons, and find point estimates, but not directly sample from the posterior!</p>
<p>Critically, it also doesn’t let us reason about the uncertainty in our estimates! For this, we need the actual samples!</p>
<section id="variational-bayes" class="level2">
<h2 class="anchored" data-anchor-id="variational-bayes">Variational Bayes</h2>
<p>Often, you’ll find Bayes rule written with a log:</p>
<p><span class="math display">
\log P(X|Y) = \log P(X) + \log P(Y|X) - \log P(Y)
</span></p>
<p>This form is often used in optimization problems, where we are tying to find a <strong>variational approximation the posterior distribution</strong>.</p>
<p>In these problems, our data is <strong>fixed</strong>, and so we can rewrite Bayes rule to expose this <strong>variational principle</strong>:</p>
<p><span class="math display">
\begin{align}
\log P(Y) &amp;= \log P(X) + \log P(Y|X) - \log P(X|Y) \\
          &amp;= \log P(X) - [\log P(X|Y) - \log P(Y|X)]
\end{align}
</span></p>
<p>Notice that the left hand side <strong>does not change</strong>.</p>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: Think about this. What does this suggest is a good thing to check for in an optimization problem? What is the left hand side? What about the right?</p>
<p>We can think about some pretty advanced methods using this basic observation!</p>
</div>
<p>We will not explore these topics further in this course, but we’ve gone a long way just by exposing you to this kind of thinking!</p>
</section>
<section id="inverse-transform-sampling" class="level2">
<h2 class="anchored" data-anchor-id="inverse-transform-sampling">Inverse Transform Sampling</h2>
<p>Lets start by looking at the CDF of a Gaussian RV:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.linspace(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>),norm.cdf(np.linspace(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>)))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Recall, this tells us:</p>
<p><span class="math display">
F_X(x) = P(X\leq x)
</span></p>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: What happens if I plug in a Gaussian random variable into its own CDF?</p>
<p>What question am I asking in doing so?</p>
</div>
<p>Lets cary the experiment out!</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> np.random.standard_normal(<span class="dv">1000</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plt.hist(samples)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now lets plug them into the CDF and plot:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plt.hist(norm.cdf(samples))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: What do we see here? Does this make sense with what you said above? Think about this!</p>
</div>
<p>Ah - A random variable plugged into its own CDF gives a uniform rv.</p>
<p>Hm. So a CDF tell us the prob that <span class="math inline">X</span> is in a certain range. Well, it shouldn’t surprise you that we can also define an <strong>inverse cdf</strong>, also called a <strong>quantile function</strong>, which is the “inverse” of this property.</p>
<p>So in a CDF you plug in values, and get back a probability. Well, for an inverse CDF you plugin probabilities and get back values!</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">2.1</span>,<span class="fl">2.1</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(x,norm.cdf(x))<span class="op">;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ax2.plot(p,norm.ppf(p),c<span class="op">=</span>sorange)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: What would happen if we plug in uniform values into an inverse CDF? What question is that asking?</p>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> np.random.rand(<span class="dv">10000</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>plt.hist(samples)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plt.hist(norm.ppf(samples))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Aha! So plugging in uniform values into an inverse CDF gives samples from the original CDF!</p>
<p>We’ve discovered <strong>inverse transform sampling</strong>!</p>
<p>If we can: * draw samples from a uniform distribution (easy) * represent a distribution by its CDF (not always easy!)</p>
<p>We can easily draw samples from that distribution!</p>
</section>
<section id="rejection-sampling" class="level2">
<h2 class="anchored" data-anchor-id="rejection-sampling">Rejection Sampling</h2>
<p>Above, we saw one way to sample from a distribution. Lets look at another here.</p>
<p>Lets introduce it by way of a fun problem: try and build a <strong>probabilistic</strong> way to <strong>estimate the value of <span class="math inline">\pi</span>!</strong></p>
<div class="info">
<p><font size="7">🗣</font><strong>Discuss</strong>: Can anyone think of a way to do this? Lets</p>
</div>
<p>Lets do one way: start by taking samples in the unit square:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> np.random.rand(<span class="dv">2000</span>,<span class="dv">2</span>)<span class="op">*</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">7</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(samples[:,<span class="dv">0</span>],samples[:,<span class="dv">1</span>],s<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="6">🧐</font><strong>Pause-and-ponder</strong>: How can we build an estimator for the value of <span class="math inline">\pi</span> from this?</p>
</div>
<p>Try it! Lets plot the unit-circle:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">7</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(samples[:,<span class="dv">0</span>],samples[:,<span class="dv">1</span>],s<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>np.pi, <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.sqrt(<span class="fl">1.0</span>)<span class="op">;</span>x1 <span class="op">=</span> r<span class="op">*</span>np.cos(theta)<span class="op">;</span>x2 <span class="op">=</span> r<span class="op">*</span>np.sin(theta)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plt.plot(x1,x2,<span class="st">'r'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ah. So lets take the ratio of samples that fall in the unit circle, as an estimator <strong>for its area</strong>, and the total number of samples as estimator <strong>for the the area of the square</strong>.</p>
<p>With this, we can calculate:</p>
<p><span class="math display">
\frac{\text{area of circle}}{\text{area of square}} = \frac{\pi r^2}{(2r)^2}  = \frac{\pi}{4}
</span></p>
<p>So the ratio of our areas is an estimator for <span class="math inline">\pi/4</span>!</p>
<p>Lets see how many samples fall within the unit circle:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>inCirc <span class="op">=</span> samples[:,<span class="dv">0</span>]<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> samples[:,<span class="dv">1</span>]<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets plot them:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">7</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>plt.scatter(samples[:,<span class="dv">0</span>],samples[:,<span class="dv">1</span>],s<span class="op">=</span><span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.plot(x1,x2,<span class="st">'r'</span>)<span class="op">;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(samples[inCirc][:,<span class="dv">0</span>],samples[inCirc][:,<span class="dv">1</span>],s<span class="op">=</span><span class="dv">5</span>,c<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ok! So we can count the proportion of red circles to total circles, giving us an estimate of the area of the circle relative to the square:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>relArea <span class="op">=</span> <span class="bu">len</span>(samples[inCirc])<span class="op">/</span><span class="bu">len</span>(samples)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>relArea</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>0.783</code></pre>
</div>
</div>
<p>Lets multiply by 4 to see how we did!</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pi_est <span class="op">=</span> relArea<span class="op">*</span><span class="dv">4</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>pi_est</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>3.132</code></pre>
</div>
</div>
<p>Hm. Not bad! Lets write a function and see how we do with more samples:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_pi(samples_list):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> []</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sample_num <span class="kw">in</span> samples_list:</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        samples <span class="op">=</span> np.random.rand(<span class="bu">int</span>(sample_num),<span class="dv">2</span>)<span class="op">*</span><span class="dv">2</span><span class="op">-</span><span class="dv">1</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        inCirc <span class="op">=</span> samples[:,<span class="dv">0</span>]<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> samples[:,<span class="dv">1</span>]<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;=</span> <span class="dv">1</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        vals.append(<span class="bu">len</span>(samples[inCirc])<span class="op">/</span><span class="bu">len</span>(samples))</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets plot it!</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>samples_list <span class="op">=</span> [<span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>, <span class="fl">1e8</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>pi_estimates <span class="op">=</span> estimate_pi(samples_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>plt.plot(samples_list,[np.pi <span class="op">-</span> curr<span class="op">*</span><span class="dv">4</span> <span class="cf">for</span> curr <span class="kw">in</span> pi_estimates],c<span class="op">=</span><span class="st">'r'</span>)<span class="op">;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>plt.gca().set_xscale(<span class="st">'log'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We’ve looked at fun little rejection sampling problem.</p>
<p>Broadly speaking, <strong>rejection sampling</strong> is interested in using a <strong>proxy distribution</strong> which is <strong>easy to sample from</strong>, to simulate samples from <strong>another distribution</strong> that its usually <strong>hard</strong> to sample from.</p>
<p>It does this by <strong>oversampling</strong> from the easy one, and throwing away the ones that don’t match an inclusion criteria (rejection them). Rejection samplers, therefore, have a concept of “efficiency”, which tell you how many samples you needed to generate to have one included, or how many you ended up throwing away, etc. Or, how many samples do you need to achieve a certain accuracy, etc.</p>
<p>They can be roughly thought of a kind of <strong>Monte Carlo</strong> technique, where <strong>Monte Carlo Methods</strong> can be described as <strong>random sampling algorithms</strong>.</p>
<hr>
</section>
</section>
<section id="markov-chains" class="level1">
<h1>Markov Chains</h1>
<p>There is much more we can say about Monte Carlo methods more broadly, but our interest here is in using <strong>Markov Chains</strong> to build a sampler! Before we do this, lets take some time to explore them.</p>
<p>Before we get to coding, lets give the “formal” definition, based on the Markov property:</p>
<div class="info">
<p><font size="6">📖</font><strong>Definition</strong>: A random <strong>processes</strong> <span class="math inline">X</span> has the <strong>markov property</strong> if for all <span class="math inline">n</span> the following holds:</p>
<p><span class="math display">
P(X_{n+1} | X_1, X_2, \ldots, X_{n}) = P(X_{n+1}|X_{n})
</span></p>
<p>Another way to say this is</p>
<center>
Given the <strong>present</strong>, the <strong>past</strong> and the <strong>future</strong> are <strong>independent!</strong>
</center>
<p>Even simpler:</p>
<p>All you need to know about a markov chain to predict its next state, is its current state. You dont need everything else!</p>
</div>
<p>This property seems strange at first, but it makes intuitive sense if you think about it.</p>
<hr>
<p>Lets imagine the weather as having <strong>three states</strong>: Cold, Sunny, Rainy. (Lets forget about the fact that the real weather can occupy all three of these “states”). That is, any given day is <strong>either</strong> of these three.</p>
<p>Lets first model what the weather would look like if we could randomly pick between these:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>random_weather <span class="op">=</span> np.random.randint(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">30</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.plot(random_weather)<span class="op">;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.yticks(ticks<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Yet another way we can visualize this, is by looking at the state path itself:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">' '</span>.join(np.random.choice([<span class="st">'R'</span>,<span class="st">'C'</span>,<span class="st">'S'</span>],<span class="dv">100</span>).tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>'S C S R S C C C C R S R S C C R C R R R S R C R S C S R S R S C R S R C R S C R R C S R C C R C C C S S R R R S R C C S C S C R C R C R R C R S C C R S R S S S C R S C S C C C S R C R R R R R S R S S'</code></pre>
</div>
</div>
<p>Hm. Lets see how often each state came up:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.hist(random_weather)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Pretty “uniform” I guess!</p>
<p>But this seems unsatisfying. We can imagine the <em>real</em> weather (not really) has some “stickyness” to it! That is, if it was rainy today, it <em>should</em> be more likely that it its also rainy tomorrow.</p>
<p>Lets visualize what this stickyness looks like, by <strong>simulating</strong> a markov chain!</p>
<p>The first thing we need, is a <strong>transition matrix</strong>. Each row of this matrix tells us the <strong>conditional probability</strong> of being in one state, and moving to any other state.</p>
<p>So, this matrix is: * a square matrix, where its size is <code>num_states x num_states</code> * <strong>each row must sum to 1</strong>.</p>
<p>One way to describe this matrix is:</p>
<p><span class="math display">
\begin{bmatrix}
P\left(\text{tommorow's weather}|\text{Rainy}\right) \\
P\left(\text{tommorow's weather}|\text{Sunny}\right) \\
P\left(\text{tommorow's weather}|\text{Cold}\right) \\
\end{bmatrix}
</span></p>
<p>A bit better:</p>
<p><span class="math display">
\begin{bmatrix}
P(rainy|rainy) &amp; P(sunny|rainy) &amp; P(cold|rainy) \\
P(rainy|sunny) &amp; P(sunny|sunny) &amp; P(cold|sunny) \\
P(rainy|cold) &amp; P(sunny|cold) &amp; P(cold|cold) \\
\end{bmatrix}
</span></p>
<p>Aha! So the diagonals of this matrix give us the probability of remaining in a state! The off-diagonals give us the probability of transitioning away from the current state.</p>
<p>Lets creaste one by hand to start off:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.array([[<span class="dv">1</span><span class="op">-</span>eps,eps<span class="op">/</span><span class="dv">2</span>,eps<span class="op">/</span><span class="dv">2</span>],     <span class="co"># If rainy, moving to rainy, sunny, cold</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>              [eps<span class="op">/</span><span class="dv">2</span>,   <span class="dv">1</span><span class="op">-</span>eps,eps<span class="op">/</span><span class="dv">2</span>],     <span class="co"># If sunny, moving to rainy, sunny, cold</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>              [eps<span class="op">/</span><span class="dv">2</span>,eps<span class="op">/</span><span class="dv">2</span>,<span class="dv">1</span><span class="op">-</span>eps]])    <span class="co"># if cold,  moving to rainy, sunny, cold</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ok! Now our task is to <strong>simulate</strong> this chain, according to this transition matrix!</p>
<p>So, starting at some initial state, we want to pick a state according to the “correct” distribution.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>s_0 <span class="op">=</span> <span class="dv">0</span> <span class="co"># rainy</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>steps <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> []</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>states.append(s_0)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the walk</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, steps):</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    s_curr <span class="op">=</span> states[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    p_curr <span class="op">=</span> p[s_curr,:]</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    s_next <span class="op">=</span> np.random.choice([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],p<span class="op">=</span>p_curr)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    states.append(s_next)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>plt.plot(states)<span class="op">;</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>plt.yticks(ticks<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-54-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Hm. This is indeed qualitatively different!</p>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>: Play around with the above, and jot down some observations below!</p>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plt.hist(states)<span class="op">;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>plt.xticks(ticks<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-55-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ok, lets make this into a function, so we can keep going!</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulate_chain(s_0, p, steps):</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> []</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    states.append(s_0)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate the walk</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, steps):</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        s_prev <span class="op">=</span> states[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        p_curr <span class="op">=</span> p[s_prev,:]</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        s_t <span class="op">=</span> np.random.choice([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],p<span class="op">=</span>p_curr)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>        states.append(s_t)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(states)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> simulate_chain(<span class="dv">1</span>,p,<span class="dv">300</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">7</span>))</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>plt.plot(states)<span class="op">;</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>plt.yticks(ticks<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-56-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Lets simulate multiple random walks! From random starting positions!</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="fl">1e-4</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.array([[<span class="dv">1</span><span class="op">-</span>eps,eps,<span class="dv">0</span>],     <span class="co"># If rainy, moving to rainy, sunny, cold</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>              [<span class="dv">0</span>,<span class="dv">1</span><span class="op">-</span>eps,eps],     <span class="co"># If sunny, moving to rainy, sunny, cold</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>              [eps,<span class="dv">0</span>,<span class="dv">1</span><span class="op">-</span>eps]])    <span class="co"># if cold,  moving to rainy, sunny, cold</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>num_walks <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>steps <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>walks_mat <span class="op">=</span> np.zeros((num_walks,steps))</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># go through each chain</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> walk <span class="kw">in</span> <span class="bu">range</span>(num_walks):</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    s_0 <span class="op">=</span> np.random.choice([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    walks_mat[walk,:] <span class="op">=</span> simulate_chain(s_0,p,steps)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>fig,(ax1,ax2,ax3) <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>,figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>),sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>plt.yticks(ticks<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(walks_mat[walks_mat[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>].T,c<span class="op">=</span>sred,alpha<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>ax2.plot(walks_mat[walks_mat[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>].T,c<span class="op">=</span>sblue,alpha<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>ax3.plot(walks_mat[walks_mat[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">2</span>].T,c<span class="op">=</span>sorange,alpha<span class="op">=</span><span class="fl">0.4</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Before we continue the analysis, lets look at another type of common example: modeling a change in population.</p>
<p>Here we’re going to consider a Markov chain which represents the population of a group of people on an island. To simplify our analysis, were going to assume that there can only be a maximum of <span class="math inline">100</span> of people alive on this island at any one time.</p>
<p>At each point in time: * 1 additional person can arrive on the ferry * 1 person can leave on the ferry * Or nothing: there is no change in our population</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span>    <span class="co"># maximum population size</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>prob_change <span class="op">=</span> [<span class="fl">0.1</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>]   <span class="co"># arrive, leave, no change</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="53">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>nsteps <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.zeros(nsteps)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(nsteps <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;</span> x[t] <span class="op">&lt;</span> N <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        pop_change <span class="op">=</span> np.random.choice([<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>],p<span class="op">=</span>prob_change)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>        x[t <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> x[t] <span class="op">+</span> pop_change</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The evolution stops if we reach $0$ or $N$.</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        x[t <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> x[t]</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>ax.plot(x, lw<span class="op">=</span><span class="dv">2</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>: Play around with the above, and jot down some observations below!</p>
</div>
<p>Lets make it into a function to play around!</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_island_chains(n_steps,n_chains,initial_pop,prob_change):</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.zeros((n_steps,n_chains))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chain_idx <span class="kw">in</span> <span class="bu">range</span>(n_chains):</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        x[<span class="dv">0</span>,chain_idx] <span class="op">=</span> initial_pop</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># run the chain</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(n_steps <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;</span> x[t,chain_idx] <span class="op">&lt;</span> N <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                pop_change <span class="op">=</span> np.random.choice([<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>],p<span class="op">=</span>prob_change)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                x[t <span class="op">+</span> <span class="dv">1</span>,chain_idx] <span class="op">=</span> x[t,chain_idx] <span class="op">+</span> pop_change</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The evolution stops if we reach $0$ or $N$.</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>                x[t <span class="op">+</span> <span class="dv">1</span>,chain_idx] <span class="op">=</span> x[t,chain_idx]</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>n_steps <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>n_chains <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>initial_pop <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>prob_change <span class="op">=</span> [<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.8</span>]   <span class="co"># arrive, leave, no change</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>chains <span class="op">=</span> run_island_chains(n_steps,n_chains,initial_pop,prob_change)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>ax.plot(chains,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>: Play around with the above, and jot down some observations below!</p>
</div>
<p>What does it mean for our chain to “stop moving” if it reaches 100 or 0? How can we visualize the evolution of a chain without running it?</p>
<p>Well, we can describe a Markov Chain by a directed graph often called a <strong>State Transition Diagram</strong>.</p>
<p>For the weather chain above, it would look like:</p>
<hr>
<p>Lets make it together!</p>
<p>Add it here when we’re done!</p>
<hr>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>: What about for the population example?</p>
</div>
<section id="evolving-distributions" class="level2">
<h2 class="anchored" data-anchor-id="evolving-distributions">Evolving Distributions</h2>
<p>Previously, we’ve been simulating a chain and plotting trajectories to try and understand them.</p>
<p>But we can do better!</p>
<p>We can do better by imagining not running a particular chain, but asking ourselves, how does a transition matrix <strong>affect a distribution</strong>?</p>
<p>Or, given a <strong>starting distribution</strong>, what can I say about the <strong>ending distribution</strong>?</p>
<p>This idea may seem strange at first. Maybe even at second! But thats ok - let dig in and explore it some more.</p>
<p>Lets go back to the weather example:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>p_weather <span class="op">=</span> np.array([[<span class="fl">0.7</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>],     <span class="co"># If rainy, moving to rainy, sunny, cold</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                     [<span class="fl">0.1</span>, <span class="fl">0.8</span>,<span class="fl">0.1</span>],     <span class="co"># If sunny, moving to rainy, sunny, cold</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                     [<span class="fl">0.1</span>,<span class="dv">0</span>,<span class="fl">0.9</span>]])    <span class="co"># if cold,  moving to rainy, sunny, cold</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets pick a simple starting distribution: We always start in the raining state. Well, then this would be:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>initial_dist <span class="op">=</span> np.array([<span class="fl">0.5</span>,<span class="fl">0.4</span>,<span class="fl">0.1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we try and understand the formula, lets first try to “run it through once” and understand the result:</p>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>:What are we looking at here? What do you notice? Discuss!</p>
</div>
<p>Hm. Lets check our understanding by running it through twice!</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>(initial_dist.dot(p_weather)).dot(p_weather)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>array([0.34 , 0.416, 0.244])</code></pre>
</div>
</div>
<p>Hm… what do we notice?</p>
<p>What if we keep going? Lets try to make this a bit nicer so we can see whats happening:</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>num_steps <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> [initial_dist]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>step <span class="op">=</span> initial_dist.dot(p_weather)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>dists.append(step)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_steps):</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    step <span class="op">=</span> step.dot(p_weather)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    dists.append(step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> reanimate_gifs:</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    markerline,stemline,baseline <span class="op">=</span> ax.stem(dists[<span class="dv">0</span>],basefmt<span class="op">=</span><span class="st">'--w'</span>,use_line_collection<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    plt.xticks([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_graph(frame):</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        ax.cla()<span class="op">;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>        markerline, stemlines, baseline <span class="op">=</span> ax.stem(dists[frame],basefmt<span class="op">=</span><span class="st">'--w'</span>,use_line_collection<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>        ax.set_ylim((<span class="op">-</span><span class="fl">0.01</span>, <span class="fl">1.01</span>))<span class="op">;</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        plt.xticks([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>],labels<span class="op">=</span>[<span class="st">'Rainy'</span>,<span class="st">'Sunny'</span>,<span class="st">'Cold'</span>],fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'Step:</span><span class="sc">{</span>frame<span class="sc">}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        xs <span class="op">=</span> np.array([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>        ys <span class="op">=</span> np.array(dists[frame])</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x,y <span class="kw">in</span> <span class="bu">zip</span>(xs,ys):</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>            plt.annotate(<span class="ss">f'</span><span class="sc">{</span>y<span class="sc">:.2f}</span><span class="ss">'</span>, xy<span class="op">=</span>(x,y), xytext<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">5</span>), </span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>                         textcoords<span class="op">=</span><span class="st">'offset points'</span>,ha<span class="op">=</span><span class="st">'center'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, update_graph, </span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>                                              frames<span class="op">=</span><span class="bu">range</span>(<span class="bu">len</span>(dists)), interval<span class="op">=</span><span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'mc_evolve.mp4'</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'mc_evolve.mp4'</span>, width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<video src="mc_evolve.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>:What are we looking at here? What do you notice? Discuss!</p>
</div>
<p>We’ve discovered the stationary distribution of this chain!</p>
<p><strong>Its the distribution of where we can expect to find the chain after enough time!</strong></p>
<p>Interestingly (very much so!) we can calculate this by <strong>taking the matrix power of the transition matrix directly!</strong></p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>np.linalg.matrix_power(p_weather,num_steps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>array([[0.25, 0.25, 0.5 ],
       [0.25, 0.25, 0.5 ],
       [0.25, 0.25, 0.5 ]])</code></pre>
</div>
</div>
<p>Then, we just left-multiply this by our initial distribution:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>initial_dist.dot(np.linalg.matrix_power(p_weather,num_steps))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>array([0.25, 0.25, 0.5 ])</code></pre>
</div>
</div>
<hr>
<p>Lets bring back the population example and make it more interesting. To make it explicit, lets create that “big” transition matrix I told you about previously:</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>eps <span class="op">=</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>  <span class="co"># prob </span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>prob_change_island <span class="op">=</span> np.array([<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>])   <span class="co"># leave, no change, arrive</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>p_island <span class="op">=</span> np.zeros((<span class="dv">101</span>,<span class="dv">101</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>p_island[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>     <span class="co"># if we are at zero, we stay at zero</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>p_island[<span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span>   <span class="co"># if we are 100, we stay at 100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p_island = np.zeros((101,101))</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> curr_pop <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">100</span>):</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    p_island[curr_pop,curr_pop<span class="op">-</span><span class="dv">1</span>:curr_pop<span class="op">+</span><span class="dv">2</span>] <span class="op">=</span> prob_change_island</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>p_island</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>array([[1.        , 0.        , 0.        , ..., 0.        , 0.        ,
        0.        ],
       [0.33333333, 0.33333333, 0.33333333, ..., 0.        , 0.        ,
        0.        ],
       [0.        , 0.33333333, 0.33333333, ..., 0.        , 0.        ,
        0.        ],
       ...,
       [0.        , 0.        , 0.        , ..., 0.33333333, 0.33333333,
        0.        ],
       [0.        , 0.        , 0.        , ..., 0.33333333, 0.33333333,
        0.33333333],
       [0.        , 0.        , 0.        , ..., 0.        , 0.        ,
        1.        ]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>(np.<span class="bu">sum</span>(p_island,axis<span class="op">=</span><span class="dv">1</span>)<span class="op">==</span><span class="dv">1</span>).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>True</code></pre>
</div>
</div>
<p>Now lets simulate it!</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>num_steps <span class="op">=</span> <span class="dv">3000</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>initial_dist <span class="op">=</span> np.zeros(<span class="dv">101</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>initial_dist[<span class="dv">50</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> [initial_dist]</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>step <span class="op">=</span> initial_dist.dot(p_island)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>dists.append(step)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_steps):</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    step <span class="op">=</span> step.dot(p_island)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    dists.append(step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> reanimate_gifs:</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    ax.get_yaxis().set_visible(<span class="va">False</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    markerline,stemline,baseline <span class="op">=</span> ax.stem(dists[<span class="dv">0</span>],basefmt<span class="op">=</span><span class="st">'--w'</span>,use_line_collection<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> update_graph(frame):</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>        ax.cla()<span class="op">;</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>        markerline, stemlines, baseline <span class="op">=</span> ax.stem(dists[frame],basefmt<span class="op">=</span><span class="st">'--w'</span>,use_line_collection<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'Step:</span><span class="sc">{</span>frame<span class="sc">}</span><span class="ss">'</span>)<span class="op">;</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    anim <span class="op">=</span> matplotlib.animation.FuncAnimation(fig, update_graph, </span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>                                              frames<span class="op">=</span><span class="bu">range</span>(<span class="dv">1</span>,<span class="bu">len</span>(dists),<span class="dv">100</span>), interval<span class="op">=</span><span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    plt.close()<span class="op">;</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># HTML(anim.to_html5_video())</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    anim.save(<span class="st">'mc_evolve_2.mp4'</span>)</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>Video(<span class="st">'mc_evolve_2.mp4'</span>, width<span class="op">=</span><span class="dv">800</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<video src="mc_evolve_2.mp4" controls="" width="800">
      Your browser does not support the <code>video</code> element.
    </video>
</div>
</div>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>:What are we looking at here? What do you notice? Discuss!</p>
</div>
<p>Lets use our matrix power formula to verify:</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>end_point <span class="op">=</span> <span class="dv">400</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>plt.stem(initial_dist.dot(np.linalg.matrix_power(p_island,end_point)),use_line_collection<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/1j/c5scsycs1s5_nzj08g133rp40000gn/T/ipykernel_5554/544233340.py:3: MatplotlibDeprecationWarning: The 'use_line_collection' parameter of stem() was deprecated in Matplotlib 3.6 and will be removed two minor releases later. If any parameter follows 'use_line_collection', they should be passed as keyword, not positionally.
  plt.stem(initial_dist.dot(np.linalg.matrix_power(p_island,end_point)),use_line_collection=True);</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-80-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Wow! What have we discovered?</p>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>:What are we looking at here? What do you notice? Discuss!</p>
</div>
</section>
</section>
<section id="monte-carlo-integration" class="level1">
<h1>Monte Carlo Integration</h1>
<p>Above, we described “Monte Carlo methods” as <strong>random sampling schemes</strong>. This is a coarse definition, but it works for our purposes.</p>
<p>We motivated this whole thing by saying we wanted to use these kind of schemes to <strong>estimate an integral</strong> that we couldn’t otherwise calculate.</p>
<p>But - a <strong>huge</strong> open question remains:</p>
<div class="info">
<p><font size="7">🤷🏽‍♂️</font> What does this have to with integration?! <font size="6">📈</font></p>
</div>
<p>Lets remind ourselves of what integration means:</p>
<p>One way to describe this integral: <span class="math display">
\int_a^b f(x)dx
</span></p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Polygon</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> func(x):</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x <span class="op">-</span> <span class="dv">3</span>) <span class="op">*</span> (x <span class="op">-</span> <span class="dv">5</span>) <span class="op">*</span> (x <span class="op">-</span> <span class="dv">7</span>) <span class="op">+</span> <span class="dv">85</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>a, b <span class="op">=</span> <span class="dv">2</span>, <span class="dv">9</span>  <span class="co"># integral limits</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> func(x)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create plot</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, <span class="st">'r'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(bottom<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the shaded region</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>ix <span class="op">=</span> np.linspace(a, b)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>iy <span class="op">=</span> func(ix)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>verts <span class="op">=</span> [(a, <span class="dv">0</span>), <span class="op">*</span><span class="bu">zip</span>(ix, iy), (b, <span class="dv">0</span>)]</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>poly <span class="op">=</span> Polygon(verts, facecolor<span class="op">=</span><span class="st">'0.9'</span>, edgecolor<span class="op">=</span><span class="st">'0.5'</span>)</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>ax.add_patch(poly)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.5</span> <span class="op">*</span> (a <span class="op">+</span> b), <span class="dv">30</span>, <span class="vs">r"$\int_a^b f(x)\mathrm</span><span class="sc">{d}</span><span class="vs">x$"</span>,</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>        horizontalalignment<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.9</span>, <span class="fl">0.05</span>, <span class="st">'$x$'</span>,fontsize<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="st">'$y$'</span>,fontsize<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_ticks_position(<span class="st">'bottom'</span>)</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a>ax.set_xticks((a, b))<span class="op">;</span></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels((<span class="st">'$a$'</span>, <span class="st">'$b$'</span>),fontsize<span class="op">=</span><span class="dv">25</span>)<span class="op">;</span></span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-83-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>If we want to <strong>estimate</strong> this region, one thing we can do is to take the fraction of random points that fall <strong>below</strong> the function <span class="math inline">f</span>, multiplied by the <strong>area</strong> (often referred to as volume or its higher dimension analog: <em>measure</em> in more than 1/2 dimensions) of the region.</p>
<p>Yet another, is to <strong>uniformly sample the function at random points and multiply that by the volume of the region</strong>.</p>
<div class="info">
<p><font size="7">🧑🏽‍🏫</font><strong>Recall:</strong> How are these related to your traditional definition of an integral?</p>
</div>
<hr>
<p>Lets recall the definition of the expected value of a function <span class="math inline">g</span> of a random variable <span class="math inline">X</span>:</p>
<p><span class="math display">
E[g(X)] = \int_\mathbb{R} g(x) p(x) dx
</span></p>
<p>where <span class="math inline">x</span> are specific realizations of the random variable <span class="math inline">X</span>, and <span class="math inline">p(\cdot)</span> is the <em>density</em>.</p>
<p><strong>Note</strong> were skipping all the technical details of this being a <a href="https://en.wikipedia.org/wiki/Lebesgue_integration"><strong>Lebesgue integral</strong></a></p>
<p>If we choose <span class="math inline">g(x) = f(x)/p(x)</span>, then we have:</p>
<p><span class="math display">
\begin{align}
E[g(x)] &amp;= \int \frac{f(x)}{p(x)} p(x) dx \\
        &amp;= \int f(x)dx
\end{align}
</span></p>
<p>which is what we wanted!</p>
<p>If <span class="math inline">p</span> is <strong>uniform</strong> on <span class="math inline">[a,b]</span>, then</p>
<p><span class="math display">
g(x) = \frac{f(x)}{\frac{1}{b-a}} = (b-a)f(x)
</span></p>
<p>The interesting part for us, is that we will <strong>estimate</strong> this integral, using the obvious estimator! The <strong>empirical mean</strong>!</p>
<p><span class="math display">
E_n = \frac{1}{n} \sum g(x_i)
</span></p>
<p>where all <span class="math inline">x_i</span> are drawn from <span class="math inline">p</span>.</p>
<p>Well, the <a href="https://en.wikipedia.org/wiki/Law_of_large_numbers"><strong>Law of Large Numbers</strong></a> guarantees that this approaches the true expected value!</p>
<div class="info">
<p><font size="7">🧑🏽‍🏫</font><strong>Recall:</strong> How is this different than the Central Limit Theorem?</p>
</div>
<hr>
<p>Ok! So we’ve established were going to estimate an integral, using random samples! Lets define our estimator of choice!</p>
<p>Say we want to estimate:</p>
<p><span class="math display">
F = \int_a^b f(x) dx
</span></p>
<p>We will approximate this by <strong>averaging samples of the function <span class="math inline">f</span> at uniform random points in the interval.</strong></p>
<div class="info">
<p><font size="6">📜</font><strong>Definition</strong>: Given a set of <span class="math inline">N</span> uniform random variables: <span class="math inline">X_i \in [a,b)</span>, the <strong>Simple Monte Carlo Estimator</strong> <span class="math inline">F^N</span> is given by:</p>
<p><span class="math display">
F^N = (b-a) \frac{1}{N} \sum^N f(X_i)
</span></p>
</div>
<p>Intuitively, this Monte Carlo estimator computes the mean value of the function <span class="math inline">f(x)</span> over the interval <span class="math inline">a</span> to <span class="math inline">b</span>, and then multiplies this mean by the length of the interval <span class="math inline">(b − a)</span>.</p>
<p>By moving <span class="math inline">(b − a)</span> into the summation, the estimator can be thought of as <strong>choosing a height</strong> at a random evaluation of the function and <strong>averaging a set of rectangular areas</strong> computed by multiplying this height by the interval length <span class="math inline">(b − a)</span>.</p>
<p><img src="mc-int.png" class="img-fluid"></p>
<p>Note: This basic Monte Carlo estimator can easily be extended to <strong>multiple dimensions</strong>, and, in contrast to other deterministic estimation techniques, the convergence rate for Monte Carlo is <strong>independent of the number of dimensions in the integral!</strong>.</p>
<p>This makes Monte Carlo integration the only practical technique for many high dimensional integration problems.</p>
<hr>
<p>Lets look at a simple example and find the integral of <span class="math inline">e</span>!</p>
<p><span class="math display">
\int_0^1 e^x dx
</span></p>
<p>Lets first check the correct analytical solution:</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> symbols, integrate, exp</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> symbols(<span class="st">'x'</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>expr <span class="op">=</span> integrate(exp(x), (x,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>true_val <span class="op">=</span> <span class="bu">float</span>(expr.evalf())</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>true_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>1.7182818284590453</code></pre>
</div>
</div>
<p>Ok! Thats what we have to hit. Lets plot the function, as well as our random samples:</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>pts <span class="op">=</span> np.random.uniform(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">20</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>plt.plot(x, np.exp(x),color<span class="op">=</span>sred,alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(pts, np.exp(pts))</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, np.e])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-85-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>estimates <span class="op">=</span> []</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>points_list <span class="op">=</span> [<span class="fl">1e1</span>, <span class="fl">1e2</span>, <span class="fl">1e3</span>, <span class="fl">1e4</span>, <span class="fl">1e5</span>, <span class="fl">1e6</span>, <span class="fl">1e7</span>, <span class="fl">1e8</span>]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num_points <span class="kw">in</span> points_list:</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">int</span>(num_points))</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    sol <span class="op">=</span> np.mean(np.exp(x))</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    estimates.append(sol)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>estimates <span class="op">=</span> np.array(estimates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>plt.plot(points_list,true_val<span class="op">-</span>estimates,color<span class="op">=</span>sred)<span class="op">;</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>plt.gca().set_xscale(<span class="st">'log'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-87-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ok. Above, we can see “how close we are”, because we know the true value. However, in general <strong>we don’t</strong>.</p>
<p>Indeed, <strong>thats why we’re trying to estimate this in the first place</strong>! So measuring our error is not a good criteria in Monte Carlo integration.</p>
<p>Instead, we want some idea of when our Monte Carlo estimate has “converged”. To get a handle on this, we need to estimate the <strong>variance</strong>.</p>
<p>Lets pick another simple example function to integrate:</p>
<p><span class="math display">
f(x) = x\cos 7x + \sin 13x, \quad 0\leq x \leq 1
</span></p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">*</span> np.cos(<span class="dv">71</span><span class="op">*</span>x) <span class="op">+</span> np.sin(<span class="dv">13</span><span class="op">*</span>x)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>plt.plot(x, f(x))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-88-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As above, lets calculate the analytical solution:</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sympy <span class="im">import</span> sin, cos, symbols, integrate</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> symbols(<span class="st">'x'</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>true_val <span class="op">=</span> <span class="bu">float</span>(integrate(x <span class="op">*</span> cos(<span class="dv">71</span><span class="op">*</span>x) <span class="op">+</span> sin(<span class="dv">13</span><span class="op">*</span>x), (x, <span class="dv">0</span>,<span class="dv">1</span>)).evalf(<span class="dv">6</span>))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>true_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>0.020254939794540405</code></pre>
</div>
</div>
<p>Ok! Lets estimate this by picking 100 points:</p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>pts <span class="op">=</span> np.random.random(<span class="dv">100</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>mc_estimate <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">100</span> <span class="op">*</span> np.<span class="bu">sum</span>(f(pts))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>mc_estimate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>0.06195468921764444</code></pre>
</div>
</div>
<p>As we did above, lets run this experiment <strong>multiple times</strong>, by varying the number of points we use to evaluate the function:</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>num_experiments <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>num_points <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>estimates <span class="op">=</span> np.zeros((num_points,num_experiments))</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> exp_num <span class="kw">in</span> <span class="bu">range</span>(num_experiments):</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> point_nums <span class="kw">in</span> <span class="bu">range</span>(num_points):</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        pts <span class="op">=</span> np.random.random(point_nums<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        estimate <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="bu">len</span>(pts) <span class="op">*</span> np.<span class="bu">sum</span>(f(pts))</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>        estimates[point_nums,exp_num] <span class="op">=</span> estimate</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>upper, lower <span class="op">=</span> np.percentile(estimates, [<span class="fl">2.5</span>, <span class="fl">97.5</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), estimates, c<span class="op">=</span><span class="st">'grey'</span>, alpha<span class="op">=</span><span class="fl">0.02</span>)<span class="op">;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), estimates[:, <span class="dv">0</span>], c<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), upper, <span class="st">'b'</span>, np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), lower, <span class="st">'b'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-92-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>And for completion, this how we could have run this experiment using <strong>broadcasting</strong>:</p>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>num_experiments <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>num_points <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> f(np.random.random((num_points, num_experiments)))</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>estimates <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>)[:, <span class="va">None</span>] <span class="op">*</span> np.cumsum(vals, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>upper, lower <span class="op">=</span> np.percentile(estimates, [<span class="fl">2.5</span>, <span class="fl">97.5</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), estimates, c<span class="op">=</span><span class="st">'grey'</span>, alpha<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), estimates[:, <span class="dv">0</span>], c<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), upper, <span class="st">'b'</span>, np.arange(<span class="dv">1</span>, num_points<span class="op">+</span><span class="dv">1</span>), lower, <span class="st">'b'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-93-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="7">🤷🏽‍♂️</font><strong>Pause-and-ponder</strong>: What is this converging too?</p>
</div>
</section>
<section id="markov-chain-monte-carlo" class="level1">
<h1>Markov Chain Monte Carlo</h1>
<p>Finally! We’ve arrived! Getting here has not been easy! We’ve covered:</p>
<ul>
<li>Markov Chains
<ul>
<li>specifying them</li>
<li>simulating them</li>
<li>stationary distribution emerging after running for a long time</li>
</ul></li>
<li>Monte Carlo methods
<ul>
<li>random sampling schemes to approximate Pi</li>
<li>MC Integration</li>
</ul></li>
</ul>
<p>We <strong>motivated</strong> MCMC, by saying we wanted to use it to sample from a Bayesian posterior. But, this was just a motivation. MCMC is used to sample from a <strong>target distribution</strong> that is difficult to sample from. It is not limited the Bayesian setting.</p>
<p>Suppose we want to sample from a distribution <span class="math inline">\pi</span>, which we will call the <strong>target distribution</strong>. Below, we will introduce the <strong>Metropolis Algorithm</strong>, which <strong>simulates a Markov Chain</strong> whose <strong>stationary distribution</strong> is <span class="math inline">\pi</span>!.</p>
<p>This means that, <strong>in the long run</strong>, the samples from the Markov chain look like the samples from <span class="math inline">\pi</span>. As we will see, the algorithm is incredibly simple and flexible. Its main limitation is that, for difficult problems, “in the long run” may mean <strong>after a very long time</strong>.</p>
<hr>
<section id="metropolis-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="metropolis-algorithm">Metropolis Algorithm</h2>
<p>Lets first state the algorithm, and then try and analyze it.</p>
<p>We begin by picking, or specifying, a <strong>proposal distribution</strong>, or <strong>transition kernel</strong>: <span class="math inline">Q</span>. You can think of it as specifying a <strong>probabilistic</strong> way of moving, randomly, to a new position in space (<span class="math inline">y</span> say), <strong>given</strong> a current position (<span class="math inline">x</span> say). That is, <span class="math inline">Q</span> is a <strong>distribution</strong> on <span class="math inline">y</span> <strong>given</strong> <span class="math inline">x</span>, and we will write it: <span class="math inline">Q(y|x)</span>.</p>
<p>Note: when were working continuously, then <span class="math inline">Q</span> will be a <strong>density</strong> on <span class="math inline">y</span>.</p>
<p>As an example, lets choose the <strong>random walk kernel/proposal</strong>, which is a fancy way to say:</p>
<center>
The Gaussian™ <font size="6">😎</font>
</center>
<p>Under this proposal, if we start at a position <span class="math inline">x</span>, then our next position will be a standard Normal away:</p>
<p><span class="math display">
y = x + \mathcal{N}(0,1)
</span></p>
<p>This makes our <em>conditional</em> distribution <span class="math inline">Q(y|x)</span>, or the <strong>transition kernel</strong> be centered on our current location:</p>
<p><span class="math display">
Q(y|x) = \mathcal{N}(x,1)
</span></p>
<p><strong>Note:</strong> Often, we don’t want the variance to be <span class="math inline">1</span>. This could cause us to take too large steps!</p>
<p>Now we can actually <strong>define the algorithm</strong>:</p>
<div class="info">
<p><font size="7">👾</font><strong>Metropolis Algorithm Definition</strong>:</p>
<p>Initialize <span class="math inline">X_1</span> to some value: <span class="math inline">X_1=x_1</span>. For <span class="math inline">t= 1,2,\ldots</span>: 1. sample from the <strong>proposal distribution</strong>: $ y Q(y|x_t)$. We are <strong>proposing</strong> this value to be <span class="math inline">x_{t+1}</span>.<br>
2. compute the <strong>acceptance probability</strong> of this sample:</p>
<p><span class="math display">
A = \min \left( 1, \frac{\pi(y)}{\pi(x_t)} \right)
</span></p>
<ol start="3" type="1">
<li><strong>With probability <span class="math inline">A</span></strong>, <strong>accept</strong> the proposed value and set <span class="math inline">x_{t+1} = y</span>. Otherwise <strong>reject it</strong> and keep <span class="math inline">x_{t+1} = x_t</span>.</li>
</ol>
</div>
<center>
<font size="7">🤔💭</font>
</center>
<p>Hm. I can follow the steps so far, but its a bit unclear how this relates to chains, integration, etc.</p>
<p>No problem! Lets first run it on a simple example!</p>
</section>
<section id="sampling-from-exponential" class="level2">
<h2 class="anchored" data-anchor-id="sampling-from-exponential">Sampling from Exponential</h2>
<p>Lets pick the difficult distribution <span class="math inline">\pi</span> to be the <strong>exponential distribution</strong>:</p>
<p><span class="math display">
\pi(x) = e^{-x}
</span></p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> expon</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>plt.plot(expon.pdf(x))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-95-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Pretend</strong> this is the distribution <strong>we can’t easily sample from!</strong> Lets run the algorithm above.</p>
<p>Lets pick some random starting point:</p>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>num_steps <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.zeros(num_steps)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">3</span>   <span class="co"># random starting point</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>num_accepted <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_steps):</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># propose a new value</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    proposed_x <span class="op">=</span> x[t<span class="op">-</span><span class="dv">1</span>] <span class="op">+</span> np.random.randn()</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate its acceptance probability</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> expon.pdf(proposed_x)<span class="op">/</span>expon.pdf(x[t<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> np.amin([<span class="dv">1</span>,A])</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># accept it with that prob</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&lt;</span> A:    <span class="co"># accept</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>        x[t] <span class="op">=</span> proposed_x</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>        num_accepted <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:                       <span class="co"># reject</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>        x[t] <span class="op">=</span> x[t<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>num_accepted<span class="op">/</span>num_steps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<pre><code>0.554</code></pre>
</div>
</div>
<p>And thats it! We ran our algorithm. Now to understand it!</p>
<p>Lets first verify that indeed the histogram of our samples looks like the distribution we are trying to sample from!</p>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>plt.hist(x,bins<span class="op">=</span><span class="dv">10</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-98-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Perfect! Lets plot the <strong>path</strong> this chain took:</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))<span class="op">;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>plt.plot(x,<span class="st">'-o'</span>)<span class="op">;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.scatter(range(len(x)),x);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-99-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="7">🤷🏽‍♂️</font><strong>Pause-and-ponder</strong>: What are we looking at here? How is this related to the figure above?</p>
</div>
</section>
<section id="mcmc-for-bayesian-sampling" class="level2">
<h2 class="anchored" data-anchor-id="mcmc-for-bayesian-sampling">MCMC for Bayesian Sampling</h2>
<p>Recall, that in Bayesian statistics, we want to estimate the <strong>posterior distribution</strong>, but this is often <strong>intractable</strong> due to the <strong>high-dimensional integral</strong> in the <strong>denominator (marginal likelihood)</strong>.</p>
<p><span class="math display">
p(X|Y) = \frac{p(X)p(Y|X)}{p(Y)} = \frac{p(X)p(Y|X)}{\sum p(X_i)p(Y|X_i)}
</span></p>
<p>As we saw above when we discussed <strong>Monte Carlo integration</strong>, we can <strong>approximate the posterior</strong> <span class="math inline">p(X|Y)</span>, if we can somehow <strong>draw many samples that come from the posterior distribution</strong>.</p>
<p>With vanilla Monte Carlo integration, we need the samples to be independent draws from the posterior distribution, <strong>which is a problem</strong> if we do not actually know what the posterior distribution is, <strong>because we cannot integrate the marginal likelihood in the first place</strong>!.</p>
<p>With MCMC, we draw samples from a <strong>simple proposal distribution</strong>, so that each draw depends <strong>only on the state of the previous draw</strong> (i.e.&nbsp;<strong>the samples form a Markov chain!</strong>).</p>
<p>Under certain conditions, the Markov chain will have a <strong>unique stationary distribution which will be posterior!</strong> (Note: We have ignored those technical conditions in this document).</p>
<p>Note however, that <strong>not all samples are used</strong>! Instead we must set up <strong>acceptance criteria</strong> for each draw based on comparing successive states with respect to a <strong>target distribution</strong> that <strong>ensure</strong> that the <strong>stationary distribution is the posterior distribution</strong>!</p>
<p>The nice thing is that this <strong>target distribution</strong> only needs to be <strong>proportional to the posterior distribution</strong>, which means we <strong>don’t need to evaluate the potentially intractable marginal likelihood!</strong> (which is just the normalizing constant).</p>
<p>We can find such a target distribution easily!</p>
<div class="info">
<p><font size="7">🤷🏽‍♂️</font><strong>Pause-and-ponder</strong>: Can you think of a distribution that is <strong>proportional</strong> to our posterior but easy to sample from?</p>
</div>
<p>If you suggested the <strong>numerator</strong> of Bayes rule, you are correct!</p>
<p><span class="math display">
p(X|Y) \propto p(X) P(Y|X)
</span></p>
<p>After some time, the Markov chain of <strong>accepted draws</strong> will <strong>converge to the stationary distribution</strong>, and we can use those samples as <strong>correlated draws from the posterior distribution</strong>, and find functions of the posterior distribution in the same way as for vanilla Monte Carlo integration.</p>
<p>Lets instantiate this problem with our favorite simple Bayesian example: the coin flips!</p>
<p>We want to estimate the <strong>bias of a coin</strong> (the probability of flipping heads, say), <strong>given</strong> a sample consisting of <span class="math inline">n</span> tosses:</p>
<p><span class="math display">
p(\theta | X^n)
</span></p>
<p>where <span class="math inline">X^n</span> is all of our tosses. Note: we will drop the <span class="math inline">(\cdot)^n</span> notation below, as it is clear what we mean.</p>
<p>To compare our estimator, we can use a <strong>beta distribution</strong> as our <strong>conjugate prior</strong>, letting us write the posterior distribution in <strong>closed form</strong></p>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>num_flips <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>heads <span class="op">=</span> <span class="dv">61</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> heads<span class="op">/</span>num_flips</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># setup distributions</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>thetas <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">200</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>a, b <span class="op">=</span> <span class="dv">10</span>, <span class="dv">10</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>prior <span class="op">=</span> stats.beta(a, b)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>likelihood <span class="op">=</span> stats.binom(num_flips, thetas)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> stats.beta(heads<span class="op">+</span>a, num_flips<span class="op">-</span>heads<span class="op">+</span>b)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>plt.plot(thetas, prior.pdf(thetas), label<span class="op">=</span><span class="vs">r'Prior: $p(\theta)$'</span>, c<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>plt.plot(thetas, post.pdf(thetas), label<span class="op">=</span><span class="vs">r'Posterior: $p(\theta|X)$'</span>, c<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>plt.plot(thetas, num_flips<span class="op">*</span>likelihood.pmf(heads), label<span class="op">=</span><span class="vs">r'Likelihood: $p(X|\theta)$'</span>, c<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$\theta$'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-101-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Ok! Now we can <strong>get sampling!</strong></p>
<p>Lets give the same <strong>Metropolis Algorithm</strong> above, in a <strong>Bayesian</strong> setting:</p>
<p>We first pick the same <strong>“random walk” transition kernel/proposal distribution</strong> as above:</p>
<p><span class="math display">
Q(y|x) = \mathcal{N}(x,1)
</span></p>
<p>To rewrite it in terms of our coin example, we have:</p>
<p><span class="math display">
Q(\theta_p|\theta_t) = \mathcal{N}(\theta_t,\sigma)
</span></p>
<p>where <span class="math inline">\sigma</span> needs to be smaller than 1 (more on this below).</p>
<p>For the <strong>target</strong> distribution, one way to describe it is to think of our target distribution as the <strong>actual posterior</strong>: <span class="math inline">\pi(\cdot) = \text{post}(\cdot)</span>.</p>
<p>Take an initial guess for <span class="math inline">\theta</span>, and proceed as follows:</p>
<ol type="1">
<li><p><strong>propose</strong> a new <span class="math inline">\theta_p</span>: <span class="math display">
\theta_p = \theta_t + \mathcal{N}(0,\sigma)
</span></p></li>
<li><p>Calculate your <strong>acceptance ratio</strong>:</p></li>
</ol>
<p><span class="math display">
A = \frac{\text{post}(\theta_p | X)}{\text{post}(\theta_t | X)}
</span></p>
<p>Before continuing, lets pause and think about this <strong>acceptance ratio!</strong></p>
<div class="info">
<p><font size="7">🤷🏽‍♂️</font><strong>Pause-and-ponder</strong>: What do you notice about this ratio?!</p>
</div>
<p>Indeed! The <strong>model evidence/marginal likelihood cancels!</strong></p>
<p>So we <strong>do not</strong> need to use the <strong>actual posterior</strong> in this ratio! Instead, we can any distribution that is <strong>proportional to it!</strong>. For example, <strong>the Bayes numerator!</strong></p>
<p>Lets restate the algorithm now:</p>
<p>Take an initial guess for <span class="math inline">\theta</span>, and proceed as follows:</p>
<ol type="1">
<li><p><strong>propose</strong> a new <span class="math inline">\theta_p</span>: <span class="math display">
\theta_p = \theta_t + \mathcal{N}(0,1)
</span></p></li>
<li><p>Calculate your <strong>acceptance ratio</strong>:</p></li>
</ol>
<p><span class="math display">
A = \frac{p(\theta_p) p(X|\theta_p)}{p(\theta_t) p(X|\theta_t)}
</span></p>
<ol start="3" type="1">
<li><strong>With probability <span class="math inline">A</span></strong>, <strong>accept</strong> the proposed value and set <span class="math inline">\theta_{t+1} = \theta_p</span>. Otherwise <strong>reject it</strong> and keep <span class="math inline">\theta_{t+1} = \theta_t</span>.</li>
</ol>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>num_flips <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>heads <span class="op">=</span> <span class="dv">61</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># setup distributions</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>likelihood <span class="op">=</span> <span class="kw">lambda</span> curr_theta: stats.binom(num_flips, curr_theta).pmf(heads)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>prior <span class="op">=</span> <span class="kw">lambda</span> curr_theta: stats.beta(a, b).pdf(curr_theta)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>num_accepted <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>theta_0 <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>num_steps <span class="op">=</span> <span class="dv">10000</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> np.zeros(num_steps)</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>samples[<span class="dv">0</span>] <span class="op">=</span> theta_0</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,num_steps):</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># propose a theta</span></span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    theta_t <span class="op">=</span> samples[t<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>    theta_p <span class="op">=</span> theta_t <span class="op">+</span> np.random.randn()<span class="op">*</span>sigma</span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate acceptance ratio</span></span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> (likelihood(theta_p)<span class="op">*</span>prior(theta_p))<span class="op">/</span>(likelihood(theta_t)<span class="op">*</span>prior(theta_t))</span>
<span id="cb103-25"><a href="#cb103-25" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> np.amin([<span class="dv">1</span>,A])</span>
<span id="cb103-26"><a href="#cb103-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-27"><a href="#cb103-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># decice to accept:</span></span>
<span id="cb103-28"><a href="#cb103-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&lt;</span> A:</span>
<span id="cb103-29"><a href="#cb103-29" aria-hidden="true" tabindex="-1"></a>        samples[t] <span class="op">=</span> theta_p</span>
<span id="cb103-30"><a href="#cb103-30" aria-hidden="true" tabindex="-1"></a>        num_accepted <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb103-31"><a href="#cb103-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb103-32"><a href="#cb103-32" aria-hidden="true" tabindex="-1"></a>        samples[t] <span class="op">=</span> theta_t</span>
<span id="cb103-33"><a href="#cb103-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-34"><a href="#cb103-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Efficiency = "</span>, num_accepted<span class="op">/</span>num_steps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Efficiency =  0.1843</code></pre>
</div>
</div>
<p>Woah! We only accepted very few of our proposed samples!</p>
<p>Lets plot the histogram:</p>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>post <span class="op">=</span> stats.beta(heads<span class="op">+</span>a, num_flips<span class="op">-</span>heads<span class="op">+</span>b)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>nmcmc <span class="op">=</span> <span class="bu">len</span>(samples)<span class="op">//</span><span class="dv">2</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>plt.hist(stats.beta(a, b).rvs(nmcmc), <span class="dv">40</span>, histtype<span class="op">=</span><span class="st">'step'</span>, density<span class="op">=</span><span class="va">True</span>,linewidth<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="st">'Prior'</span>)<span class="op">;</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>plt.hist(samples[nmcmc:], <span class="dv">20</span>, histtype<span class="op">=</span><span class="st">'step'</span>, density<span class="op">=</span><span class="va">True</span>, linewidth<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="st">'Posterior'</span>)<span class="op">;</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>plt.plot(thetas, post.pdf(thetas), c<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">4</span>, label<span class="op">=</span><span class="st">'True posterior'</span>)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>,<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="vs">r'$\theta$'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-103-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As we did above, lets plot the path this chain took!</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>plt.plot(samples[::<span class="dv">50</span>], <span class="st">'-o'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-104-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>These kinds of <strong>trace plots</strong> are often used to <strong>informally</strong> assess for <strong>stochastic convergence</strong>.</p>
<p>This simple idea is just to run <strong>multiple chains</strong> and check that they converge to similar distributions. Lets repeat the above for multiple chains:</p>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> target(lik, prior, n, h, theta):</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> theta <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> theta <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lik(n, theta).pmf(h)<span class="op">*</span>prior.pdf(theta)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mh_coin(niters, n, h, theta, lik, prior, sigma):</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    samples <span class="op">=</span> [theta]</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="bu">len</span>(samples) <span class="op">&lt;</span> niters:</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        theta_p <span class="op">=</span> theta <span class="op">+</span> stats.norm(<span class="dv">0</span>, sigma).rvs()</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        rho <span class="op">=</span> <span class="bu">min</span>(<span class="dv">1</span>, target(lik, prior, n, h, theta_p)<span class="op">/</span>target(lik, prior, n, h, theta ))</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>        u <span class="op">=</span> np.random.uniform()</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> u <span class="op">&lt;</span> rho:</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>            theta <span class="op">=</span> theta_p</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>        samples.append(theta)</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> samples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>num_flips <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>heads <span class="op">=</span> <span class="dv">61</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>lik <span class="op">=</span> stats.binom</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>prior <span class="op">=</span> stats.beta(a, b)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>num_iters <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>sampless <span class="op">=</span> [mh_coin(num_iters, num_flips, heads, theta, lik, prior, sigma) <span class="cf">for</span> theta <span class="kw">in</span> np.arange(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> samples <span class="kw">in</span> sampless:</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    plt.plot(samples, <span class="st">'-o'</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="dv">0</span>, num_iters])</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="dv">0</span>, <span class="dv">1</span>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-107-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>: Debrief on what we’ve seen above. Questions to discuss:</p>
<ul>
<li>Where exactly is the Markov Chain in MCMC?</li>
<li>Why does this chain sample from a distribution?</li>
<li>What can we say about the resulting samples?</li>
<li>What about its efficiency?</li>
<li>What about how long it takes for the chain to “settle in” to a good setting? (also called <strong>burn in</strong>)</li>
</ul>
</div>
<p>Above, we’ve described the <strong>Metropolis Algorithm</strong> for MCMC. There is also its natural extension the <strong>Metropolis-Hastings Algorithm</strong>, which changes the <strong>acceptance ratio</strong> formula, to account for <strong>non-symmetric proposal distributions</strong>.</p>
<div class="info">
<p><font size="7">🤷🏽‍♂️</font><strong>Pause-and-ponder</strong>: Before looking it up, how do you think this will change the acceptance ratio?</p>
</div>
<hr>
</section>
<section id="gibbs-sampler" class="level2">
<h2 class="anchored" data-anchor-id="gibbs-sampler">Gibbs Sampler</h2>
<p>The other major MCMC algorithm is the <strong>Gibbs Sampler</strong>. This is a technique for construction a Markov Chain from a <strong>join distribution</strong>, by sampling from the <strong>conditional distributions sequentially</strong>!</p>
<p><strong>Note</strong>: For this part, I slightly modified the wording and code from this <a href="https://mr-easy.github.io/2020-05-21-implementing-gibbs-sampling-in-python/">really nice blog post!</a>.</p>
<p>Many times in the “real world” you will find yourself in a situation where it is <strong>incredibly difficult</strong> to sample from a <strong>joint distribution</strong>, but <strong>much easier</strong> to sample from a <strong>conditional distribution</strong>.</p>
<p>The Gibbs sampler uses samples from the <strong>conditional</strong> distributions, to approximate samples from this joint!</p>
<p>Note: If its not, then we can also use Metropolis-Hastings to sample from this conditional, and then use Gibbs use to sample from the joint! This is called:</p>
<center>
Metropolis-Inside-Gibbs™<font size="6">😎</font>
</center>
<p>The algorithm for the Gibbs sampler is actually very straightforward.</p>
<p>Suppose we have a <strong>vector</strong> of parameters <span class="math inline">\theta=(\theta_1,\theta_2,\ldots,\theta_n)</span>, and we want to estimate the <strong>joint</strong> posterior distribution <span class="math inline">p(\theta|X)</span>.</p>
<p>Suppose we can find and draw random samples from all the conditional distributions:</p>
<p><span class="math display">
p(\theta_1 | \theta_2, \ldots, \theta_n,X) \\
p(\theta_2 | \theta_1, \ldots, \theta_n,X) \\
\cdots \\
p(\theta_n | \theta_1, \theta_2,\ldots,X)
</span></p>
<p>With Gibbs sampling, the Markov chain is constructed by sampling from the conditional distribution <strong>for each parameter <span class="math inline">\theta_i</span> in turn, treating all other parameters as observed</strong>.</p>
<p>When we have finished iterating over all parameters, we are said to have <strong>completed one cycle of the Gibbs sampler</strong>.</p>
<p>Since hierarchical models are typically set up as products of conditional distributions, the Gibbs sampler is <strong>ubiquitous in Bayesian modeling</strong>.</p>
<section id="example-setup" class="level3">
<h3 class="anchored" data-anchor-id="example-setup">Example Setup</h3>
<p>Imagine we <strong>want</strong> to sample from a 2D Gaussian distribution over a variable of interest:</p>
<p><span class="math display">
\mathbf{X} = [x_0,x_1]^T \sim \mathcal{N}(\mathbf{\mu},\mathbf{\Sigma})
</span></p>
<p>where:</p>
<p><span class="math display">
\mathbf{\mu} =
\begin{bmatrix}
\mu_0 \\
\mu_1
\end{bmatrix} \quad\quad
\mathbf{\Sigma} =
\begin{bmatrix}
\sigma_{00} &amp; \sigma_{01} \\
\sigma_{10} &amp; \sigma_{11}
\end{bmatrix}
</span></p>
<p>This is our <strong>target</strong>, that we’re pretending its <strong>difficult</strong> to sample from.</p>
<p>The Gibbs sampler uses samples from the <strong>conditional</strong> distributions, to approximate samples from this joint.</p>
<p>In other words, we only need to sample from <span class="math inline">p(x_0|x_1)</span> and <span class="math inline">p(x_1|x_0)</span>!</p>
<p>Multivariate Gaussians have the property that the conditional distributions <strong>are also Gaussian</strong> (and the marginals too - for a proof of this property, see Wikipedia or any ML textbook).</p>
<p>So our conditionals are given by:</p>
<p><span class="math display">
p(x_0|x_1) \sim \mathcal{N} \left(\mu_0 + \frac{\sigma_{01}}{\sigma_{11}}(x_1 -\mu_1),\sigma_{00} - \frac{\sigma_{01}^2}{\sigma_{11}}\right) \\
p(x_1|x_0) \sim \mathcal{N} \left(\mu_1 + \frac{\sigma_{01}}{\sigma_{00}}(x_0 -\mu_0),\sigma_{11} - \frac{\sigma_{01}^2}{\sigma_{00}}\right)
</span></p>
<p>Wow these look verbose! But, they are just the formula’s for 1D gaussians, in terms of the parameters of the 2D gaussian! Very simple to code up!</p>
<p>Indeed: we give just one function that can simulate from both:</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> conditional_sampler(sampling_index, current_x, mean, cov):</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    conditioned_index <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> sampling_index </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The above line works because we only have 2 variables, x_0 &amp; x_1</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> cov[sampling_index, sampling_index]</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> cov[sampling_index, conditioned_index]</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> cov[conditioned_index, conditioned_index]</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> mean[sampling_index] <span class="op">+</span> (b <span class="op">*</span> (current_x[conditioned_index] <span class="op">-</span> mean[conditioned_index]))<span class="op">/</span>c</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> np.sqrt(a<span class="op">-</span>(b<span class="op">**</span><span class="dv">2</span>)<span class="op">/</span>c)</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    new_x <span class="op">=</span> np.copy(current_x)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    new_x[sampling_index] <span class="op">=</span> np.random.randn()<span class="op">*</span>sigma <span class="op">+</span> mu</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can give the actual Gibbs sampler for this problem:</p>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gibbs_sampler(initial_point, num_samples, mean, cov, create_gif<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    frames <span class="op">=</span> []  <span class="co"># for GIF</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    point <span class="op">=</span> np.array(initial_point)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    samples <span class="op">=</span> np.empty([num_samples<span class="op">+</span><span class="dv">1</span>, <span class="dv">2</span>])  <span class="co">#sampled points</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    samples[<span class="dv">0</span>] <span class="op">=</span> point</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    tmp_points <span class="op">=</span> np.empty([num_samples, <span class="dv">2</span>]) <span class="co">#inbetween points</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_samples):</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sample from p(x_0|x_1)</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        point <span class="op">=</span> conditional_sampler(<span class="dv">0</span>, point, mean, cov)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>        tmp_points[i] <span class="op">=</span> point</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(create_gif):</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>            frames.append(plot_samples(samples, i<span class="op">+</span><span class="dv">1</span>, tmp_points, i<span class="op">+</span><span class="dv">1</span>, title<span class="op">=</span><span class="st">"Num Samples: "</span> <span class="op">+</span> <span class="bu">str</span>(i)))</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sample from p(x_1|x_0)</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>        point <span class="op">=</span> conditional_sampler(<span class="dv">1</span>, point, mean, cov)</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>        samples[i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> point</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(create_gif):</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>            frames.append(plot_samples(samples, i<span class="op">+</span><span class="dv">2</span>, tmp_points, i<span class="op">+</span><span class="dv">1</span>, title<span class="op">=</span><span class="st">"Num Samples: "</span> <span class="op">+</span> <span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>)))</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(create_gif):</span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> samples, tmp_points, frames</span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> samples, tmp_points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now were ready to make some nice plots! Lets wrap up a lot of this ugly plotting code in functions:</p>
<hr>
<section id="plotting-code" class="level4">
<h4 class="anchored" data-anchor-id="plotting-code">Plotting code</h4>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install gif</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Ellipse</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gif</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.transforms <span class="im">as</span> transforms</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting code from matplotlib and:</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/mr-easy/Gibbs-Sampling-Visualized/blob/master/plotting_util.py</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_gaussian_from_points(x, y, ax, n_std<span class="op">=</span><span class="fl">3.0</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, <span class="op">**</span>kwargs):</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Create a plot of the covariance confidence ellipse of *x* and *y*.</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co">    x, y : array-like, shape (n, )</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="co">        Input data.</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="co">    ax : matplotlib.axes.Axes</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="co">        The axes object to draw the ellipse into.</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="co">    n_std : float</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The number of standard deviations to determine the ellipse's radiuses.</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="co">    matplotlib.patches.Ellipse</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Other parameters</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------------</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a><span class="co">    kwargs : `~matplotlib.patches.Patch` properties</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">!=</span> <span class="bu">len</span>(y):</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"x and y must be the same size"</span>)</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Need more data."</span>)</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.cov(x, y)</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>    pearson <span class="op">=</span> cov[<span class="dv">0</span>, <span class="dv">1</span>]<span class="op">/</span>np.sqrt(cov[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">*</span> cov[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Using a special case to obtain the eigenvalues of this</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># two-dimensionl dataset.</span></span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    ell_radius_x <span class="op">=</span> np.sqrt(<span class="dv">1</span> <span class="op">+</span> pearson)</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>    ell_radius_y <span class="op">=</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> pearson)</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>    ellipse <span class="op">=</span> Ellipse((<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>ell_radius_x <span class="op">*</span> <span class="dv">2</span>,</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>ell_radius_y <span class="op">*</span> <span class="dv">2</span>,</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span>facecolor,</span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>kwargs)</span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculating the stdandard deviation of x from</span></span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the squareroot of the variance and multiplying</span></span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with the given number of standard deviations.</span></span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>    scale_x <span class="op">=</span> np.sqrt(cov[<span class="dv">0</span>, <span class="dv">0</span>]) <span class="op">*</span> n_std</span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>    mean_x <span class="op">=</span> np.mean(x)</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculating the stdandard deviation of y ...</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>    scale_y <span class="op">=</span> np.sqrt(cov[<span class="dv">1</span>, <span class="dv">1</span>]) <span class="op">*</span> n_std</span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>    mean_y <span class="op">=</span> np.mean(y)</span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>    transf <span class="op">=</span> transforms.Affine2D() <span class="op">\</span></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>        .rotate_deg(<span class="dv">45</span>) <span class="op">\</span></span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>        .scale(scale_x, scale_y) <span class="op">\</span></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>        .translate(mean_x, mean_y)</span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a>    ellipse.set_transform(transf <span class="op">+</span> ax.transData)</span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax.add_patch(ellipse)</span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_gaussian_from_parameters(mean, cov, ax, n_std<span class="op">=</span><span class="fl">3.0</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, <span class="op">**</span>kwargs):</span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a><span class="co">    Create a plot of the covariance confidence ellipse of *x* and *y*.</span></span>
<span id="cb113-58"><a href="#cb113-58" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb113-59"><a href="#cb113-59" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb113-60"><a href="#cb113-60" aria-hidden="true" tabindex="-1"></a><span class="co">    mean : array-like, shape (2, )</span></span>
<span id="cb113-61"><a href="#cb113-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Mean vector</span></span>
<span id="cb113-62"><a href="#cb113-62" aria-hidden="true" tabindex="-1"></a><span class="co">    cov : array-like, shape (2,2)</span></span>
<span id="cb113-63"><a href="#cb113-63" aria-hidden="true" tabindex="-1"></a><span class="co">        Covariance matrix</span></span>
<span id="cb113-64"><a href="#cb113-64" aria-hidden="true" tabindex="-1"></a><span class="co">    ax : matplotlib.axes.Axes</span></span>
<span id="cb113-65"><a href="#cb113-65" aria-hidden="true" tabindex="-1"></a><span class="co">        The axes object to draw the ellipse into.</span></span>
<span id="cb113-66"><a href="#cb113-66" aria-hidden="true" tabindex="-1"></a><span class="co">    n_std : float</span></span>
<span id="cb113-67"><a href="#cb113-67" aria-hidden="true" tabindex="-1"></a><span class="co">        The number of standard deviations to determine the ellipse's radiuses.</span></span>
<span id="cb113-68"><a href="#cb113-68" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb113-69"><a href="#cb113-69" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb113-70"><a href="#cb113-70" aria-hidden="true" tabindex="-1"></a><span class="co">    matplotlib.patches.Ellipse</span></span>
<span id="cb113-71"><a href="#cb113-71" aria-hidden="true" tabindex="-1"></a><span class="co">    Other parameters</span></span>
<span id="cb113-72"><a href="#cb113-72" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------------</span></span>
<span id="cb113-73"><a href="#cb113-73" aria-hidden="true" tabindex="-1"></a><span class="co">    kwargs : `~matplotlib.patches.Patch` properties</span></span>
<span id="cb113-74"><a href="#cb113-74" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb113-75"><a href="#cb113-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(mean) <span class="op">!=</span> <span class="dv">2</span>:</span>
<span id="cb113-76"><a href="#cb113-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Mean vector length should be 2."</span>)</span>
<span id="cb113-77"><a href="#cb113-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cov.shape <span class="op">!=</span> (<span class="dv">2</span>, <span class="dv">2</span>)):</span>
<span id="cb113-78"><a href="#cb113-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Covariance should be a 2x2 matrix."</span>)</span>
<span id="cb113-79"><a href="#cb113-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">#checking if cov is symmetric pos semidefinite</span></span>
<span id="cb113-80"><a href="#cb113-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(cov[<span class="dv">0</span>, <span class="dv">1</span>] <span class="op">!=</span> cov[<span class="dv">1</span>, <span class="dv">0</span>]):</span>
<span id="cb113-81"><a href="#cb113-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Covariance should be symmetric."</span>)</span>
<span id="cb113-82"><a href="#cb113-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(cov[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> cov[<span class="dv">0</span>, <span class="dv">0</span>]<span class="op">*</span>cov[<span class="dv">1</span>,<span class="dv">1</span>] <span class="op">-</span> cov[<span class="dv">0</span>,<span class="dv">1</span>]<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;</span> <span class="dv">0</span>):</span>
<span id="cb113-83"><a href="#cb113-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Covariance should be positive semidefinite."</span>)</span>
<span id="cb113-84"><a href="#cb113-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-85"><a href="#cb113-85" aria-hidden="true" tabindex="-1"></a>    pearson <span class="op">=</span> cov[<span class="dv">0</span>, <span class="dv">1</span>]<span class="op">/</span>np.sqrt(cov[<span class="dv">0</span>, <span class="dv">0</span>] <span class="op">*</span> cov[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb113-86"><a href="#cb113-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Using a special case to obtain the eigenvalues of this</span></span>
<span id="cb113-87"><a href="#cb113-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># two-dimensionl dataset.</span></span>
<span id="cb113-88"><a href="#cb113-88" aria-hidden="true" tabindex="-1"></a>    ell_radius_x <span class="op">=</span> np.sqrt(<span class="dv">1</span> <span class="op">+</span> pearson)</span>
<span id="cb113-89"><a href="#cb113-89" aria-hidden="true" tabindex="-1"></a>    ell_radius_y <span class="op">=</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> pearson)</span>
<span id="cb113-90"><a href="#cb113-90" aria-hidden="true" tabindex="-1"></a>    ellipse <span class="op">=</span> Ellipse((<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb113-91"><a href="#cb113-91" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>ell_radius_x <span class="op">*</span> <span class="dv">2</span>,</span>
<span id="cb113-92"><a href="#cb113-92" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>ell_radius_y <span class="op">*</span> <span class="dv">2</span>,</span>
<span id="cb113-93"><a href="#cb113-93" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span>facecolor,</span>
<span id="cb113-94"><a href="#cb113-94" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>kwargs)</span>
<span id="cb113-95"><a href="#cb113-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-96"><a href="#cb113-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculating the stdandard deviation of x from</span></span>
<span id="cb113-97"><a href="#cb113-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the squareroot of the variance and multiplying</span></span>
<span id="cb113-98"><a href="#cb113-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with the given number of standard deviations.</span></span>
<span id="cb113-99"><a href="#cb113-99" aria-hidden="true" tabindex="-1"></a>    scale_x <span class="op">=</span> np.sqrt(cov[<span class="dv">0</span>, <span class="dv">0</span>]) <span class="op">*</span> n_std</span>
<span id="cb113-100"><a href="#cb113-100" aria-hidden="true" tabindex="-1"></a>    mean_x <span class="op">=</span> mean[<span class="dv">0</span>]</span>
<span id="cb113-101"><a href="#cb113-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-102"><a href="#cb113-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculating the stdandard deviation of y ...</span></span>
<span id="cb113-103"><a href="#cb113-103" aria-hidden="true" tabindex="-1"></a>    scale_y <span class="op">=</span> np.sqrt(cov[<span class="dv">1</span>, <span class="dv">1</span>]) <span class="op">*</span> n_std</span>
<span id="cb113-104"><a href="#cb113-104" aria-hidden="true" tabindex="-1"></a>    mean_y <span class="op">=</span> mean[<span class="dv">1</span>]</span>
<span id="cb113-105"><a href="#cb113-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-106"><a href="#cb113-106" aria-hidden="true" tabindex="-1"></a>    transf <span class="op">=</span> transforms.Affine2D() <span class="op">\</span></span>
<span id="cb113-107"><a href="#cb113-107" aria-hidden="true" tabindex="-1"></a>        .rotate_deg(<span class="dv">45</span>) <span class="op">\</span></span>
<span id="cb113-108"><a href="#cb113-108" aria-hidden="true" tabindex="-1"></a>        .scale(scale_x, scale_y) <span class="op">\</span></span>
<span id="cb113-109"><a href="#cb113-109" aria-hidden="true" tabindex="-1"></a>        .translate(mean_x, mean_y)</span>
<span id="cb113-110"><a href="#cb113-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-111"><a href="#cb113-111" aria-hidden="true" tabindex="-1"></a>    ellipse.set_transform(transf <span class="op">+</span> ax.transData)</span>
<span id="cb113-112"><a href="#cb113-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax.add_patch(ellipse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="at">@gif.frame</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_samples(samples, num_samples, tmp_points, num_tmp, title<span class="op">=</span><span class="st">"Gibbs Sampling"</span>, xlims<span class="op">=</span>(<span class="op">-</span><span class="dv">11</span>, <span class="dv">11</span>), ylims<span class="op">=</span>(<span class="op">-</span><span class="dv">11</span>, <span class="dv">11</span>)):</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> fig.gca()</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the true distribution</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>    plot_gaussian_from_parameters(mean, cov, ax, n_std<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'g'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">"True Distribution"</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot sampled points</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>    ax.scatter(samples[:num_samples, <span class="dv">0</span>], samples[:num_samples, <span class="dv">1</span>], c<span class="op">=</span><span class="st">'b'</span>, s<span class="op">=</span><span class="dv">10</span>, label<span class="op">=</span><span class="st">"Sampled Points"</span>)</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>    ax.scatter(samples[<span class="dv">0</span>, <span class="dv">0</span>], samples[<span class="dv">0</span>, <span class="dv">1</span>], marker<span class="op">=</span><span class="st">'*'</span>, c<span class="op">=</span><span class="st">'g'</span>, s<span class="op">=</span><span class="dv">60</span>, label<span class="op">=</span><span class="st">"Initial Point"</span>)</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot samples from conditional distribution</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>    ax.scatter(tmp_points[:num_tmp, <span class="dv">0</span>], tmp_points[:num_tmp, <span class="dv">1</span>], c<span class="op">=</span><span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>, s<span class="op">=</span><span class="dv">5</span>, label<span class="op">=</span><span class="st">"Temporary Points"</span>)</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keeping the axes scales same for good GIFS</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(xlims)</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(ylims)</span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot lines</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(num_tmp <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>        ax.plot([samples[num_samples<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>], tmp_points[num_tmp<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>]], </span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>                [samples[num_samples<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>], tmp_points[num_tmp<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>]], c<span class="op">=</span><span class="st">'k'</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot estimated Gaussian, ignoring the starting point</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(num_samples <span class="op">&gt;</span> <span class="dv">2</span>):</span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>            plot_gaussian_from_points(samples[<span class="dv">1</span>:num_samples, <span class="dv">0</span>], samples[<span class="dv">1</span>:num_samples, <span class="dv">1</span>], </span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>                                      ax, n_std<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'b'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="vs">r"p(x_1|x_0)"</span>)</span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot estimated Gaussian, ignoring the starting point</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(num_tmp <span class="op">&gt;</span> <span class="dv">2</span>):</span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true" tabindex="-1"></a>            plot_gaussian_from_points(tmp_points[<span class="dv">1</span>:num_tmp, <span class="dv">0</span>], tmp_points[<span class="dv">1</span>:num_tmp, <span class="dv">1</span>], </span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true" tabindex="-1"></a>                                      ax, n_std<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'r'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="vs">r"p(x_0|x_1)"</span>)</span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true" tabindex="-1"></a>    ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>,fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title,fontsize<span class="op">=</span><span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="resume-example" class="level3">
<h3 class="anchored" data-anchor-id="resume-example">Resume Example</h3>
<p>Ok! After all that plotting setup, we can actually run our example!</p>
<p>Lets specify the <strong>true distribution</strong>:</p>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>cov <span class="op">=</span> np.array([[<span class="dv">10</span>, <span class="dv">3</span>], </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>                [<span class="dv">3</span>, <span class="dv">5</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot true distribution</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.gca()</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>plot_gaussian_from_parameters(mean, cov, ax, n_std<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'g'</span>, label<span class="op">=</span><span class="st">"True Distribution"</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>ax.scatter(mean[<span class="dv">0</span>], mean[<span class="dv">1</span>], c<span class="op">=</span><span class="st">'g'</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlim((<span class="op">-</span><span class="dv">11</span>, <span class="dv">11</span>))</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylim((<span class="op">-</span><span class="dv">11</span>, <span class="dv">11</span>))</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="prob-mcmc-gibbs_files/figure-html/cell-116-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This is the distribution we want to <strong>sample from</strong>.</p>
<p>Lets run our Gibbs sampler:</p>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>initial_point <span class="op">=</span> [<span class="op">-</span><span class="fl">9.0</span>, <span class="op">-</span><span class="fl">9.0</span>]</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>num_samples <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>samples, tmp_points, frames <span class="op">=</span> gibbs_sampler(initial_point, num_samples, mean, cov, create_gif<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now lets create the gif so we can visualize it!</p>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the GIF</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> reanimate_gifs:</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    gif.save(frames, <span class="st">"gibbs.gif"</span>, duration<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="gibbs.gif" class="img-fluid"></p>
<div class="info">
<p><font size="7">🧐</font><strong>Pause-and-ponder</strong>: Whoa! Lets break this down and discuss!</p>
</div>
</section>
</section>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<ul>
<li>https://setosa.io/ev/markov-chains/ - I took an example and some language from this great site!</li>
<li>The explanation of MC estimation was taken from its wikipedia page, and:
<ul>
<li>https://cs.dartmouth.edu/~wjarosz/publications/dissertation/appendixA.pdf</li>
<li>http://people.duke.edu/~ccc14/sta-663-2017/20A_MCMC.html</li>
</ul></li>
<li>The Gibbs sampler code and example was taken from:
<ul>
<li>https://mr-easy.github.io/2020-05-21-implementing-gibbs-sampling-in-python/</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>